<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Current example of how to solve a PDE on a manifold - FEniCS Q&amp;A</title>
		<meta name="description" content="I'm looking for an example of how to use Fenics to solve a PDE on a manifold. The  ... poisson equation on a manifold I would greatly appreciate it.">
		<meta name="keywords" content="manifold,pde,examples">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/13276/current-example-of-how-to-solve-a-pde-on-a-manifold">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Current example of how to solve a PDE on a manifold</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q13276">
								<form method="post" action="../../13276/current-example-of-how-to-solve-a-pde-on-a-manifold">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_13276">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467860-aee0efd46f51c275ce86a663afd5152fa4678702">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../13276/current-example-of-how-to-solve-a-pde-on-a-manifold">
										<div class="qa-q-view-content">
											<a name="13276"></a><div class="entry-content"><p>I'm looking for an example of how to use Fenics to solve a PDE on a manifold.  The only examples that I've been able to find are on</p>

<p><a rel="nofollow" href="http://www.geosci-model-dev.net/6/2099/2013/">http://www.geosci-model-dev.net/6/2099/2013/</a></p>

<p>and from the question on this site</p>

<p><a rel="nofollow" href="https://fenicsproject.org/qa/2897/inhomogeneous-neumann-boundary-condition-poisson-manifold?show=2897#q2897">https://fenicsproject.org/qa/2897/inhomogeneous-neumann-boundary-condition-poisson-manifold?show=2897#q2897</a></p>

<p>Unfortunately, none of these codes will run with the modern version of Fenics. I'm new to Fenics so I'm not sure how to interpret the errors to be able to fix them.</p>

<p>If anybody could fix one of the examples to be able to run with the current version of Fenics, or (preferably) produce a minimum working example of how to solve say the poisson equation on a manifold I would greatly appreciate it.</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/manifold" rel="tag" class="qa-tag-link">manifold</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/pde" rel="tag" class="qa-tag-link">pde</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/examples" rel="tag" class="qa-tag-link">examples</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-avatar">
												<a href="../../user/rviertel" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=10721583502098350530&amp;qa_size=50" width="38" height="50" class="qa-avatar-image" alt=""></a>
											</span>
											<span class="qa-q-view-meta">
												<a href="../../13276/current-example-of-how-to-solve-a-pde-on-a-manifold" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2017-05-01T18:08:27+0000"></span>May 1, 2017</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/rviertel" class="qa-user-link url nickname">rviertel</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">700</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c13276_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467860-d4fccd2c255bf83464e844f0c6a71fe1b874f51b">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a13300">
									<form method="post" action="../../13276/current-example-of-how-to-solve-a-pde-on-a-manifold">
										<div class="qa-voting qa-voting-net" id="voting_13300">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467860-aee0efd46f51c275ce86a663afd5152fa4678702">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../13276/current-example-of-how-to-solve-a-pde-on-a-manifold">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="13300"></a><div class="entry-content"><p>This should work, it is Arnold's example. The only things that have changed since then are:<br>
- You have to explicitly set the Expression's degree <br>
- You must create Mixed Spaces with a MixedElement (at least that's how it works for me)</p>

<pre><code>from dolfin import *
from numpy import log

# forcing function, high degree for better approximation
f = Expression("exp(-10.*(pow(x[0], 2) + pow(x[1]-1/sqrt(2.), 2) + pow(x[2]-1/sqrt(2.), 2)))", 
degree = 4)

mesh = Mesh("hemisphere_mesh.xml")
global_normal = Expression(("x[0]", "x[1]", "x[2]"), degree = 1)
mesh.init_cell_orientations(global_normal)

# finite element mesh and spaces
V0 = FunctionSpace(mesh, "RT", 3)
V1 = FunctionSpace(mesh, "DG", 2)
R = FunctionSpace(mesh, "Real", 0)
Mel = MixedElement([V0.ufl_element(), V1.ufl_element(), R.ufl_element()])
V = FunctionSpace(mesh, Mel)
# essential boundary condition
def bdry(x, on_boundary):
    return on_boundary

bc = DirichletBC(V.sub(0), Constant((0., 0., 0.0)), bdry)

# trial and test functions
(u, p, c0) = TrialFunctions(V)
(v, q, c1) = TestFunctions(V)

# bilinear form, right hand side
a = (dot(u, v) - p*div(v) - div(u)*q + c0*q + p*c1) * dx
L = -f*q * dx

# assemble, solve
up = Function(V)
solve(a == L, up, bc)
(u, p, c0) = up.split()
</code></pre>

<p>I didn't know about setting the normal, so thanks for the question. Let me know in case of anything. Best regards!</p>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-avatar">
														<a href="../../user/nabarnaf" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=6623124104544180019&amp;qa_size=40" width="40" height="29" class="qa-avatar-image" alt=""></a>
													</span>
													<span class="qa-a-item-meta">
														<a href="../../13276/current-example-of-how-to-solve-a-pde-on-a-manifold?show=13300#a13300" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-05-03T14:10:52+0000"></span>May 3, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/nabarnaf" class="qa-user-link url nickname">nabarnaf</a></span></span>
															<span class="qa-a-item-who-title">FEniCS User</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">2,940</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2017-05-03T18:33:33+0000"></span>May 3, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/rviertel" class="qa-user-link url nickname">rviertel</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c13300_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467860-97dd82d86b355a15b0bb69d7e5da45c796c9f347">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>