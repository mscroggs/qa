<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Plot FacetNormal - FEniCS Q&amp;A</title>
		<meta name="description" content="Hi. I'm solving a PDE with a Neumann boundary value that is a scalar product of a function with the  ...  n = FacetNormal(mesh) # works File('f.pvd')">
		<meta name="keywords" content="facet-normal,projection">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/8590/plot-facetnormal">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Plot FacetNormal</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q8590">
								<form method="post" action="../../8590/plot-facetnormal">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_8590">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468181-2cbda08371bc0e9e68838c52b58c24cef788bf11">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../8590/plot-facetnormal">
										<div class="qa-q-view-content">
											<a name="8590"></a><div class="entry-content"><p>Hi. I'm solving a PDE with a Neumann boundary value that is a scalar product of a function with the normal to the boundary facets. Because I get faulty results, I'm trying to debug my code. My first step is to plot FacetNormal(mesh), but I'm not succeeding.</p>

<pre><code>from dolfin import *

mesh = UnitSquareMesh(5,5)
bmesh = BoundaryMesh(mesh, 'exterior')

f = Expression(('x[0]','x[1]'))
n = FacetNormal(mesh)

# works
File('f.pvd') &lt;&lt; project(f, VectorFunctionSpace(bmesh, 'Lagrange', 1))
# error in instant compilation, see below
File('n.pvd') &lt;&lt; project(n, VectorFunctionSpace(bmesh, 'Lagrange', 1))
</code></pre>

<blockquote>
  <p>[...]<br>
  &#8216;n1&#8217; was not declared in this scope<br>
         A[j] += (FE0_C1[0][j]<em>n1 + FE0_C0[0][j]</em>n0)<em>W1</em>det;<br>
  [...]<br>
  &#8216;n0&#8217; was not declared in this scope<br>
         A[j] += (FE0_C1[0][j]<em>n1 + FE0_C0[0][j]</em>n0)<em>W1</em>det;</p>
</blockquote>

<p>I expect that I'm missing something obvious. Thanks for your help!</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/facet-normal" rel="tag" class="qa-tag-link">facet-normal</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/projection" rel="tag" class="qa-tag-link">projection</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-avatar">
												<a href="../../user/rwalt" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/62614f4b12482473ff057e54ebee4c7a?s=50" width="50" height="50" class="qa-avatar-image" alt=""></a>
											</span>
											<span class="qa-q-view-meta">
												<a href="../../8590/plot-facetnormal" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2015-11-17T11:16:38+0000"></span>Nov 17, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/rwalt" class="qa-user-link url nickname">rwalt</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">480</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c8590_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468181-47d71e3a8647510a03a30eeeb950170e0ee0c890">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a8594">
									<form method="post" action="../../8590/plot-facetnormal">
										<div class="qa-voting qa-voting-net" id="voting_8594">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468181-2cbda08371bc0e9e68838c52b58c24cef788bf11">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../8590/plot-facetnormal">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="8594"></a><div class="entry-content"><p>The FacetNormal "lives" only on the facets, so it cannot be evaluated inside the cells which is needed for a projection to normal Lagrange space (although I am not 100% sure how boundary meshes work in this regard)</p>

<p>You could, if you wanted, project to a Discontinuous Lagrange Trace space, that "lives" only on facets, but I do not think dolfin knows how to plot these, so you may not get you far, but you could try.</p>

<p>The FacetNormal has length 1 and is outwards pointing normal to each external facet. For internal facets it is multiple-valued and you need to specify which direction you want. You can potentially use this information to plot it by use of matplotlib. The mesh cells can be queried for their facet normals and facet midpoints for plotting vectors, Something like this code could be adapted: <br>
<a rel="nofollow" href="https://bitbucket.org/trlandet/ocellaris/src/08c0249e8dd827e6dab763d74cf74817b7e77900/ocellaris/postprocess/plot/plot_CR1_2D_vector.py?at=master&amp;fileviewer=file-view-default">https://bitbucket.org/trlandet/ocellaris/src/08c0249e8dd827e6dab763d74cf74817b7e77900/ocellaris/postprocess/plot/plot_CR1_2D_vector.py?at=master&amp;fileviewer=file-view-default</a></p>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-meta">
														<a href="../../8590/plot-facetnormal?show=8594#a8594" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2015-11-17T16:28:12+0000"></span>Nov 17, 2015</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Tormod+Landet" class="qa-user-link url nickname">Tormod Landet</a></span></span>
															<span class="qa-a-item-who-title">FEniCS User</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">5,130</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2015-12-10T14:24:08+0000"></span>Dec 10, 2015</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/rwalt" class="qa-user-link url nickname">rwalt</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c8594_list">
												<div class="qa-c-list-item  hentry comment" id="c8596">
													<div class="qa-c-item-content">
														<a name="8596"></a><div class="entry-content"><p>By the way, I do not think the project function supports projection on facets only, so you would need to write your own. I have done so a few times since I have been working with DGT (Discontinuous Galerkin Trace) functions. My (very simplified) pure Python implementation of FEniCS has such a projection implemented which you can see here:<br>
<a rel="nofollow" href="https://bitbucket.org/trlandet/phonyx/src/ad81391ce5de8a9e231eb0d77eb5bd10e66a7e75/phonyx/public_functions.py?at=master&amp;fileviewer=file-view-default">https://bitbucket.org/trlandet/phonyx/src/ad81391ce5de8a9e231eb0d77eb5bd10e66a7e75/phonyx/public_functions.py?at=master&amp;fileviewer=file-view-default</a><br>
This code should work with with some small changes also in dolfin, at least if you restrict it to external facets only.</p>

<p>Another possibility is that the FacetNormal machinery just does not handle boundary meshes very well. During quadrature the assembler tells the function (n in this case) which coordinate position to calculate and whether or not this is on a facet, and in that case the ID number of the facet. In this case it is not on a facet (in the boundary mesh), but is on a facet (in the mesh used to create the facet normal). You can look at the dolfin code to verify, but I suspect this may not work as intended.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../8590/plot-facetnormal?show=8596#c8596" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-11-17T16:46:49+0000"></span>Nov 17, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Tormod+Landet" class="qa-user-link url nickname">Tormod Landet</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">5,130</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468181-c039c0579f63b349af48393b93685ddbb322de32">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>