<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>adapt MeshFunctions to refined mesh [cpp] - FEniCS Q&amp;A</title>
		<meta name="description" content="Hi, after to refine the mesh i would like to adapt to the new mesh the MeshFunctions (types double ...  refined_mesh); any ideas about how to do this?">
		<meta name="keywords" content="cpp,adapt,meshfunction,refine,mesh">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/8251/adapt-meshfunctions-to-refined-mesh-cpp">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">adapt MeshFunctions to refined mesh [cpp]</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q8251">
								<form method="post" action="../../8251/adapt-meshfunctions-to-refined-mesh-cpp">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_8251">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468164-47b5a5339e5196f54b2f8eddca672e81128f20e5">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../8251/adapt-meshfunctions-to-refined-mesh-cpp">
										<div class="qa-q-view-content">
											<a name="8251"></a><div class="entry-content"><p>Hi,<br>
after to refine the mesh i would like to adapt to the new mesh the MeshFunctions (types double, bool and std::size_t) defined on the old mesh without the work of redefininig these functions.</p>

<p>I tried to do this (without succes):</p>

<pre><code>adapt(sizet_meshfunction, refined_mesh);
adapt(bool_meshfunction, refined_mesh);
adapt(double_meshfunction, refined_mesh);
</code></pre>

<p>any ideas about how to do this?</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/cpp" rel="tag" class="qa-tag-link">cpp</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/adapt" rel="tag" class="qa-tag-link">adapt</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/meshfunction" rel="tag" class="qa-tag-link">meshfunction</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/refine" rel="tag" class="qa-tag-link">refine</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/mesh" rel="tag" class="qa-tag-link">mesh</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-avatar">
												<a href="../../user/hernan_mella" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=14920815903966845416&amp;qa_size=50" width="50" height="28" class="qa-avatar-image" alt=""></a>
											</span>
											<span class="qa-q-view-meta">
												<a href="../../8251/adapt-meshfunctions-to-refined-mesh-cpp" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2015-09-30T02:12:18+0000"></span>Sep 30, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Expert</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">19,460</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" id="c8251_list">
											<div class="qa-c-list-item  hentry comment" id="c8253">
												<div class="qa-c-item-content">
													<a name="8253"></a><div class="entry-content"><p>Can you post a full non-working example? The following works for me:</p>

<pre><code>from dolfin import *
mesh = UnitSquareMesh(5,5)
mf = CellFunction("size_t", mesh)
mesh2 = refine(mesh)
mf2 = adapt(mf, mesh2)
</code></pre>

<p>Which version of <code>dolfin</code> are you using? What error are you getting?</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/chris_richardson" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/d779daeb727bcec8f6b2c505810042db?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../8251/adapt-meshfunctions-to-refined-mesh-cpp?show=8253#c8253" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-09-30T08:51:43+0000"></span>Sep 30, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/chris_richardson" class="qa-user-link url nickname">chris_richardson</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">31,740</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c8254">
												<div class="qa-c-item-content">
													<a name="8254"></a><div class="entry-content"><p>Hi, thanks for your reply... a full (but minimalist) non-working example is:</p>

<pre><code>#include &lt;dolfin.h&gt;

using namespace dolfin;

// Inclussion
class Omega0 : public SubDomain
{
  bool inside(const Array&lt;double&gt;&amp; x, bool on_boundary) const
  {
    if (x[1]&lt;=-0.75 &amp;&amp; x[1]&gt;=-1.75 &amp;&amp; std::abs(x[0]) &lt;=1)
      return true;
    else 
      return false;
  }
};

// Mesh dimesions
double b = 0.3, L = 2.5, h = 2.5, Lpml = 1;
Point vertex_1(-(L  +   Lpml), 0);
Point vertex_2(L    +   Lpml, -(h   +   Lpml));

// Density of the mesh
int nx = 40, ny = 0.5*nx;

int main()
{
  // Mesh
  RectangleMesh mesh(vertex_1, vertex_2, nx, ny, "left/right");

  // Create mesh functions over the cells
  MeshFunction&lt;std::size_t&gt; subdomains(mesh, mesh.topology().dim());
  MeshFunction&lt;bool&gt; bool_subdomains(mesh, mesh.topology().dim());
  MeshFunction&lt;double&gt; density(mesh, mesh.topology().dim());

  // Mark all cells subdomains with 0, bool_subdomains with false and density with 1 
  subdomains = 0;
  bool_subdomains = false;
  density = 1.0;

  // Mark on inclusion subdomains with 1, bool_subdomains with true and density with 2 
  Omega0 Omega_0;
  Omega_0.mark(subdomains, 1);
  Omega_0.mark(bool_subdomains, true);
  Omega_0.mark(density, 2.0);

  refine(mesh, mesh, bool_subdomains, true);  // create a refined-mesh overwriting the old mesh

  // HERE IS THE PROBLEM
  adapt(subdomains, mesh);
  adapt(bool_subdomains, mesh);
  adapt(density, mesh); 
}
</code></pre>

<p>Actually i'm using <strong>dolfin 1.6.0</strong> and the error that (that correspond to the "adapt subdomains meshfunction" line) i'm getting is:</p>

<pre><code>error: no matching function for call to 
&#8216;adapt(dolfin::MeshFunction&lt;long unsigned int&gt;&amp;, dolfin::RectangleMesh&amp;)&#8217;
</code></pre>

<p>(A similar error occurs with the other two lines).</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/hernan_mella" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=14920815903966845416&amp;qa_size=20" width="20" height="11" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../8251/adapt-meshfunctions-to-refined-mesh-cpp?show=8254#c8254" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-09-30T13:32:33+0000"></span>Sep 30, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">19,460</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
															<br>
															<span class="qa-c-item-what">edited</span>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="updated"><span class="value-title" title="2015-09-30T13:44:13+0000"></span>Sep 30, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span><span class="qa-c-item-who-data"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c8255">
												<div class="qa-c-item-content">
													<a name="8255"></a><div class="entry-content"><p>You still didn't tell me what is wrong - error message or what?</p>

<p>This should work:</p>

<pre><code>CellFunction&lt;std::size_t&gt; markers(mesh);
Mesh new_mesh;
refine(new_mesh, mesh, false);
adapt(markers, new_mesh);
</code></pre>

<p>Have a look at: <code>demo/undocumented/meshfunction-refinement/cpp/main.cpp</code></p>

<p>You should also set the <code>redistribute</code> flag to be <code>false</code> in <code>refine</code>.</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/chris_richardson" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/d779daeb727bcec8f6b2c505810042db?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../8251/adapt-meshfunctions-to-refined-mesh-cpp?show=8255#c8255" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-09-30T13:49:55+0000"></span>Sep 30, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/chris_richardson" class="qa-user-link url nickname">chris_richardson</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">31,740</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c8256">
												<div class="qa-c-item-content">
													<a name="8256"></a><div class="entry-content"><p>I think it could be because you are overwriting the original mesh. Better to create a new object for it.</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/chris_richardson" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/d779daeb727bcec8f6b2c505810042db?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../8251/adapt-meshfunctions-to-refined-mesh-cpp?show=8256#c8256" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-09-30T13:51:34+0000"></span>Sep 30, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/chris_richardson" class="qa-user-link url nickname">chris_richardson</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">31,740</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c8269">
												<div class="qa-c-item-content">
													<a name="8269"></a><div class="entry-content"><p>I tried to do what you said but I still have problems. Doing exactly what you proposed the following error appears:</p>

<pre><code>no matching function for call to &#8216;adapt(dolfin::MeshFunction&lt;long unsigned int&gt;&amp;, dolfin::Mesh&amp;)&#8217;
</code></pre>

<p>and running the demo <strong>meshfunction-refinement</strong> the size of meshfunctions before and after of the refinement is the same, due that the mesh before and after the refinement using <code>adapt</code> function is the same.</p>

<p>Modifying the demo in two different ways i still have problems. First i tried to do this (on the demo):</p>

<pre><code>// Refine mesh
Mesh newmesh;
newmesh = adapt(mesh, cell_markers);  // Original line: adapt(mesh, cell_markers)

// Adapt cell function to refined mesh
adapt(right_cells, newmesh.child_shared_ptr());  // Original line: adapt(right_cells, mesh.child_shared_ptr());

// Adapt facet function to refined mesh
adapt(inflow_facets, newmesh.child_shared_ptr());  // Original line: adapt(inflow_facets, mesh.child_shared_ptr());
</code></pre>

<p>getting the following error when i try to adapt the meshfunctions:</p>

<pre><code>*** Process received signal ***
Signal: Segmentation fault (11)
Signal code: Address not mapped (1)
Failing at address: 0x2b0
[ 0] /lib/x86_64-linux-gnu/libc.so.6(+0x36d40) [0x7fc038de8d40]
[ 1] /usr/lib/x86_64-linux-gnu/libdolfin.so.1.6(_ZNK6dolfin8MeshData6existsESsm+0) [0x7fc039eb83e0]
[ 2] /usr/lib/x86_64-linux-gnu/libdolfin.so.1.6(_ZN6dolfin5adaptERKNS_12MeshFunctionImEESt10shared_ptrIKNS_4MeshEE+0x4c6) [0x7fc039db47e6]
[ 3] ./demo_meshfunction-refinement(main+0x573) [0x4052d3]
[ 4] /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf5) [0x7fc038dd3ec5]
[ 5] ./demo_meshfunction-refinement() [0x4056fe]
*** End of error message ***
Segmentation fault (core dumped)
</code></pre>

<p>Then i tried to do this:</p>

<pre><code>// Refine mesh
Mesh newmesh;
refine(newmesh, mesh, cell_markers, false);

// Adapt cell function to refined mesh
adapt(right_cells, newmesh.child_shared_ptr());

// Adapt facet function to refined mesh
adapt(inflow_facets, newmesh.child_shared_ptr());
</code></pre>

<p>getting the same error above.</p>

<p>Thank you in advance! </p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/hernan_mella" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=14920815903966845416&amp;qa_size=20" width="20" height="11" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../8251/adapt-meshfunctions-to-refined-mesh-cpp?show=8269#c8269" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-10-02T18:48:33+0000"></span>Oct 2, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">19,460</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
															<br>
															<span class="qa-c-item-what">edited</span>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="updated"><span class="value-title" title="2015-10-02T19:29:39+0000"></span>Oct 2, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span><span class="qa-c-item-who-data"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c8343">
												<div class="qa-c-item-content">
													<a name="8343"></a><div class="entry-content"><p>Recently i've noticed about how works the adapt function... many thanks for your time and sorry for my last reply.   </p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/hernan_mella" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=14920815903966845416&amp;qa_size=20" width="20" height="11" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../8251/adapt-meshfunctions-to-refined-mesh-cpp?show=8343#c8343" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-10-13T22:40:57+0000"></span>Oct 14, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">19,460</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468164-651851fb99e860021eb18b05e8542a2fb5232daa">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a9222">
									<form method="post" action="../../8251/adapt-meshfunctions-to-refined-mesh-cpp">
										<div class="qa-voting qa-voting-net" id="voting_9222">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468164-47b5a5339e5196f54b2f8eddca672e81128f20e5">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../8251/adapt-meshfunctions-to-refined-mesh-cpp">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="9222"></a><div class="entry-content"><p>Hi hernan,</p>

<p>I am having the same problem using:</p>

<pre><code># Refine mesh and adapt mesh function
cf = CellFunction('bool', mesh, True)
mesh_1 = refine(mesh, cf, redistribute=False) 
adapt(subdomains, mesh_1)
</code></pre>

<p>Where subdomains is a MeshFunction on the mesh before refinement. My problem is that if I have a look at the subdomains plot after refinement, nothing is changed, and it seems like the mesh is not refined at all, or at least the adapt function is not working at all.<br>
Do you have some suggestions please?<br>
Thanks!</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../8251/adapt-meshfunctions-to-refined-mesh-cpp?show=9222#a9222" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-02-05T19:24:19+0000"></span>Feb 5, 2016</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Sebastiano" class="qa-user-link url nickname">Sebastiano</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Novice</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">220</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c9222_list">
												<div class="qa-c-list-item  hentry comment" id="c9260">
													<div class="qa-c-item-content">
														<a name="9260"></a><div class="entry-content"><p>Hi, try this:</p>

<pre><code>from dolfin import *

mesh = UnitSquare(30, 30)

class Omega(SubDomain):
  def inside(self, x, on_boundary):
    return x[0]**2 + x[1]**2 &lt;= 0.5**2

Omega = Omega()

cf_bool = CellFunction('bool', mesh)
cf_bool.set_all(False)
cf_size_t = CellFunction('size_t', mesh)
cf_size_t.set_all(0) 

Omega.mark(cf_bool, True)
Omega.mark(cf_size_t, 1)

#plot(mesh, interactive=True)
#plot(cf_size_t, interactive=True)

print "  &gt; Size of MeshFunction before refinement: ", cf_size_t.size()

adapt(mesh, cf_bool)
adapt(cf_size_t, mesh.child())

mesh = mesh.child()
cf_size_t = cf_size_t.child()

#plot(mesh, interactive=True)
#plot(cf_size_t, interactive=True)

print "  &gt; Size of MeshFunction after refinement: ", cf_size_t.size()
</code></pre>

<p>As suggestion, if you want to adapt an <em>"adaptable"</em> object consider (see this issue: <a rel="nofollow" href="https://bitbucket.org/fenics-project/dolfin/issues/319/faulty-memory-management-in-adapt">faulty-memory-management-in-adapt</a>):</p>

<ol>
<li>Don't ever use returned object of any adapt functions! </li>
<li>Access the    result by child() method.</li>
</ol>

<p>Regards!</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/hernan_mella" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=14920815903966845416&amp;qa_size=20" width="20" height="11" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../8251/adapt-meshfunctions-to-refined-mesh-cpp?show=9260#c9260" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-02-09T19:53:26+0000"></span>Feb 9, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">19,460</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
																<br>
																<span class="qa-c-item-what">edited</span>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="updated"><span class="value-title" title="2016-02-10T13:05:30+0000"></span>Feb 10, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span><span class="qa-c-item-who-data"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468164-8d5ca1a7e1e15dff7f1c537e7da3f54a44b6b3d7">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>