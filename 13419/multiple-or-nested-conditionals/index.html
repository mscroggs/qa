<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Multiple (or nested) conditionals - FEniCS Q&amp;A</title>
		<meta name="description" content="Hello, I'm trying to solve a 2D advection-diffusion-reaction problem with a strong non-linear source term that  ... \Delta T^{5.55}\quad \text{for } 0">
		<meta name="keywords" content="conditional,source,piecewise-expression,convection-diffusion">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/13419/multiple-or-nested-conditionals">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Multiple (or nested) conditionals</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q13419">
								<form method="post" action="../../13419/multiple-or-nested-conditionals">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_13419">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467865-e9c4d69f6cb60b554185edaad9799a0328b2b1e7">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../13419/multiple-or-nested-conditionals">
										<div class="qa-q-view-content">
											<a name="13419"></a><div class="entry-content"><p>Hello, I'm trying to solve a 2D advection-diffusion-reaction problem with a strong non-linear source term that is piecewise defined with dependence from the value of a difference of temperature:</p>

<p>$$ q = a\;f(x,y)^{0.566} \Delta T^{0.461}\quad \text{for }\Delta T &gt; 300 $$<br>
$$ q = 1.87\times 10^{-5} \Delta T^{5.55}\quad \text{for } 0 &lt;\Delta T &lt; 300 $$</p>

<p>What I tried so far is:</p>

<pre><code> u = Function(Q)
# [...]
# Non-integer exponent of negative basis gives NaN
# And since the problem is non-linear during Newton iterations
# It can happen that we get a Delta T that is negative
dt = conditional(ge(u - T0), 0), u-T0, 0)  
q = conditional(ge(dt), 300), f1, f2)
</code></pre>

<p>where <code>f1</code> and <code>f2</code> are the two expressions I wrote before. This does not seem to work since I'm getting <code>NaN</code>... If  I use just one conditional I get some results. Any suggestion on how to implement this? </p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/conditional" rel="tag" class="qa-tag-link">conditional</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/source" rel="tag" class="qa-tag-link">source</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/piecewise-expression" rel="tag" class="qa-tag-link">piecewise-expression</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/convection-diffusion" rel="tag" class="qa-tag-link">convection-diffusion</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-avatar">
												<a href="../../user/RdB" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/b2d78193e99f91606839d1bcb2c4993f?s=50" width="50" height="50" class="qa-avatar-image" alt=""></a>
											</span>
											<span class="qa-q-view-meta">
												<a href="../../13419/multiple-or-nested-conditionals" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2017-05-11T15:09:04+0000"></span>May 11, 2017</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/RdB" class="qa-user-link url nickname">RdB</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">220</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
												<br>
												<span class="qa-q-view-what">edited</span>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="updated"><span class="value-title" title="2017-05-12T20:40:41+0000"></span>May 12, 2017</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span><span class="qa-q-view-who-data"><a href="../../user/RdB" class="qa-user-link url nickname">RdB</a></span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c13419_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467865-eb3b504a86401641f3bb8a25ae7d40c2bc3bf042">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a13452">
									<form method="post" action="../../13419/multiple-or-nested-conditionals">
										<div class="qa-voting qa-voting-net" id="voting_13452">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467865-e9c4d69f6cb60b554185edaad9799a0328b2b1e7">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../13419/multiple-or-nested-conditionals">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="13452"></a><div class="entry-content"><p>When you use expressions with exponents you have to remember Newton's method uses the derivative of the forms (which in this case includes your sources). What is the derivative of deltaT^0.461 evaluated at deltaT=0?</p>

<p>To get around this you can either do: deltaT =&gt; deltaT + (small number, i.e. 1.0e-12) which is never 0, or you can change your initial conditions so that at the first time step deltaT is not 0.</p>

<p>You can use the first option to quickly check if this is actually what's causing the problem but the second option will give you a numerically 'exact' solution</p>

<p>The problem with the last option is that you need a proper guess for the initial condition or Newton's method might diverge depending on the problem. You can try a temperature value such that you get a small non-zero value for deltaT.</p>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-meta">
														<a href="../../13419/multiple-or-nested-conditionals?show=13452#a13452" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-05-12T19:06:41+0000"></span>May 12, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/alexmm" class="qa-user-link url nickname">alexmm</a></span></span>
															<span class="qa-a-item-who-title">FEniCS User</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">4,240</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2017-05-13T16:47:14+0000"></span>May 13, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/RdB" class="qa-user-link url nickname">RdB</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c13452_list">
												<div class="qa-c-list-item  hentry comment" id="c13459">
													<div class="qa-c-item-content">
														<a name="13459"></a><div class="entry-content"><p>Thanks, </p>

<p>It was as you said. I imposed a different, non-zero, profile for the temperature and now I'm not experience NaN crash anymore. Thanks, </p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/RdB" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/b2d78193e99f91606839d1bcb2c4993f?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../13419/multiple-or-nested-conditionals?show=13459#c13459" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-13T16:48:02+0000"></span>May 13, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/RdB" class="qa-user-link url nickname">RdB</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">220</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467865-f9de095c03381de77b373ab2d2f60b0d74473a6d">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>