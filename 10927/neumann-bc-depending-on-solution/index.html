<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Neumann BC depending on solution - FEniCS Q&amp;A</title>
		<meta name="description" content="Hello, I have a domain containing two subdoimains and want to apply a Neumann BC on the border between  ...  the cells. Any idea? Thanks a lot! Justus">
		<meta name="keywords" content="subdomains,different-materials,cpp,neumann,boundary-conditions">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/10927/neumann-bc-depending-on-solution">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Neumann BC depending on solution</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q10927">
								<form method="post" action="../../10927/neumann-bc-depending-on-solution">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_10927">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467084-89740edd6237c491a8651824694900384a355b85">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../10927/neumann-bc-depending-on-solution">
										<div class="qa-q-view-content">
											<a name="10927"></a><div class="entry-content"><p>Hello,</p>

<p>I have a domain containing two subdoimains and want to apply a Neumann BC on the border between them.</p>

<p>The function defining the Neumann BC depends on the values of the Solution in both subdomains (or more precisely on their difference).</p>

<p>Is it possible to get the values of a cell which is not the actual visited one?</p>

<p>My UFL-File shows as </p>

<pre><code>cell = triangle

scalar = FiniteElement("Lagrange", cell, 1)

phi = TrialFunction(scalar)
v = TestFunction(scalar)
f = Coefficient(scalar)
g = Coefficient(scalar)
sigma = Coefficient(scalar)

a = -sigma*inner(grad(phi), grad(v))*dx - phi*inner(grad(sigma), grad(v))*dx

L = f*v*dx + g*v*ds
</code></pre>

<p>where g is the function defining the Neumann BC. </p>

<p>I need to define g in a way that I can access the data of other cells (the ones directly on the left and on the right of the border).</p>

<p>Therefore I tried to derive g from <code>dolfin::Expression</code> but I actually do not know how to access the solution-data of the cells.<br>
Any idea?</p>

<p>Thanks a lot!</p>

<p>Justus</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/subdomains" rel="tag" class="qa-tag-link">subdomains</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/different-materials" rel="tag" class="qa-tag-link">different-materials</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/cpp" rel="tag" class="qa-tag-link">cpp</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/neumann" rel="tag" class="qa-tag-link">neumann</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/boundary-conditions" rel="tag" class="qa-tag-link">boundary-conditions</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../10927/neumann-bc-depending-on-solution" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2016-08-18T18:47:59+0000"></span>Aug 18, 2016</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/Pama328" class="qa-user-link url nickname">Pama328</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">480</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" id="c10927_list">
											<div class="qa-c-list-item  hentry comment" id="c10950">
												<div class="qa-c-item-content">
													<a name="10950"></a><div class="entry-content"><p>If I've understood correctly, you want your solution to have a discontinuity across the interface between subdomains? It's not clear from your question how you will allow this discontinuity, considering your code indicates the use of continuous Lagrange elements. Do you have disjoint meshes for the subdomains?</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../10927/neumann-bc-depending-on-solution?show=10950#c10950" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-08-22T11:41:54+0000"></span>Aug 22, 2016</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Magne+Nordaas" class="qa-user-link url nickname">Magne Nordaas</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">13,820</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c10951">
												<div class="qa-c-item-content">
													<a name="10951"></a><div class="entry-content"><p>No I do not want to have discontinuity in the solution.  The solution should be a continuous function for both subdomains which has a to fulfill a condition at the boundary between the subdomains,  defined by the Neumann BC. </p>

<p>This condition is a value depending on the solution in the first subdomain near the boundary and on the solution in the second one near the boundary (evaluated at <code>x[0]-DOLFIN_EPS</code> for the first subdomain and <code>x[0]+DOLFIN_EPS</code> for the second subdomain,  assuming that x is the current position the subdomain-value should be calculated for) </p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../10927/neumann-bc-depending-on-solution?show=10951#c10951" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-08-22T12:03:25+0000"></span>Aug 22, 2016</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Pama328" class="qa-user-link url nickname">Pama328</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Novice</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">480</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c10952">
												<div class="qa-c-item-content">
													<a name="10952"></a><div class="entry-content"><p>If the solution is continuous, won't the values be the same on both sides of the boundary?</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../10927/neumann-bc-depending-on-solution?show=10952#c10952" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-08-22T13:25:55+0000"></span>Aug 22, 2016</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Magne+Nordaas" class="qa-user-link url nickname">Magne Nordaas</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">13,820</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c10953">
												<div class="qa-c-item-content">
													<a name="10953"></a><div class="entry-content"><p>Sorry,  I should have stated that in each subdomain sigma has an unique value and as seen in the UFL File the solution depends on this sigma.  This should cause the solution not to be the same on both subdomains </p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../10927/neumann-bc-depending-on-solution?show=10953#c10953" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-08-22T13:41:10+0000"></span>Aug 22, 2016</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Pama328" class="qa-user-link url nickname">Pama328</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Novice</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">480</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c10965">
												<div class="qa-c-item-content">
													<a name="10965"></a><div class="entry-content"><p>I thought a lot about it yesterday and now I'm thinking a discontinuous solution would be even better.  Which Functionspace would you suggest for this and do you have an idea how to implement the Neumann BC? </p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../10927/neumann-bc-depending-on-solution?show=10965#c10965" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-08-23T08:40:14+0000"></span>Aug 23, 2016</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Pama328" class="qa-user-link url nickname">Pama328</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Novice</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">480</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467084-21fd2fb85c886065e463ed9668ed472f48fccc6e">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a11000">
									<form method="post" action="../../10927/neumann-bc-depending-on-solution">
										<div class="qa-voting qa-voting-net" id="voting_11000">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+3<span class="votes-up"><span class="value-title" title="3"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467084-89740edd6237c491a8651824694900384a355b85">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../10927/neumann-bc-depending-on-solution">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="11000"></a><div class="entry-content"><p>To make the discussion a bit more concrete, consider the problem</p>

<p>$$ \begin{alignat}{2} - \nabla \cdot (a \nabla u) &amp;= f  &amp;&amp;\mbox{in }\Omega \\ u &amp;= 0 &amp;&amp;\mbox{on }\partial\Omega \\ a \nabla u \cdot n &amp;= k[\![u]\!] \quad &amp;&amp;\mbox{on }\Gamma, \end{alignat} $$</p>

<p>where $\Gamma$ is a curve dividing $\Omega$ into two subdomains $\Omega_1$ and $\Omega_2$, $n$ is the unit normal vector on $\Gamma$ pointing into $\Omega_2$, $[\![u]\!]$ is the jump in $u$ going from $\Omega_1$ to $\Omega_2$, and $k\geq 0$.</p>

<p>The variational formulation of the problem in the space $V = H^1_{0,\partial\Omega}(\Omega_1)+H^1_{0,\partial\Omega}(\Omega_2)$ reads </p>

<p>$$ \int_\Omega a \nabla u \cdot v\, dx + \int_\Gamma k [\![u]\!] [\![v]\!]\, ds = \int_\Omega f v \, dx$$</p>

<p>for all $v\in V$. The bilinear form is bounded, symmetric and positive definite for reasonable $a$ and $k$, so the problem is well-posed in $V$.</p>

<p>The ideal way to obtain a numerical solution to the problem would be to define Lagrange finite element spaces $V_{h,1}\subset H^1_{0,\partial\Omega_1}$ and $V_{h,1}\subset H^1_{0,\partial\Omega_2}$, and write down the variation problem on $V_h = V_{h,1} + V_{h,2} \subset V$ and solve. Unfortunately, this is not yet possible in FEniCS.  But there are several ways to get around this limitation, at cost of having to solve a larger linear system.</p>

<p>One way is to adopt a discontinuous Galerkin formulation, as in the <a rel="nofollow" href="https://bitbucket.org/fenics-project/dolfin/src/f2d5966ea5b5e6a99b9d050d307137abf7229427/demo/undocumented/dg-poisson/?at=master">DG-Poisson demo</a>, replacing the standard DG terms on the facets that are on $\Gamma$ with the the term $\int k[\![u]\!][\![v]\!]\, ds$. </p>

<p>A closely related method is to solve a mixed form of the Poisson problem, using discontinuous elements for the scalar field, as in the <a rel="nofollow" href="https://bitbucket.org/fenics-project/dolfin/src/e59505b4f465fb801aabd1429c0c3721ff48b434/demo/documented/mixed-poisson/?at=master">mixed-Poisson demo</a>.</p>

<p>A third way to solve the problem is to let $V_{h,1}$ and $V_{h,2}$ be defined everywhere and implement $V_h$ as a mixed space $V_{h,1}\times V_{h,2}$. This leads to an excess number of dofs that have to be eliminated after assembling the bilinear form. See code example below.</p>

<pre><code>from dolfin import *
from matplotlib import pyplot
parameters["plotting_backend"] = "matplotlib"

N = 32
mesh = UnitSquareMesh(N, N)
x = SpatialCoordinate(mesh)

# indicator functions for the two subdomains
I0 = conditional(x[0] &lt; 0.5, 1, 0)
I1 = conditional(x[0] &gt; 0.5, 1, 0)

# material parameters and source term
c0, c1 = Constant(1.0), Constant(1.0)
c = I0 * c0 + I1 * c1
k = Constant(8.0)


# define exact solution and source term
U0 = 4*x[0]**2
U1 = (1 + 4 * (c0/k)) * 4 * x[0] * (1 - x[0]) \
   + 4 * (c0/c1) * (2*x[0] - 1) * (1 - x[0])
U = (I0 * U0 + I1 * U1) * sin(pi * x[1])

f = - c * div(grad(U))

# define subdomains and cell measure
cell_domains = CellFunction("size_t", mesh)
right = CompiledSubDomain("x[0]&gt;0.5-DOLFIN_EPS")
right.mark(cell_domains, 1)
dx = Measure("dx", domain = mesh, subdomain_data = cell_domains)

# define interface and facet measure
facet_domains = FacetFunction("size_t", mesh)
interface = CompiledSubDomain("fabs(x[0]-0.5)&lt;DOLFIN_EPS")
interface.mark(facet_domains, 1)
dS = Measure("dS", domain = mesh, subdomain_data = facet_domains) 

# define variational forms
W = VectorFunctionSpace(mesh, "CG", 1)
u, v = TrialFunction(W), TestFunction(W)

# dirichlet boundary on the exterior
bc = DirichletBC(W, (0., 0.), "on_boundary")

# cell integrals
a = c0 * inner(grad(u[0]), grad(v[0])) * dx(0) \
  + c1 * inner(grad(u[1]), grad(v[1])) * dx(1) 

L = f * v[0] * dx(0) + f * v[1] * dx(1)

# interface integral
jmp_u = avg(u[0]) - avg(u[1])
jmp_v = avg(v[0]) - avg(v[1])

a  += k * jmp_u * jmp_v * dS(1)

# assemble and eliminate excess dofs
A, b = assemble_system(a, L, bc)
A.ident_zeros()

# solve and compute L^2-error
w = Function(W)
solve(A, w.vector(), b)
L2_error = assemble((U-w[0])**2 * dx(0) + (U-w[1])**2 * dx(1))**.5

print "||u - uh; L^2|| = {0:1.3e}".format(L2_error)

# project to DG0 and plot
V = FunctionSpace(mesh, "DG", 0)
u, v = TrialFunction(V), TestFunction(V)
u_dg = Function(V)
solve(u*v * dx == v*w[0]*dx(0) + v*w[1]*dx(1), u_dg)
plot(u_dg); pyplot.show()
</code></pre>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../10927/neumann-bc-depending-on-solution?show=11000#a11000" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-08-27T17:14:13+0000"></span>Aug 27, 2016</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Magne+Nordaas" class="qa-user-link url nickname">Magne Nordaas</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">13,820</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
													<br>
													<span class="qa-a-item-what">edited</span>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2016-08-27T18:17:34+0000"></span>Aug 27, 2016</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/Magne+Nordaas" class="qa-user-link url nickname">Magne Nordaas</a></span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c11000_list">
												<div class="qa-c-list-item  hentry comment" id="c11046">
													<div class="qa-c-item-content">
														<a name="11046"></a><div class="entry-content"><p>Thanks a lot, the third method is exactly what I have been looking for.</p>

<p>For now my problem is to seperate your code example in a .cpp/.h and a .ufl-File because my whole project is cpp-based.</p>

<p>At the moment I'm stuck at the part </p>

<pre><code># define subdomains and cell measure
cell_domains = CellFunction("size_t", mesh)
right = CompiledSubDomain("x[0]&gt;0.5-DOLFIN_EPS")
right.mark(cell_domains, 1)
dx = Measure("dx", domain = mesh, subdomain_data = cell_domains)

# define interface and facet measure
facet_domains = FacetFunction("size_t", mesh)
interface = CompiledSubDomain("fabs(x[0]-0.5)&lt;DOLFIN_EPS")
interface.mark(facet_domains, 1)
dS = Measure("dS", domain = mesh, subdomain_data = facet_domains) 
</code></pre>

<p>I guess it is a mix between "regular Python expressions" and "UFL-Expression" because there are several functions which are only available in one of both parts.</p>

<p>Thile trying to spereate these parts I was wondering how to represent the <code>CompiledSubDomain</code> class (which is only available in the Python-Interface for FEniCS and not for cpp). </p>

<p>Is it possible two have dynamic boundaries for the Subdomains (for example by defining them  like this:</p>

<pre><code>#Subdomain Beginnings and endings for Dynamic Subdomains
D1_x_b = Constant(continousScalar)
D1_x_e = Constant(continousScalar)
D1_y_b = Constant(continousScalar)
D1_y_e = Constant(continousScalar)

D2_x_b = Constant(continousScalar)
D2_x_e = Constant(continousScalar)
D2_y_b = Constant(continousScalar)
D2_y_e = Constant(continousScalar)

#indicator functions for subdomains
I1 = conditional(x[0]&gt;D1_x_b and x[0]&lt;D1_x_e and x[1]&gt;D1_y_b and x[1]&lt;D1_y_e, 1, 0)
I2 = conditional(x[0]&gt;D2_x_b and x[0]&lt;D2_x_e and x[1]&gt;D2_y_b and x[1]&lt;D2_y_e, 1, 0)
I0 = conditional(not(I1 or I2), 1, 0)
</code></pre>

<p>or should these values be hard-coded as in your example?(mine is not compiling yet))</p>

<p>If it is possible to set these values dynamicly, how would I do the same in </p>

<pre><code>right = CompiledSubDomain("x[0]&gt;0.5-DOLFIN_EPS")
</code></pre>

<p>? Or to be more precicesly: How should the string look in that case?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../10927/neumann-bc-depending-on-solution?show=11046#c11046" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-09-05T13:50:18+0000"></span>Sep 5, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Pama328" class="qa-user-link url nickname">Pama328</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">480</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c11056">
													<div class="qa-c-item-content">
														<a name="11056"></a><div class="entry-content"><p>See the <a rel="nofollow" href="https://bitbucket.org/fenics-project/dolfin/src/e59505b4f465fb801aabd1429c0c3721ff48b434/demo/documented/subdomains/cpp/main.cpp">subdomains demo</a> for how to define subdomains in C++. The Python CompiledSubDomain class is shorthand for compiling a C++ subdomain imlementation. </p>

<p>Also take a look at the <a rel="nofollow" href="https://bitbucket.org/fenics-project/dolfin/src/e59505b4f465fb801aabd1429c0c3721ff48b434/demo/undocumented/dg-poisson/cpp/">DG Poisson demo</a>, it shows how to define restricted measures and attach them to variational forms.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../10927/neumann-bc-depending-on-solution?show=11056#c11056" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-09-07T08:00:23+0000"></span>Sep 7, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Magne+Nordaas" class="qa-user-link url nickname">Magne Nordaas</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">13,820</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467084-c5f2d23ad5b36b1c0bebe70139386853db9329db">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>