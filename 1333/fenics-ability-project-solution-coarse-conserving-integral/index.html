<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Does Fenics have the ability to project a solution onto a coarse mesh while conserving the integral over the domain - FEniCS Q&amp;A</title>
		<meta name="description" content="I am currently trying to solve a heating problem, but I need a very refined mesh to compute  ...  confirm this feature does not exist? Thanks, Sheldon">
		<meta name="keywords" content="mesh,projection,interpolation,supermesh,conservative">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/1333/fenics-ability-project-solution-coarse-conserving-integral">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Does Fenics have the ability to project a solution onto a coarse mesh while conserving the integral over the domain</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q1333">
								<form method="post" action="../../1333/fenics-ability-project-solution-coarse-conserving-integral">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_1333">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467861-56df05388ec4025f1884a2f54db6b71b3f1f0d42">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../1333/fenics-ability-project-solution-coarse-conserving-integral">
										<div class="qa-q-view-content">
											<a name="1333"></a><div class="entry-content"><p>I am currently trying to solve a heating problem, but I need a very refined mesh to compute the heat deposition compared to the coarse mesh in the heat transfer model. I would therefore like to compute a highly detailed  local heat deposition profile, using a restriction, and project this onto a coarse mesh for the bioheat calculation.</p>

<p>So far the restriction and projection works, but the integral of the Power is not conserved between the meshes. This is expected due to the piecewise polynomial structure of the fine mesh not being in the space spanned by the coarse mesh. I know that there are ways to do a conservative projection (interpolation) using a supermesh and suspect something like this may be implemented in the automatic meshing capabilities, but I do not know how to access them or use them for my application.</p>

<p>Would anyone be able to point me in the right direction or confirm this feature does not exist?</p>

<p>Thanks,</p>

<p>Sheldon</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/mesh" rel="tag" class="qa-tag-link">mesh</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/projection" rel="tag" class="qa-tag-link">projection</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/interpolation" rel="tag" class="qa-tag-link">interpolation</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/supermesh" rel="tag" class="qa-tag-link">supermesh</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/conservative" rel="tag" class="qa-tag-link">conservative</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../1333/fenics-ability-project-solution-coarse-conserving-integral" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2013-10-04T13:38:33+0000"></span>Oct 4, 2013</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/sheldonkhall" class="qa-user-link url nickname">sheldonkhall</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">150</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c1333_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467861-d105c4ecee367ccc268967fbaf051e3e3f061de3">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a1361">
									<form method="post" action="../../1333/fenics-ability-project-solution-coarse-conserving-integral">
										<div class="qa-voting qa-voting-net" id="voting_1361">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467861-56df05388ec4025f1884a2f54db6b71b3f1f0d42">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../1333/fenics-ability-project-solution-coarse-conserving-integral">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="1361"></a><div class="entry-content"><p>FEniCS is a programmable environment - you first need to identify the precise mathematical operation that you want to perform. If you know this and present it, then we can suggest how to implement it.</p>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-meta">
														<a href="../../1333/fenics-ability-project-solution-coarse-conserving-integral?show=1361#a1361" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2013-10-07T17:36:04+0000"></span>Oct 7, 2013</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Garth+N.+Wells" class="qa-user-link url nickname">Garth N. Wells</a></span></span>
															<span class="qa-a-item-who-title">FEniCS Expert</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">35,930</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2013-11-08T10:39:54+0000"></span>Nov 8, 2013</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c1361_list">
												<div class="qa-c-list-item  hentry comment" id="c1366">
													<div class="qa-c-item-content">
														<a name="1366"></a><div class="entry-content"><p>Hi Garth,</p>

<p>Thank you for replying. I have put together a simple example to explain more clearly my issue:</p>

<pre><code>"""
Example of non-conservative projection:

The function Sin(5*pi*x[0])**2*Sin(5*pi*x[1])**2 is projected onto a basis of linear
Lagrange elements on the unit square with a fine mesh. An integral is
performed of the FEM representation over the whole domain to compute
the analogue of the energy. The FEM approximation is then projected
onto a coarse mesh and the same integral performed. The results of
the integrals do not agree as the algorithm is not conservative.

"""

from dolfin import *

mesh_fine = UnitSquare(20, 20)
mesh_coarse = UnitSquare(3, 3)

V = FunctionSpace(mesh_fine,'Lagrange',1)
W = FunctionSpace(mesh_coarse,'Lagrange',1)
u = Function(V)
f = Expression('pow(sin(5*pi_*x[0]),2)*pow(sin(5*pi_*x[1]),2)',pi_=pi)

u = interpolate(f, V)

energy = u*dx
E = assemble(energy)
print "The fine mesh integral is: %g" % E

v = Function(W)
v = project(u,W)

energy = v*dx
E = assemble(energy)
print "The coarse mesh integral is: %g" % E
</code></pre>

<p>If you execute this script the two values output for the integral are different. I would really like to know if there is a function that exists in fenics to compute a projection such that the integrals are equal? Perhaps it is in the adaptive meshing libraries?</p>

<p>Thanks,</p>

<p>Sheldon</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../1333/fenics-ability-project-solution-coarse-conserving-integral?show=1366#c1366" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2013-10-08T08:39:35+0000"></span>Oct 8, 2013</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/sheldonkhall" class="qa-user-link url nickname">sheldonkhall</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">150</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467861-069c688933c8e5505fdb22a0b51974dde057f73e">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>