<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Failed to converge in incompressible Navier-Stokes of example from lecture 9, 2013-11-logg - FEniCS Q&amp;A</title>
		<meta name="description" content="I am trying to do the challenge from lecture 9 of the course in Nov-2013 by Logg ([http:// ... html [3]: http://fenicsproject.org/pub/data/meshes/">
		<meta name="keywords" content="navier-stokes,boundary-conditions">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/6986/failed-converge-incompressible-navier-stokes-example-lecture">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Failed to converge in incompressible Navier-Stokes of example from lecture 9, 2013-11-logg</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q6986">
								<form method="post" action="../../6986/failed-converge-incompressible-navier-stokes-example-lecture">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_6986">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468097-f55df2af0be5b9fa61fc0aaca5a49c56a621bd32">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../6986/failed-converge-incompressible-navier-stokes-example-lecture">
										<div class="qa-q-view-content">
											<a name="6986"></a><div class="entry-content"><p>I am trying to do the challenge from lecture 9 of the course in Nov-2013 by Logg (<a rel="nofollow" href="http://fenicsproject.org/pub/course/lectures/"></a><a rel="nofollow" href="http://fenicsproject.org/pub/course/lectures/">http://fenicsproject.org/pub/course/lectures/</a>). The challenge is to implement the incompressible Navier-Stokes on the dolphin mesh, with 1kPa at inflow, and 0kPa at outflow. On the rest of the boundaries, the velocity is set to 0. My approach was to simply start from the sample code in the tutorial for the Lshape tube (<a rel="nofollow" href="http://fenicsproject.org/documentation/dolfin/1.5.0/python/demo/documented/navier-stokes/python/documentation.html">tutorial here</a>), making only the few following changes:</p>

<pre><code># Load mesh from file
mesh = Mesh("../dolfin_fine.xml.gz")
sub_domains = MeshFunction("size_t", mesh, "../dolfin_fine_subdomains.xml.gz")

# Set parameter values
dt = 0.0005
T = 0.1
nu = 0.001002/1000

# Define boundary conditions
noslip = DirichletBC(V, Constant((0,0)), sub_domains, 0)

inflow = DirichletBC(Q, Constant(1000), sub_domains, 1)

outflow = DirichletBC(Q, Constant(0), sub_domains, 2)
</code></pre>

<p>The mesh and its boundary definitions can be downloaded <a rel="nofollow" href="http://fenicsproject.org/pub/data/meshes/">here</a>. <br>
The solution fails to converge, with the following message:</p>

<pre><code>*** Error:   Unable to solve linear system using PETSc Krylov solver.
*** Reason:  Solution failed to converge in 0 iterations (PETSc reason DIVERGED_NANORINF, residual norm ||r|| = inf).
*** Where:   This error was encountered inside PETScKrylovSolver.cpp.
*** Process: unknown
</code></pre>

<p>Could someone tell me what's wrong with my implementation? Thank you in advance.</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/navier-stokes" rel="tag" class="qa-tag-link">navier-stokes</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/boundary-conditions" rel="tag" class="qa-tag-link">boundary-conditions</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../6986/failed-converge-incompressible-navier-stokes-example-lecture" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2015-04-22T14:58:31+0000"></span>Apr 22, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/mikolchon" class="qa-user-link url nickname">mikolchon</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">190</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c6986_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468097-90ba4ebf60193a917134ac650f83bbf5edb1d097">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a7002">
									<form method="post" action="../../6986/failed-converge-incompressible-navier-stokes-example-lecture">
										<div class="qa-voting qa-voting-net" id="voting_7002">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468097-f55df2af0be5b9fa61fc0aaca5a49c56a621bd32">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../6986/failed-converge-incompressible-navier-stokes-example-lecture">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="7002"></a><div class="entry-content"><p>I just found the mistake: the code in the tutorial was actually implementing the Navier-Stokes equation with <em>unity density</em>, therefore it didn't work for the problem I was trying to solve (water properties). After the small correction, the code worked.</p>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-meta">
														<a href="../../6986/failed-converge-incompressible-navier-stokes-example-lecture?show=7002#a7002" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2015-04-28T23:27:18+0000"></span>Apr 29, 2015</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/mikolchon" class="qa-user-link url nickname">mikolchon</a></span></span>
															<span class="qa-a-item-who-title">FEniCS Novice</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">190</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c7002_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468097-53cf24c89c3fff6f4ba3d5c9bb3402d99ac9897f">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>