<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Boundary conditions for constrained optimization - FEniCS Q&amp;A</title>
		<meta name="description" content="I want to solve a PDE-constrained optimization problem $\min f(y,u)$ s.t. $c(y,u)=0$ ...  with my Firefox the Preview seems not to recognize MathJax.">
		<meta name="keywords" content="constrainted,optimization,boundary,conditions">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/7994/boundary-conditions-for-constrained-optimization">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Boundary conditions for constrained optimization</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q7994">
								<form method="post" action="../../7994/boundary-conditions-for-constrained-optimization">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_7994">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468150-b9cda7c318272582c7ec506b95b3519a5397d18e">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../7994/boundary-conditions-for-constrained-optimization">
										<div class="qa-q-view-content">
											<a name="7994"></a><div class="entry-content"><p>I want to solve a PDE-constrained optimization problem $\min f(y,u)$ s.t. $c(y,u)=0$ with homogeneous Dirichlet boundary conditions. In this context it seems like I make some error imposing the boundary conditions. <br>
So this is what I observe: <br>
Everything works fine when I implement the Lagrangian as <br>
$$ L(y,u,p) = f(y,u) + pc(y,u) + 10^9\int_\Gamma y(s)p(s)ds,$$<br>
i. e. if I incorporate Dirichlet boundary conditions with the help of a penalty term. </p>

<p>Now, if I implement the Lagrangian as<br>
$$ L(y,u,p) = f(y,u) + pc(y,u)$$ and explicitly set boundary conditions via<br>
DirichletBC bcy{V[0], y0, boundary}; // boundary condition for state variable<br>
DirichletBC bcp{V[2], p0, boundary}; // boundary condition for adjoint variable<br>
my solver does not converge any more. I assume that in this case calling bc.apply will affect <br>
the diagonal matrix blocks instead of the blocks related to state and adjoint equation. </p>

<p>Am I right about this? If so is there a way to correctly set the boundary conditions for my needs? </p>

<p>Best Regards</p>

<p>P.S.: At least with my Firefox the Preview seems not to recognize MathJax.</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/constrainted" rel="tag" class="qa-tag-link">constrainted</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/optimization" rel="tag" class="qa-tag-link">optimization</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/boundary" rel="tag" class="qa-tag-link">boundary</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/conditions" rel="tag" class="qa-tag-link">conditions</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../7994/boundary-conditions-for-constrained-optimization" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2015-09-01T13:19:23+0000"></span>Sep 1, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/nahabba" class="qa-user-link url nickname">nahabba</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">190</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c7994_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468150-c389a006b3452f74a70ec146b28b1a78aad88813">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a7996">
									<form method="post" action="../../7994/boundary-conditions-for-constrained-optimization">
										<div class="qa-voting qa-voting-net" id="voting_7996">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468150-b9cda7c318272582c7ec506b95b3519a5397d18e">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../7994/boundary-conditions-for-constrained-optimization">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="7996"></a><div class="entry-content"><p>DirichletBC.apply will set the relevant diagonal entries to 1 and set off-diagonal entries on the same rows (across all blocks) to zero. This will correctly enforce the boundary conditions for the system of equations. You can use assemble_system instead of assemble if you wish to preserve symmetry.</p>

<p>Here is a complete python example implementing a simple PDE-constrained optimization problem. The problem is solved in one Newton iteration.</p>

<pre><code>from dolfin import *

mesh = UnitSquareMesh(16,16)
a = Constant(1e-4)

V = FunctionSpace(mesh, "CG", 1)
W = MixedFunctionSpace([V, V, V])

bcs = [DirichletBC(W.sub(1), 0., "on_boundary"),
       DirichletBC(W.sub(2), 0., "on_boundary")]

w = Function(W); u, y, p = split(w)

f = (1-y)**2 * dx + a * u**2 * dx
L = f + inner(grad(y), grad(p)) * dx - u * p * dx

dL = derivative(L, w)
H  = derivative(dL, w)

u, y, p = w.split()
solve(H == -dL, w, bcs)
</code></pre>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../7994/boundary-conditions-for-constrained-optimization?show=7996#a7996" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2015-09-01T15:34:28+0000"></span>Sep 1, 2015</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Magne+Nordaas" class="qa-user-link url nickname">Magne Nordaas</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">13,820</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c7996_list">
												<div class="qa-c-list-item  hentry comment" id="c8001">
													<div class="qa-c-item-content">
														<a name="8001"></a><div class="entry-content"><p>Thanks for your answer. Do I understand correctly that this yields different matrices describing the differential operator depending on where it is used, since the diagonal of the complete system is considered?<br>
If it is used in a PDE context, then the diagonal entries, associated with dofs on the boundary, of the stiffness matrix are set to one.<br>
If it used in an optimal control context, then the differential operator is not on the diagonal and thus its diagonal entries, related to the boundary, in its discretization will be set to zero. <br>
Thus to clarify my initial question: The application of the boundary conditions affects all blocks, but the stiffness matrix gets modified differently depending on its appearance in a PDE or optimal control context?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../7994/boundary-conditions-for-constrained-optimization?show=8001#c8001" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-09-02T11:12:43+0000"></span>Sep 2, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/nahabba" class="qa-user-link url nickname">nahabba</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">190</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c8007">
													<div class="qa-c-item-content">
														<a name="8007"></a><div class="entry-content"><p>That is correct.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../7994/boundary-conditions-for-constrained-optimization?show=8007#c8007" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-09-03T10:06:36+0000"></span>Sep 3, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Magne+Nordaas" class="qa-user-link url nickname">Magne Nordaas</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">13,820</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468150-6994b99efeb8a5b5d00337453061a4da63cb896e">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>