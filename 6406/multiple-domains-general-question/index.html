<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Multiple Domains General Question - FEniCS Q&amp;A</title>
		<meta name="description" content="Hi everybody I use fenics for acoustic simulations and I want to know, if and how it is possible ... the right direction/to the right demo. Thank you!">
		<meta name="keywords" content="multiple,domains,subdomain,submesh,interface">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/6406/multiple-domains-general-question">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Multiple Domains General Question</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q6406">
								<form method="post" action="../../6406/multiple-domains-general-question">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_6406">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+4<span class="votes-up"><span class="value-title" title="4"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468070-637072d753ffd97a915583a25169013060f27d5f">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../6406/multiple-domains-general-question">
										<div class="qa-q-view-content">
											<a name="6406"></a><div class="entry-content"><p>Hi everybody</p>

<p>I use fenics for acoustic simulations and I want to know, if and how it is possible to have two domains with two different sets of equations and some interface conditions in between.</p>

<p>For example an oscillating structure (mechanical domain) which radiates sound (acoustic domain) or an absorber (damped Helmholtz equation) in air (Helmholtz equation).</p>

<p>Could somebody please just point me in the right direction/to the right demo.</p>

<p>Thank you!</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/multiple" rel="tag" class="qa-tag-link">multiple</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/domains" rel="tag" class="qa-tag-link">domains</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/subdomain" rel="tag" class="qa-tag-link">subdomain</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/submesh" rel="tag" class="qa-tag-link">submesh</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/interface" rel="tag" class="qa-tag-link">interface</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../6406/multiple-domains-general-question" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2015-01-29T08:47:25+0000"></span>Jan 29, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/PaulR" class="qa-user-link url nickname">PaulR</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">420</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" id="c6406_list">
											<div class="qa-c-list-item  hentry comment" id="c6412">
												<div class="qa-c-item-content">
													<a name="6412"></a><div class="entry-content"><p>Hi PaulR,</p>

<p>I think you can assemble different equations on different domains once you have mesh function on cells of the mesh, i.e., the labels on the cells. Then you can use dx(label) to tell the compiler to integrate only on cells with that label. I do not have complete demo, but i am sure this works.</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../6406/multiple-domains-general-question?show=6412#c6412" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-01-29T16:32:12+0000"></span>Jan 29, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/jying" class="qa-user-link url nickname">jying</a></span></span>
																<span class="qa-c-item-who-title">FEniCS User</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,020</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c6422">
												<div class="qa-c-item-content">
													<a name="6422"></a><div class="entry-content"><p>Thank you for your comment. After a lot of trial and error I finally have some working code with two subdomains and two submeshes.</p>

<p>But how do I create and solve <strong>one</strong> system of equations from <strong>both</strong> subdomains and how do I set the interface conditions?</p>

<p>Could you please just point me into the right direction again?</p>

<p>Here is my code:</p>

<pre><code>import math as m
import numpy as np
from dolfin import *

################################################################################
# set measurements and create mesh
thickness = 0.1
length = 0.3

Lx = length
Ly = 0.01
Lz = 0.01
Nx = 360
Ny = 1
Nz = 1
mesh = BoxMesh(0., 0., 0., Lx, Ly, Lz, Nx, Ny, Nz)

# simulation name
simname = 'test'

################################################################################
# set periodic boundary conditions and create constrained function space
class PeriodicDomain(SubDomain):
    # set periodic boundary conditions

    def inside(self, x, on_boundary):
        # return True if on left or bottom boundary AND NOT on one of the two
        # slave edges
        return bool((near(x[1], 0) or near(x[2], 0.)) and
                    (not ((near(x[1], Ly) and near(x[2], 0.)) or
                     (near(x[1], 0) and near(x[2], Lz)))) and on_boundary)

    def map(self, x, y):
        if near(x[1], Ly) and near(x[2], Lz):
            y[0] = x[0]
            y[1] = x[1] - Ly
            y[2] = x[2] - Lz
        elif near(x[1], Ly):
            y[0] = x[0]
            y[1] = x[1] - Ly
            y[2] = x[2]
        elif near(x[2], Lz):
            y[0] = x[0]
            y[1] = x[1]
            y[2] = x[2] - Lz
        else:
            y[0] = -1000
            y[1] = -1000
            y[2] = -1000

periodicdomain = PeriodicDomain()

# ################################################################################

class Air(SubDomain):
    def inside(self, x, on_boundary):
        return x[0] &gt;= thickness

class Absorber(SubDomain):
    def inside(self, x, on_boundary):
        return x[0] &lt;= thickness

class ABC_Sommerfeld(SubDomain):
    def inside(self, x, on_boundary):
        return on_boundary and near(x[0], Lx)

air = Air()
absorber = Absorber()
abcs = ABC_Sommerfeld()

# create sumdomains
domains = CellFunction('size_t', mesh)
domains.set_all(0)
absorber.mark(domains, 1)
air.mark(domains, 2)

# create submeshes
abs_mesh = SubMesh(mesh, domains, 1)
air_mesh = SubMesh(mesh, domains, 2)

# create subdomains of submeshes
abssubdomains = CellFunction('size_t', abs_mesh)
abssubdomains.set_all(0)
dx_abssubdomain = Measure('dx')[abssubdomains]

airsubdomains = CellFunction('size_t', air_mesh)
airsubdomains.set_all(0)
dx_airsubdomain = Measure('dx')[airsubdomains]

air_boundaries = FacetFunction('size_t', air_mesh)
air_boundaries.set_all(0)
abcs.mark(air_boundaries, 1)
ds_air = Measure('ds')[air_boundaries]

# create two independent function spaces
W_air = FunctionSpace(air_mesh, 'Lagrange', 2, constrained_domain=periodicdomain)
W2_air = W_air * W_air
W_abs = FunctionSpace(abs_mesh, 'Lagrange', 2, constrained_domain=periodicdomain)
W2_abs = W_abs * W_abs

################################################################################
# Define constants and expressions for variational problem
c = 343.4
rho = 1.204
xi = 15000.
kappa = 1.5
sigma = 0.99

zr = Constant(kappa)
zi = Constant(-xi*sigma/(rho))

################################################################################
frequencies = np.array([3000.])
# frequencies = np.arange(20, 5624, 20)
for frequency in frequencies:
    print frequency

    omega = 2.*m.pi*frequency
    agemo = Constant(1./omega)
    k = omega/c

    p0r = 1.
    p0i = 1.
    f1 = Expression('2*k_*p0i_', k_=k, p0i_=p0i)
    f2 = Expression('2*k_*p0r_', k_=k, p0r_=p0r)
    ksquared = Constant(k**2.)
    k = Constant(k)

    (pr_abs, pi_abs) = TrialFunction(W2_abs)
    (pr_air, pi_air) = TrialFunction(W2_air)
    (w1_abs, w2_abs) = TestFunction(W2_abs)
    (w1_air, w2_air) = TestFunction(W2_air)

    # absorber
    a1 = (pr_abs*zr*w1_abs*ksquared - zi*agemo*pi_abs*w1_abs*ksquared + 
         zi*agemo*pr_abs*w2_abs*ksquared + zr*pi_abs*w2_abs*ksquared -
         inner(nabla_grad(pr_abs), nabla_grad(w1_abs)) - 
         inner(nabla_grad(pi_abs), nabla_grad(w2_abs)))*dx_abssubdomain(0)

    # air
    a2 = (pr_air*w1_air*ksquared  + pi_air*w2_air*ksquared -
         inner(nabla_grad(pr_air), nabla_grad(w1_air)) - 
         inner(nabla_grad(pi_air), nabla_grad(w2_air)))*dx_airsubdomain(0)

    a3 = (k*pi_air*w1_air - k*pr_air*w2_air)*ds_air(1) 
    a = a2 + a3
    L1 = f1*w1_air*ds_air(1) - f2*w2_air*ds_air(1)

    A_air = assemble(a, exterior_facet_domains=air_boundaries)
#     A_abs = assemble(a1)

    b_air = assemble(L1, exterior_facet_domains=air_boundaries)

    # Compute solution
    p_air = Function(W2_air)
    P_air = p_air.vector()
    solve(A_air, P_air, b_air)
    pr_air, pi_air = p_air.split()

#     p_abs = Function(W2_abs)
#     P_abs = p_abs.vector()
#     solve(A_abs, P_abs)
#     pr_abs, pi_abs = p_abs.split()

    plot(pr_air)
    plot(pi_air)
#     plot(pr_abs)
#     plot(pi_abs)
    interactive()
</code></pre>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../6406/multiple-domains-general-question?show=6422#c6422" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-01-30T15:06:32+0000"></span>Jan 30, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/PaulR" class="qa-user-link url nickname">PaulR</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Novice</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">420</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c6424">
												<div class="qa-c-item-content">
													<a name="6424"></a><div class="entry-content"><p>Do you mean you have more than one equations on each subdomains? If this is the case, I am not exactly sure (did not test this before), but you can use MixedFunctionSpace to declare the function space you need and then proceed as the normal case by using each function component corresponding to different equations. Interface conditions for each equations then can be coupled into equations just during the formulations of variational problem. I am also learning using FEniCS. Sorry if this cannot help you.</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../6406/multiple-domains-general-question?show=6424#c6424" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-01-30T18:05:56+0000"></span>Jan 30, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/jying" class="qa-user-link url nickname">jying</a></span></span>
																<span class="qa-c-item-who-title">FEniCS User</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,020</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468070-4b9e209db2212376d60d3fe21654a4d2bc8c66e3">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title" style="display:none;"></h2>
							<div class="qa-a-list" id="a_list">
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>