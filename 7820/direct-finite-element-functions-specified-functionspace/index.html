<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Direct access to the finite-element basis functions of a pre-specified FunctionSpace - FEniCS Q&amp;A</title>
		<meta name="description" content="I need to get direct access to the finite-element basis functions (of Continuous-Galerkin type,  ...  someone could advise me on these three issues.">
		<meta name="keywords" content="finite-element-space,mesh,integration,dofs">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/7820/direct-finite-element-functions-specified-functionspace">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Direct access to the finite-element basis functions of a pre-specified FunctionSpace</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q7820">
								<form method="post" action="../../7820/direct-finite-element-functions-specified-functionspace">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_7820">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+2<span class="votes-up"><span class="value-title" title="2"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468140-d16260e48f086fed16ed54512e70cb929643e244">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../7820/direct-finite-element-functions-specified-functionspace">
										<div class="qa-q-view-content">
											<a name="7820"></a><div class="entry-content"><p>I need to get direct access to the finite-element basis functions (of Continuous-Galerkin type, degree 1) on a structured mesh over the unit square $\Omega := [0,1] \times [0,1]$.</p>

<p>I have made the following initializations:</p>

<pre><code>from dolfin import *

nx = 3
ny = 3

mesh_obj = UnitSquareMesh(nx, ny)

V = FunctionSpace(mesh_obj, "CG", 1)

explicit_func = Expression(&#8217;1 + x[0]*x[0] + 2*x[1]*x[1]&#8217;)
explicit_func_proj = project(explicit_func, V)
</code></pre>

<p>and I would like to:</p>

<p>a) ask for confirmation if the mathematical description of the <code>V</code> (defined above) is "the set of $v \in C(\overline{\Omega})$ such that $v$ is affine on each triangle defined by <code>mesh_obj</code> with $v|_{\partial \Omega}$ is arbitrary"; if not, what is the correct mathematical description of the <code>V</code> which was defined above?</p>

<p>b) obtain a Python list with all finite-element basis functions $(\phi_j)_{j=1}^N$ for the vector space <code>V</code> (in order to be able to compute the quantities $\int_\Omega \phi_j \phi_k \, dx$ for all $j, k = 1, ..., N$)</p>

<p>c) compute the numbers $(c_j)_{j=1}^N$ such that <code>explicit_func_proj</code> equals $\sum_{j=1}^N c_j \phi_j$</p>

<p>I would appreciate it very much it if someone could advise me on these three issues.</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/finite-element-space" rel="tag" class="qa-tag-link">finite-element-space</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/mesh" rel="tag" class="qa-tag-link">mesh</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/integration" rel="tag" class="qa-tag-link">integration</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/dofs" rel="tag" class="qa-tag-link">dofs</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../7820/direct-finite-element-functions-specified-functionspace" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2015-08-15T09:19:18+0000"></span>Aug 15, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/kdma-at-dtu" class="qa-user-link url nickname">kdma-at-dtu</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">590</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c7820_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468140-9b48d9e9bbb123660387e9e59eea09ffe5845bce">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a7821">
									<form method="post" action="../../7820/direct-finite-element-functions-specified-functionspace">
										<div class="qa-voting qa-voting-net" id="voting_7821">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468140-d16260e48f086fed16ed54512e70cb929643e244">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../7820/direct-finite-element-functions-specified-functionspace">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="7821"></a><div class="entry-content"><p>You should be aware that while FEniCS follows an elegant symbolic approach, the underlying data structures for the matrices and vectors are in most cases still accessible. When you work through the tutorials this is explained in some detail. That being said, you never really need to have access to the basis functions for basic tasks. This is something which you may only need if you consider writing non-standard assemblers, e.g., for stabilizations which cannot be formulated using the UFL of for implementing things like limiters, postprocessings, etc..</p>

<p>Regarding your questions:</p>

<p>a) yes, the CG1 is simply the space of continuous piecewise linear functions. Boundary conditions are treated by adding the additional constraints in the assembly stage.</p>

<p>b) if you just want to obtain the entries of the mass matrix, why don't you just compute it using the usual workflow, i.e., assemble the form <code>u*v*dx</code> (u and v are trial and test functions, respectively) into a sparse matrix M and extract the components from there? You don't really need to have access to the local function spaces for that, neither do you have to assemble these integrals individually. Of course, you can create hat functions and compute the global integrals using assemble, but this is extremely inefficient compared to assembling everything in one sweep.</p>

<p>c) looks like you just want to access the components of an interpolation. This can again be done by accessing the underlying vector of a function.</p>

<p>I don't have FEniCS on the machine where I am writing this, but given these pointers you should be able to search for help. Everything I said above was covered in this Q&amp;A sometime and some basic things like matrix assembly etc. are treated in the respective lessons of the tutorial.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../7820/direct-finite-element-functions-specified-functionspace?show=7821#a7821" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2015-08-15T10:25:56+0000"></span>Aug 15, 2015</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Christian+Waluga" class="qa-user-link url nickname">Christian Waluga</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">12,310</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
													<br>
													<span class="qa-a-item-what">edited</span>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2015-08-15T10:34:42+0000"></span>Aug 15, 2015</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/Christian+Waluga" class="qa-user-link url nickname">Christian Waluga</a></span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c7821_list">
												<div class="qa-c-list-item  hentry comment" id="c7834">
													<div class="qa-c-item-content">
														<a name="7834"></a><div class="entry-content"><p>Thank you for your suggestions. </p>

<p>In order to make sure that I've taken the correct message away, I would like to ask some clarifying questions about the following block of code, if I may:</p>

<pre><code>from dolfin import *

nx = 3
ny = 3

mesh_obj = UnitSquareMesh(nx, ny)

V = FunctionSpace(mesh_obj, "CG", 1)

u = TrialFunction(V)
v = TrialFunction(V)

a = u*v*dx
# compute the stiffness/mass matrix associated with 
# the bilinear form a
A = assemble(a)
A_array = A.array()

explicit_func = Expression(&#8217;1 + x[0]*x[0] + 2*x[1]*x[1]&#8217;)
explicit_func_proj = project(explicit_func, V)
explicit_func_proj_arr = explicit_func_proj.vector().array()
</code></pre>

<p>d) If the dimension of the finite-element vector space <code>V</code> is $N$, is it true that $N$ equals <code>len(explicit_func_proj_arr)</code>?</p>

<p>e) If $(\varphi_j)_{j=1}^N$ is the finite-element basis for the vector space <code>V</code>, is it true that the value of $\int_{\Omega} \varphi_j \varphi_k \, dx$ is stored in <code>A_array[j][k]</code>?</p>

<p>f) Does <code>explicit_func_proj_arr</code> hold the numbers $(c_j)_{j=1}^N$, which were introduced in question c) from my initial post?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../7820/direct-finite-element-functions-specified-functionspace?show=7834#c7834" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-08-17T08:34:25+0000"></span>Aug 17, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/kdma-at-dtu" class="qa-user-link url nickname">kdma-at-dtu</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">590</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c7859">
													<div class="qa-c-item-content">
														<a name="7859"></a><div class="entry-content"><p>Three times yes, but be aware that the numbering of degrees of freedom must not necessarily coincide with the numbering of vertices in the mesh. There is however a mapping from vertices to DOFs available (search this site for details). I am also not sure if A.array (numpy) is dense or sparse... You should check this and maybe also have a look on how to access the linear algebra backend directly.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../7820/direct-finite-element-functions-specified-functionspace?show=7859#c7859" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-08-19T21:44:30+0000"></span>Aug 19, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Christian+Waluga" class="qa-user-link url nickname">Christian Waluga</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">12,310</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c8102">
													<div class="qa-c-item-content">
														<a name="8102"></a><div class="entry-content"><p>@Christian Waluga: (Overly delayed) Thanks for the feedback!</p>

<p>Regarding your comment that "the numbering of degrees of freedom must not necessarily coincide with the numbering of vertices in the mesh": does this refer to <code>explicit_func_proj_arr</code>? </p>

<p>If yes, is MiroK's answer from <a rel="nofollow" href="http://fenicsproject.org/qa/4045/dofmap-and-nodal-solutions?show=4045#q4045">http://fenicsproject.org/qa/4045/dofmap-and-nodal-solutions?show=4045#q4045</a> what you had in mind (in order to create a  two-dimensional <code>numpy</code> array <code>X</code> of shape $N$-by-$2$, where $N$ is the same as in d) from my post on August 17, so that the value of <code>explicit_func</code> at the point <code>X[k]</code> is stored in <code>explicit_func_proj_arr[k]</code> for $k = 1, ..., N$.)?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../7820/direct-finite-element-functions-specified-functionspace?show=8102#c8102" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-09-11T07:57:49+0000"></span>Sep 11, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/kdma-at-dtu" class="qa-user-link url nickname">kdma-at-dtu</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">590</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468140-1bbab7868c403143f970143f504c5e37ac03f966">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>