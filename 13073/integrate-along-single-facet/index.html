<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>integrate along single facet - FEniCS Q&amp;A</title>
		<meta name="description" content="Hi, I would like to integrate the quantity avg(u) of a discontinuous solution 'u' across a single  ... this. How would I go about this? Best, Stein">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/13073/integrate-along-single-facet">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">integrate along single facet</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q13073">
								<form method="post" action="../../13073/integrate-along-single-facet">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_13073">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467852-515d0cfa6e531b5cdb80c52667dd3eb9d17c58f6">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../13073/integrate-along-single-facet">
										<div class="qa-q-view-content">
											<a name="13073"></a><div class="entry-content"><p>Hi,</p>

<p>I would like to integrate the quantity avg(u) of a discontinuous solution 'u' across a single facet in my mesh, but cant seem to figure out how to do this. How would I go about this?</p>

<p>Best,<br>
Stein</p>
</div>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../13073/integrate-along-single-facet" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2017-04-14T20:39:02+0000"></span>Apr 14, 2017</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/Stein" class="qa-user-link url nickname">Stein</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">190</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" id="c13073_list">
											<div class="qa-c-list-item  hentry comment" id="c13085">
												<div class="qa-c-item-content">
													<a name="13085"></a><div class="entry-content"><p>Is it a single facet of an element in particular or is it a particular face of, say, a square?</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/nabarnaf" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=6623124104544180019&amp;qa_size=20" width="20" height="14" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../13073/integrate-along-single-facet?show=13085#c13085" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-16T04:54:50+0000"></span>Apr 16, 2017</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/nabarnaf" class="qa-user-link url nickname">nabarnaf</a></span></span>
																<span class="qa-c-item-who-title">FEniCS User</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,940</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c13099">
												<div class="qa-c-item-content">
													<a name="13099"></a><div class="entry-content"><p>Essentially I just want to loop over all edges/facets in the mesh, and do a certain integration</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../13073/integrate-along-single-facet?show=13099#c13099" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-17T03:20:59+0000"></span>Apr 17, 2017</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Stein" class="qa-user-link url nickname">Stein</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Novice</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">190</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467852-2b95e120645cbdf6a011f7dcb126a39170f770cc">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a13170">
									<form method="post" action="../../13073/integrate-along-single-facet">
										<div class="qa-voting qa-voting-net" id="voting_13170">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467852-515d0cfa6e531b5cdb80c52667dd3eb9d17c58f6">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../13073/integrate-along-single-facet">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="13170"></a><div class="entry-content"><p>What about this:</p>

<pre><code>from dolfin import *
import numpy as np

V = FunctionSpace(UnitSquareMesh(4,4, 'crossed'), 'DG', 0)
f = Expression("x[0]", degree=1)
u = project(f, V)

mf = MeshFunctionSizet(V.mesh(), 1, 0)  # Default value for facets is set to 0
facet_ids = np.zeros(V.mesh().num_facets(), dtype=np.uintp)
facet_ids[::6] = 1   # &lt;&lt;---- Mark those you want
mf.set_values(facet_ids)  # Mark your facet ids with 1
# Alternatively:
#mf.set_value(one_facet_id, 1)

assemble(avg(u)*dS(subdomain_data=mf, subdomain_id=1)) 
</code></pre>

<p>And (bonus! ;) in case you want to check what facets you are marking, you can use this:</p>

<pre><code>import matplotlib.pyplot as pl
def plot_facets(mesh:Mesh, ids:list):
    """ Plots the mesh and highlights the facets given by ids."""
    plot(mesh, alpha=0.5)
    coords = mesh.coordinates()
    for fid in ids:
        f = Facet(mesh, fid)
        v1, v2 = f.entities(0)
        cc = np.vstack(coords[[v1,v2]])
        pl.plot(cc[:,0], cc[:,1], c='red')

plot_facets(V.mesh(), np.where(facet_ids == 1)[0])
</code></pre>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-avatar">
														<a href="../../user/mdbenito" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/6545a7c3ba26a36c62facacf39cb4b51?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
													</span>
													<span class="qa-a-item-meta">
														<a href="../../13073/integrate-along-single-facet?show=13170#a13170" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-04-22T07:45:45+0000"></span>Apr 22, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/mdbenito" class="qa-user-link url nickname">mdbenito</a></span></span>
															<span class="qa-a-item-who-title">FEniCS User</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">4,530</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2017-04-25T15:20:25+0000"></span>Apr 25, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/Stein" class="qa-user-link url nickname">Stein</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c13170_list">
												<div class="qa-c-list-item  hentry comment" id="c13200">
													<div class="qa-c-item-content">
														<a name="13200"></a><div class="entry-content"><p>Thanks for having a look at this. Your approach seems very promising. But i'm getting the error "Unable to extract all indices". I'm not very confident about my own understanding of the internal workings of MeshFunctions. However, shouldnt it be:</p>

<pre><code>facet_ids[6] = 1
</code></pre>

<p>Instead of </p>

<pre><code>facet_ids[::6] = 1
</code></pre>

<p>And why aren't we using a FacetFunction instead of a MeshFunction? <br>
I still cant get it to work though. Right now I am interested in comparing integrals across facets of an element, so:</p>

<pre><code>mf = MeshFunctionSizet(V.mesh(), 1, 0)
for c in cells(V.mesh()):
    print "Cell:", c.index()
    for fct in facets(c):
        facet_ids = np.zeros(V.mesh().num_facets(), dtype=np.uintp)
        facet_ids[fct.index()] = 1
        mf.set_values(facet_ids)

        print assemble((avg(u))*dS(subdomain_data=mf, subdomain_id=1))
    print ''
</code></pre>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13073/integrate-along-single-facet?show=13200#c13200" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-24T23:12:46+0000"></span>Apr 25, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Stein" class="qa-user-link url nickname">Stein</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">190</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13205">
													<div class="qa-c-item-content">
														<a name="13205"></a><div class="entry-content"><p>I suppose there will be some more efficient way of doing it, but your code does work for me. (But if I may suggest a micro-optimization: you can declare <code>facet_ids</code> before the loops to avoid constructing it in every iteration if you reset the only value that changed after the assembly: <code>facet_ids[fct.index()] = 0</code>. Of course the cost is negligible but hey... ;)</p>

<p>Also: <code>facet_ids[::6]</code> is just taking every sixth element of the array, it was just an example.</p>

<p>And yes <code>FacetFunctionSizet</code> should work exactly the same (you just don't need to specify the dimension anymore, so the call would be <code>mf = FacetFunctionSizet(V.mesh(), 0)</code>), I just wanted to demo the more general concept.</p>

<p>Good luck!</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/mdbenito" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/6545a7c3ba26a36c62facacf39cb4b51?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../13073/integrate-along-single-facet?show=13205#c13205" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-25T06:40:59+0000"></span>Apr 25, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/mdbenito" class="qa-user-link url nickname">mdbenito</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,530</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13219">
													<div class="qa-c-item-content">
														<a name="13219"></a><div class="entry-content"><p>In my implementation, which failed, I was accidentally using a trialfunction instead of a regular function for 'u'. Hence the error message. Now its working. I'm not too worried about optimization as I just mean to do some simple analysis on a very coarse mesh for some benchmark problems.<br>
Thanks for your help!</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13073/integrate-along-single-facet?show=13219#c13219" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-25T15:20:21+0000"></span>Apr 25, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Stein" class="qa-user-link url nickname">Stein</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">190</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467852-3204c0c1b65efc3c3ebd89449193cf322e57ad38">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>