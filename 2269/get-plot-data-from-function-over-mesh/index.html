<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Get/Plot data from function over mesh - FEniCS Q&amp;A</title>
		<meta name="description" content="Dear all. I want to solve a time dependent problem where I have a function f1 which depends on a  ...  is not the same (in general). Cheers, Mischa">
		<meta name="keywords" content="plot,mesh,function,expression">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/2269/get-plot-data-from-function-over-mesh">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Get/Plot data from function over mesh</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q2269">
								<form method="post" action="../../2269/get-plot-data-from-function-over-mesh">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_2269">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467920-8cca35b0b26e720b6a4afb03f345407cb624eed4">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../2269/get-plot-data-from-function-over-mesh">
										<div class="qa-q-view-content">
											<a name="2269"></a><div class="entry-content"><p>Dear all.<br>
I want to solve a time dependent problem where I have a function f1 which depends on a second function f2. Both functions are evaluated in the mesh coordinates.</p>

<pre><code>def f2(x, y, f1):
  value = numpy.empty(1, dtype=float)     
  if f1(x,y) &lt;= 0 + DOLFIN_EPS:
     value[0] = 1           
  elif f1(x,y) &gt;= 0 - DOLFIN_EPS:
     value[0] = 2 
  return value
</code></pre>

<p>[...]</p>

<pre><code>coor = mesh.coordinates()
number = len(coor)
f2_vector = numpy.empty(number, dtype=float)
for i in range(number):
   f2_vector[i] = f2(coor[i][0], coor[i][1], f1)
</code></pre>

<p>My problem is now the following: I want to plot the data given by function f2 against the mesh. Obviously, the data of f2 is not of the "correct" type for doing this (because f2 is not an expression etc but a vector). So here is my question: How can I plot the obtained data against the mesh? If I use an expression for f2 instead of a function, I cannot pass the (time-dependent function) f1.</p>

<p>I tried a quick workaround similar to the example in the "FEniCS Tutorial" by using a help function w and override the entries w.vector() but the order of the values is not the same (in general).</p>

<p>Cheers,<br>
Mischa</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/plot" rel="tag" class="qa-tag-link">plot</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/mesh" rel="tag" class="qa-tag-link">mesh</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/function" rel="tag" class="qa-tag-link">function</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/expression" rel="tag" class="qa-tag-link">expression</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../2269/get-plot-data-from-function-over-mesh" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2014-01-15T15:23:24+0000"></span>Jan 15, 2014</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/mischa" class="qa-user-link url nickname">mischa</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">240</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c2269_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467920-a57966a689573cad4037577886fac7f953ac734e">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a2278">
									<form method="post" action="../../2269/get-plot-data-from-function-over-mesh">
										<div class="qa-voting qa-voting-net" id="voting_2278">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467920-8cca35b0b26e720b6a4afb03f345407cb624eed4">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../2269/get-plot-data-from-function-over-mesh">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="2278"></a><div class="entry-content"><p>Hi, as you say</p>

<blockquote>
  <p>the order of the values is not the same</p>
</blockquote>

<p>The reason for this is that <strong>w.vector()</strong> entries are ordered by dofmap of function space of <strong>w</strong>, whereas you ordered <strong>f2_vector</strong> by coordinates. These orderings are not the same and also the number of mesh vertices in general does not equal the number of degrees of freedom.  Finally, you might want to vectorize your code.</p>

<pre><code>from dolfin import *
import numpy as np                                                               

mesh = UnitSquareMesh(50, 50)                                                    
V = FunctionSpace(mesh, "CG", 1)                                                 

u = Function(V)                                                                  
u_vector = u.vector()                                                            
dim = V.dim()                                                                    
N = mesh.geometry().dim()                                                        
dof_coordinates = V.dofmap().tabulate_all_coordinates(mesh).reshape(dim, N)      

x = dof_coordinates[:, 0]                                                        
y = dof_coordinates[:, 1]                                                        

# serial approach                                                                
def f2_s(x, y, f1):                                                              
  return 1 if f1(x, y) &lt;= DOLFIN_EPS else 2                                      

def f1_s(x, y):                                                                  
  return sin(4*pi*x)*cos(4*pi*y)                                                 

tic()                                                                            
for i in xrange(dim):                                                            
  u_vector[i] = f2_s(x[i], y[i], f1_s)                                           
ser = toc(); print "Serial", ser                                                 

# vectorized approach                                                            
def f2(x, y, f1):                                                                
  return np.where(f1(x, y) &lt;= DOLFIN_EPS, 1, 2)                                  

def f1(x, y):                                                                    
  return np.sin(4*pi*x)*np.cos(4*pi*y)                                           

tic()                                                                            
u_vector[:] = f2(x, y, f1)                                                       
vec = toc(); print "Vectorized", vec, "Speed up", int(ser/vec)  
</code></pre>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-avatar">
														<a href="../../user/MiroK" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/f566be3274ec73e3a6dda27bca11631c?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
													</span>
													<span class="qa-a-item-meta">
														<a href="../../2269/get-plot-data-from-function-over-mesh?show=2278#a2278" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-01-15T21:51:49+0000"></span>Jan 15, 2014</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/MiroK" class="qa-user-link url nickname">MiroK</a></span></span>
															<span class="qa-a-item-who-title">FEniCS Expert</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">80,920</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2014-01-16T09:49:59+0000"></span>Jan 16, 2014</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/mischa" class="qa-user-link url nickname">mischa</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c2278_list">
												<div class="qa-c-list-item  hentry comment" id="c2284">
													<div class="qa-c-item-content">
														<a name="2284"></a><div class="entry-content"><p>Thank you very much, this solved my problem. I tried something quite similar using the dofs but could not get it working. So thank you again!</p>

<p>Cheers,<br>
Mischa</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../2269/get-plot-data-from-function-over-mesh?show=2284#c2284" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-16T09:51:38+0000"></span>Jan 16, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/mischa" class="qa-user-link url nickname">mischa</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">240</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467920-505d354e9885c05d012cd3bcef01c415c72db704">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>