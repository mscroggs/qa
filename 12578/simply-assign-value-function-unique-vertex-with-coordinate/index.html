<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>how to simply assign a value on a function on a unique vertex with its coordinate - FEniCS Q&amp;A</title>
		<meta name="description" content="Hi everyone, Very simple question here, but i didnt find a simple way to do it. Let's say f_  ... , that i know exist in the discrete space. Regards,">
		<meta name="keywords" content="function,coordinates,assign,update">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/12578/simply-assign-value-function-unique-vertex-with-coordinate">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">how to simply assign a value on a function on a unique vertex with its coordinate</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q12578">
								<form method="post" action="../../12578/simply-assign-value-function-unique-vertex-with-coordinate">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_12578">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467829-ab7fc91cb928d86a3b0edec381af371ed1f42795">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../12578/simply-assign-value-function-unique-vertex-with-coordinate">
										<div class="qa-q-view-content">
											<a name="12578"></a><div class="entry-content"><p>Hi everyone,<br>
Very simple question here, but i didnt find a  simple way to do it.</p>

<p>Let's say f_ is a function defined on a non-mixed space.</p>

<p>If i want to evaluate the function on a point, i do:</p>

<pre><code>current_value = f_([x_coor,y_coor,z_coor])
</code></pre>

<p>How can i do simply the opposite operation (assign a new value on this coordinnate). Ideally, something like this:</p>

<pre><code>f_([x_coor,y_coor,z_coor]) = new_value # Does not work
</code></pre>

<p>I only want to change the function on this particular point, that i know exist in the discrete space.</p>

<p>Regards,</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/function" rel="tag" class="qa-tag-link">function</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/coordinates" rel="tag" class="qa-tag-link">coordinates</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/assign" rel="tag" class="qa-tag-link">assign</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/update" rel="tag" class="qa-tag-link">update</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../12578/simply-assign-value-function-unique-vertex-with-coordinate" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2017-03-02T20:18:23+0000"></span>Mar 2, 2017</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/fussegli" class="qa-user-link url nickname">fussegli</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">700</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c12578_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467829-f30ba93ae518de5072bd040b6efaf41ba313b5b6">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">2 Answers</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a12581">
									<form method="post" action="../../12578/simply-assign-value-function-unique-vertex-with-coordinate">
										<div class="qa-voting qa-voting-net" id="voting_12581">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467829-ab7fc91cb928d86a3b0edec381af371ed1f42795">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../12578/simply-assign-value-function-unique-vertex-with-coordinate">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="12581"></a><div class="entry-content"><p>Hi!</p>

<p>If your coordinate lies exactly on a vertex of your mesh this can be done easily like this:</p>

<p></p><pre><code><br>
f_.vector().array()[index] = new_value<br>
</code></pre>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../12578/simply-assign-value-function-unique-vertex-with-coordinate?show=12581#a12581" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-03-02T22:05:44+0000"></span>Mar 2, 2017</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/meron" class="qa-user-link url nickname">meron</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">2,340</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c12581_list">
												<div class="qa-c-list-item  hentry comment" id="c12582">
													<div class="qa-c-item-content">
														<a name="12582"></a><div class="entry-content"><p>I agree,<br>
My issue is to get index from x_coor,y_coor,z_coor such as:</p>

<pre><code>index = some function i do not know (x_coor,y_coor,z_coor)
</code></pre>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../12578/simply-assign-value-function-unique-vertex-with-coordinate?show=12582#c12582" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-03-02T23:02:22+0000"></span>Mar 3, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/fussegli" class="qa-user-link url nickname">fussegli</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">700</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467829-8d469a7baaf62ceb02ba0b44b36b61be624e4239">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
								<div class="qa-a-list-item  hentry answer" id="a12585">
									<form method="post" action="../../12578/simply-assign-value-function-unique-vertex-with-coordinate">
										<div class="qa-voting qa-voting-net" id="voting_12585">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467829-ab7fc91cb928d86a3b0edec381af371ed1f42795">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../12578/simply-assign-value-function-unique-vertex-with-coordinate">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="12585"></a><div class="entry-content"><p>Hi, the following minimal working example shows how to do this (actually, the answer is largely based on <a rel="nofollow" href="https://fenicsproject.org/qa/12401/indices-the-dofs-space-associated-with-the-vertices-the-mesh">this answer</a>, so credits to MiroK ;) ):</p>

<pre><code>from dolfin import * 
import numpy as np

mesh = UnitSquareMesh(2, 2)
V = FunctionSpace(mesh, 'CG', 2)
v = Function(V)

dofmap = V.dofmap()
nvertices = mesh.ufl_cell().num_vertices()

# Set up a vertex_2_dof list
indices = [dofmap.tabulate_entity_dofs(0, i)[0] for i in range(nvertices)]

vertex_2_dof = dict()
[vertex_2_dof.update(dict(vd for vd in zip(cell.entities(0),
                                        dofmap.cell_dofs(cell.index())[indices])))
                        for cell in cells(mesh)]

# Get the vertex coordinates
X = mesh.coordinates()

# Set the vertex coordinate you want to modify
xcoord, ycoord = 0.5, 0.5

# Find the matching vertex (if it exists)
vertex_idx = np.where((X == (xcoord,ycoord)).all(axis = 1))[0] 
if not vertex_idx:
    print 'No matching vertex!'
else:
    vertex_idx = vertex_idx[0]
    dof_idx = vertex_2_dof[vertex_idx]
    print dof_idx
    v.vector()[dof_idx] = 1.

plot(v)
interactive()
</code></pre>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../12578/simply-assign-value-function-unique-vertex-with-coordinate?show=12585#a12585" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-03-03T07:50:18+0000"></span>Mar 3, 2017</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/jmmal" class="qa-user-link url nickname">jmmal</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">5,890</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
													<br>
													<span class="qa-a-item-what">edited</span>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2017-03-03T08:24:51+0000"></span>Mar 3, 2017</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/jmmal" class="qa-user-link url nickname">jmmal</a></span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c12585_list">
												<div class="qa-c-list-item  hentry comment" id="c12597">
													<div class="qa-c-item-content">
														<a name="12597"></a><div class="entry-content"><p>Hi, it's great, thanks!<br>
However, I am wandering if such a function is time efficient. <br>
If i understand correctly,</p>

<pre><code>vertex_idx = np.where((X == (xcoord,ycoord)).all(axis = 1))[0]
</code></pre>

<p>will compare all elements of X until it find the corresponding xcoord,ycoord. It can takes some times (from a CPU time perspective) to get it. My issue is that this operation (in my program) is called a lot of time, in a large mesh.</p>

<p>To avoid any np.where or equivalent find operation, i have finally used an equivalent method ( <em>for my particular problem</em>): i have basically defined an numpy array so that array[X][Y][Z] gives the value of the function f_ (<em>that is no more used at all</em>) at the coordinates x,y,z (the only operation here consists in transform the  coordinates x in the corresponding index integer through a simple <code>X=int(round(x/mesh_step))</code>.<br>
Since i am working with an array, and that i know (i) the coordinates where i want to change the value and (ii) the new value, it is know both simple and fast:</p>

<pre><code># Convert coordinates in index integer for the array
X=int(round(coor_x/mesh_step_along_x))
Y=int(round(coor_y/mesh_step_along_y))
Z=int(round(coor_z/mesh_step_along_z))
# Current value, that corresponds at the information i store at the node of coordinates coor_x coor_y coor_z
current_value = array[X][Y][Z]
# New value
array[X][Y][Z] = new_value
</code></pre>

<p>In my problem, i only want to be able to save/modify an information locally at the vertex locations, then this solution is enough.<br>
Regards,</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../12578/simply-assign-value-function-unique-vertex-with-coordinate?show=12597#c12597" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-03-03T15:44:00+0000"></span>Mar 3, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/fussegli" class="qa-user-link url nickname">fussegli</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">700</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c12598">
													<div class="qa-c-item-content">
														<a name="12598"></a><div class="entry-content"><p>Well, I see which direction you want to go. And although your approach might be faster, you have to keep in mind that it is very non-generic (only works for regular meshes). Moreover, you need to extract the vertex index from X,Y,Z (for this, you have to know how the vertices are ordered). Once you know the vertex index, you cannot avoid using something like the vert_2_dof dictionary as proposed in my answer in order to get the dof index and set the corresponding entry in the function object.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../12578/simply-assign-value-function-unique-vertex-with-coordinate?show=12598#c12598" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-03-03T16:18:46+0000"></span>Mar 3, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/jmmal" class="qa-user-link url nickname">jmmal</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">5,890</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c12601">
													<div class="qa-c-item-content">
														<a name="12601"></a><div class="entry-content"><p>I agree, it's not generic. I am working on a regular mesh made of cubic element (electrode microstructrure obtained through X-ray tomography), then it works well.</p>

<p>Basically, i check a field value on a particulate coordinates coor_x, coor_y ,coor_z (coordinates i already know).</p>

<pre><code>current_value = f_([x_coor,y_coor,z_coor])
</code></pre>

<p>Then, i convert this coordinate in an integer that indicated the position (not a classic fenics index). For example, if coor_x=9.3 and each voxel (cubic element) has a lenght of 0.3, then X=9.3/0.3=31. I use <strong>round</strong> to get ridd off numerical truncation error and then <strong>int</strong>.</p>

<p>Depending on the current_value, i then assign array[X][Y][Z]=new_value</p>

<p>That's simply a way to store some additional information without dealing with fenics index. And as you said, it requires a regular mesh.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../12578/simply-assign-value-function-unique-vertex-with-coordinate?show=12601#c12601" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-03-03T17:54:12+0000"></span>Mar 3, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/fussegli" class="qa-user-link url nickname">fussegli</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">700</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c12602">
													<div class="qa-c-item-content">
														<a name="12602"></a><div class="entry-content"><p>Allright, then just find the way the vertices are ordered in the (regular) mesh, get the vertex index based on the 'approximate' indices X,Y,Z, and use the vert_2_dof dictionary to find the dof index.<br>
That should do the trick, I guess?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../12578/simply-assign-value-function-unique-vertex-with-coordinate?show=12602#c12602" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-03-03T20:29:28+0000"></span>Mar 3, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/jmmal" class="qa-user-link url nickname">jmmal</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">5,890</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467829-0ccecfa1255f96a7eb3cbd6f1575a5679bfb44eb">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>