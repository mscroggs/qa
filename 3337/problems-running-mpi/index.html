<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Problems running MPI - FEniCS Q&amp;A</title>
		<meta name="description" content="Hi all, I built dolfin and verified it works correctly when I'm using one core, using PETSc to ... is calling PETSc... anyone have some advice? Thanks">
		<meta name="keywords" content="mpirun,petsc">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/3337/problems-running-mpi">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Problems running MPI</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q3337">
								<form method="post" action="../../3337/problems-running-mpi">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_3337">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">&#8211;1<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="1"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467967-0a9696ce94e372c66284ccfe98c911a13807b9bd">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../3337/problems-running-mpi">
										<div class="qa-q-view-content">
											<a name="3337"></a><div class="entry-content"><p>Hi all, <br>
I built dolfin and verified it works correctly when I'm using one core, using PETSc to solve. I had to make the mpi enabled python using mpi4py. I'm using MPICH2 and PETSC-3.4.4 (although I tried a few others too)</p>

<p>If I try to use 2 cores with mpirun -np, I get: </p>

<pre><code>Solving nonlinear variational problem.
[0]PETSC ERROR: --------------------- Error Message ------------------------------------
[0]PETSC ERROR: Invalid pointer!
[0]PETSC ERROR: Null Pointer: Parameter # 3!
[0]PETSC ERROR: ------------------------------------------------------------------------
[0]PETSC ERROR: Petsc Release Version 3.4.4, Mar, 13, 2014 
[0]PETSC ERROR: See docs/changes/index.html for recent updates.
[0]PETSC ERROR: See docs/faq.html for hints about trouble shooting.
[0]PETSC ERROR: See docs/index.html for manual pages.
[0]PETSC ERROR: ------------------------------------------------------------------------
[0]PETSC ERROR: Unknown Name on a arch-linux2-c-debug named blogin2 by mwelland Mon Apr 21 20:37:10 2014
[0]PETSC ERROR: Libraries linked from /home/mwelland/local_gnu_32I/lib
[0]PETSC ERROR: Configure run at Mon Apr 21 19:13:42 2014
[0]PETSC ERROR: Configure options CFLAGS= -fopenmp -m64 -I/soft/mkl/11.0.5.192/mkl/include -march=native -mavx CXXFLAGS= -fopenmp -m64 -I/soft/mkl/11.0.5.192/mkl/include -march=native -mavx FFLAGS= -fopenmp -m64 -I/soft/mkl/11.0.5.192/mkl/include -march=native -mavx LDFLAGS=-L/soft/mkl/11.0.5.192/mkl/lib/intel64 -ldl -lpthread -lm --prefix=/home/mwelland/local_gnu_32I --with-shared-libraries --with-petsc4py=1 --with-mpi-dir=/software/mvapich2-gnu-psm-1.9.5/ --with-boost-dir=/home/mwelland/local_gnu_32I --with-mpi4py=1 --with-blas-lapack-dir=/soft/mkl/11.0.5.192/mkl/lib/intel64 --with-numpy=1 --with-scientificpython=1 --with-scientificpython-dir=/home/mwelland/local_gnu_32I --with-umfpack=1 --download-umfpack=yes --with-valgrind=1 --with-valgrind-dir=/usr/bin/ --search-dirs="[/usr/bin,/home/mwelland/local_gnu_32I]" --package-dirs="[/usr/lib64,/home/mwelland/local_gnu_32I]"
[0]PETSC ERROR: ------------------------------------------------------------------------
[0]PETSC ERROR: VecGetValues() line 920 in /fusion/gpfs/home/mwelland/programs/petsc-3.4.4/src/vec/vec/interface/rvector.c
Traceback (most recent call last):
  File "13_PETScTweak.py", line 312, in &lt;module&gt;
    solver.solve()
RuntimeError: 

*** -------------------------------------------------------------------------
*** DOLFIN encountered an error. If you are not able to resolve this issue
*** using the information listed below, you can ask for help at
***
***     fenics@fenicsproject.org
***
*** Remember to include the error message listed below and, if possible,
*** include a *minimal* running example to reproduce the error.
***
*** -------------------------------------------------------------------------
*** Error:   Unable to successfully call PETSc function 'VecGetValues'.
*** Reason:  PETSc error code is: 68.
*** Where:   This error was encountered inside /home/mwelland/programs/git/dolfin/dolfin/la/PETScVector.cpp.
*** Process: unknown
*** 
*** DOLFIN version: 1.3.0+
*** Git changeset:  15187a300a3ed92da2cd5e13e64eae5383265d45
*** -------------------------------------------------------------------------

application called MPI_Abort(MPI_COMM_WORLD, 1) - process 0
</code></pre>

<p>The PETSc demos worked fine, as did some testing scripts using mpi4py, so I'm left thinking it has something to do with how dolfin is calling PETSc... anyone have some advice?<br>
Thanks</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/mpirun" rel="tag" class="qa-tag-link">mpirun</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/petsc" rel="tag" class="qa-tag-link">petsc</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-avatar">
												<a href="../../user/mwelland" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/af936799ea3fe5bd1cb6abb922ebbe83?s=50" width="50" height="50" class="qa-avatar-image" alt=""></a>
											</span>
											<span class="qa-q-view-meta">
												<a href="../../3337/problems-running-mpi" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2014-04-22T02:32:45+0000"></span>Apr 22, 2014</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/mwelland" class="qa-user-link url nickname">mwelland</a></span></span>
													<span class="qa-q-view-who-title">FEniCS User</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">8,410</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c3337_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467967-d72e439a14b05c2f9c4a3938706425a4c770fed1">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a3370">
									<form method="post" action="../../3337/problems-running-mpi">
										<div class="qa-voting qa-voting-net" id="voting_3370">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467967-0a9696ce94e372c66284ccfe98c911a13807b9bd">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../3337/problems-running-mpi">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="3370"></a><div class="entry-content"><p>It appears this problem stems from using a compiledSubDomain to mark a boundary condition. Replacing it with a python expression solves the problem. </p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/mwelland" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/af936799ea3fe5bd1cb6abb922ebbe83?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../3337/problems-running-mpi?show=3370#a3370" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-04-24T17:53:39+0000"></span>Apr 24, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/mwelland" class="qa-user-link url nickname">mwelland</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">8,410</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c3370_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467967-367d2136a956e2d66063c808517a5246d0124316">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>