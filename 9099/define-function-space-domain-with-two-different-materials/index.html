<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>How to define function space in a domain with two different materials - FEniCS Q&amp;A</title>
		<meta name="description" content="Hello I am dealing with a domain like this: ![enter image description here][1] I want to know  ... i/hluzmAkej [2]: https://imageshack.com/i/hlDA5iWfj">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/9099/define-function-space-domain-with-two-different-materials">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">How to define function space in a domain with two different materials</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q9099">
								<form method="post" action="../../9099/define-function-space-domain-with-two-different-materials">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_9099">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468207-fbda438d415589f32d2fdad3aaf01e8a99d5cf4b">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../9099/define-function-space-domain-with-two-different-materials">
										<div class="qa-q-view-content">
											<a name="9099"></a><div class="entry-content"><p>Hello<br>
I am dealing with a domain like this:</p>

<p><img src="https://imageshack.com/i/hluzmAkej" alt="enter image description here"></p>

<p>I want to know how I can define my domain, function space and mesh. I have done it once before for a domain which was a rectangle with a circular cutout and there was only one material. I defined my domain, function space and mesh as below:</p>

<pre><code>domain = mshr.Rectangle(Point(0,0), Point(6,3))-mshr.Circle(Point(3,1.5), 0.2)
mesh = mshr.generate_mesh(domain, 30)
V=FunctionSpace(mesh, 'Lagrange', 1)
</code></pre>

<p>But now I want to replace the cutout with a material which is different from the material 1. In addition I am dealing with this equation:<br>
<img src="https://imageshack.com/i/hlDA5iWfj" alt="enter image description here"><br>
 &#181; and &#955; are material's properties. I have derived the weak form equations for the case I have only one material but I don't know how I can define domain, mesh and function space when I have two different materials. I am a little confused. Could you please help me with that? <br>
Thanks in advance.</p>
</div>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../9099/define-function-space-domain-with-two-different-materials" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2016-01-22T05:08:12+0000"></span>Jan 22, 2016</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/jafar" class="qa-user-link url nickname">jafar</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">670</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c9099_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468207-3ac9799523552274b28c8d5004ad97e4052d78c4">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">3 Answers</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a9107">
									<form method="post" action="../../9099/define-function-space-domain-with-two-different-materials">
										<div class="qa-voting qa-voting-net" id="voting_9107">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+2<span class="votes-up"><span class="value-title" title="2"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468207-fbda438d415589f32d2fdad3aaf01e8a99d5cf4b">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../9099/define-function-space-domain-with-two-different-materials">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="9107"></a><div class="entry-content"><p>Hi,<br>
A way to do this is defining a unsigned int cell function in order to carachterize the subdomains and then assing each property to its respective subdomains  with the class "DiscontinuosTenor" shown above (i took this class from other question at this forum). So, lets say the material 1 have a tensor  (or a constant in your case, this is more general) D1 and the material 2 have a tensor D2, the python code to define the domain, mesh and the circle can be as follows:</p>

<pre><code># class for cicle subdomain
class Circle(SubDomain):
  def inside(self, x, on_boundary):
    if x[0]*x[0] + y[0]*y[0] &lt; pow(radius,2)

# class for assign tensors to its respective sub-domains
class DiscontinuousTensor(Expression):
  def __init__(self, cell_function, tensors):
    self.cell_function = cell_function
    self.coeffs        = tensors
  def value_shape(self):
    return (2,2)
   def eval_cell(self, values, x, cell):
       subdomain_id = self.cell_function[cell.index]
        local_coeff  = self.coeffs[subdomain_id]
        local_coeff.eval_cell(values, x, cell)

radius = 0.2
circle  = Circle()

domain  = mshr.Rectangle(Point(0,0), Point(6,3))-mshr.Circle(Point(3,1.5), 0.2)
mesh     = mshr.generate_mesh(domain, 30)
V            = FunctionSpace(mesh, 'Lagrange', 1)

# create cell function to mark subdomains of material 2
cf      = CellFunction("size_t", mesh)
circle.mark(cf, 1)



# tensors for each material
D1      = Constant(((1,      0),                
               (0,      1)))    
D2      = Constant(((2  , 0.0,),            
               (0.0,    2)))

C = DiscontinuousTensor(cf, [D1, D2]) # Assign tensors where they belongs
</code></pre>

<p>I hope this can help you.</p>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-avatar">
														<a href="../../user/felipe_galarce" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=11799416285071652965&amp;qa_size=40" width="33" height="40" class="qa-avatar-image" alt=""></a>
													</span>
													<span class="qa-a-item-meta">
														<a href="../../9099/define-function-space-domain-with-two-different-materials?show=9107#a9107" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-01-24T12:47:41+0000"></span>Jan 24, 2016</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/felipe_galarce" class="qa-user-link url nickname">felipe_galarce</a></span></span>
															<span class="qa-a-item-who-title">FEniCS User</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">1,190</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2016-02-08T00:06:26+0000"></span>Feb 8, 2016</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/jafar" class="qa-user-link url nickname">jafar</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c9107_list">
												<div class="qa-c-list-item  hentry comment" id="c9145">
													<div class="qa-c-item-content">
														<a name="9145"></a><div class="entry-content"><p>Thank you for your response but I am still confused. For example when it was only one material my variational form was something like:</p>

<pre><code>a = inner(u,v)*2500*dx + dt*dt*G*inner(grad(u), grad(v))*dx
</code></pre>

<p>And G is the shear modulus of that material.<br>
Now I am dealing with two materials with two different G. I don't know yet how I can define my variational form (a) according to two different G. I mean I can not figure out what parameter I have to put in my variational form instead of G to cover both G.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../9099/define-function-space-domain-with-two-different-materials?show=9145#c9145" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-01-28T21:46:35+0000"></span>Jan 28, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/jafar" class="qa-user-link url nickname">jafar</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">670</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468207-2d0599ee0ca7f951712a997f8e51355d30794e0e">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
								<div class="qa-a-list-item  hentry answer" id="a9109">
									<form method="post" action="../../9099/define-function-space-domain-with-two-different-materials">
										<div class="qa-voting qa-voting-net" id="voting_9109">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468207-fbda438d415589f32d2fdad3aaf01e8a99d5cf4b">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../9099/define-function-space-domain-with-two-different-materials">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="9109"></a><div class="entry-content"><p>Maybe the related questions presented below can be useful for you:</p>

<ul>
<li><a rel="nofollow" href="http://fenicsproject.org/qa/8229/assign-values-from-data-array-to-genericvector">assign values from data Array to GenericVector?</a></li>
<li><a rel="nofollow" href="http://fenicsproject.org/qa/5852/how-to-set-diferent-materials-on-difrent-parts-of-a-mesh?show=5852#q5852">How to set diferent materials on difrent parts of a mesh?</a></li>
<li><a rel="nofollow" href="http://fenicsproject.org/qa/8683/discontinuous-coefficient-poisson-subdomain-expression?show=8683#q8683">Discontinuous coefficient in Poisson: Subdomain vs Expression</a></li>
</ul>

<p>Regards.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/hernan_mella" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=14920815903966845416&amp;qa_size=40" width="40" height="22" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../9099/define-function-space-domain-with-two-different-materials?show=9109#a9109" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-01-25T19:20:25+0000"></span>Jan 25, 2016</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">19,460</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c9109_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468207-bfde6b8e7bdda91fa10298831cfb45a2992c8761">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
								<div class="qa-a-list-item  hentry answer" id="a9246">
									<form method="post" action="../../9099/define-function-space-domain-with-two-different-materials">
										<div class="qa-voting qa-voting-net" id="voting_9246">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+2<span class="votes-up"><span class="value-title" title="2"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468207-fbda438d415589f32d2fdad3aaf01e8a99d5cf4b">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../9099/define-function-space-domain-with-two-different-materials">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="9246"></a><div class="entry-content"><p>I think the simplest way to solve the problem is to create a function on the mesh and assign to it the value of the material property in each cell. I have compiled a small MWE that demonstrates how this can be done using a CellFunction.</p>

<p>In the MWE a material function G is created with values [1, 2]. Cells outside the circle have default index 0, e.g. G = 1. Cells inside the circle are marked with index 1, e.g. G = 2. The function G can be used directly in your variational form.</p>

<pre><code>from dolfin import *
import numpy as np    

class LogicDomain(SubDomain):
    def __init__(self, condition):
        self.condition = condition
        SubDomain.__init__(self)

    def inside(self, x, on_boundary):
        return self.condition(x)    

def material_function(target_mesh, material_values):
    V = FunctionSpace(target_mesh, 'DG', 0)
    # Create material function and assign values (vectorized using numpy)
    mat_func = Function(V)
    tmp = np.asarray(sub_domains.array(), dtype=np.int32)
    mat_func.vector()[:] = np.choose(tmp, material_values)
    return mat_func    

mesh = RectangleMesh(Point(-1, -1), Point(1, 1), 100, 100)
# Create cell function and mark cells inside circle of radius 0.50 with value 1.
r = 0.50
sub_domains = CellFunction('size_t', mesh)
LogicDomain(lambda x: x[0] ** 2 + x[1] ** 2 &lt; r ** 2).mark(sub_domains, 1)
# Define material parameters and assign them to appropriate cells.
G_values = [1, 2]
G = material_function(mesh, G_values)
# Check that G has different values outside/inside circle.
print(G(1, 1))
print(G(0, 0))
</code></pre>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../9099/define-function-space-domain-with-two-different-materials?show=9246#a9246" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-02-08T20:17:24+0000"></span>Feb 8, 2016</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/emher" class="qa-user-link url nickname">emher</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">1,290</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c9246_list">
												<div class="qa-c-list-item  hentry comment" id="c12620">
													<div class="qa-c-item-content">
														<a name="12620"></a><div class="entry-content"><p>It is working in two dimensions, But when I have the domain (cube ) with the cylinder in the center, not working also when we have multiple (more than Two) How can we define. any idea...<br>
Thanks in advance</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../9099/define-function-space-domain-with-two-different-materials?show=12620#c12620" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-03-06T06:03:07+0000"></span>Mar 6, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/hirshikesh" class="qa-user-link url nickname">hirshikesh</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">1,890</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468207-ac9d4ce6beddea5082dcb778a5e13c19df085ad6">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>