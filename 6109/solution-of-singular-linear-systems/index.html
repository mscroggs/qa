<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Solution of singular linear systems. - FEniCS Q&amp;A</title>
		<meta name="description" content="Hello, I am solving a linear system for a fluid dynamics problem of which I need to extract even  ...  insight in what is happening. Thank you a lot.">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/6109/solution-of-singular-linear-systems">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Solution of singular linear systems.</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q6109">
								<form method="post" action="../../6109/solution-of-singular-linear-systems">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_6109">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468057-5f83de4ee3829c39f01017551e365a2c727fe652">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../6109/solution-of-singular-linear-systems">
										<div class="qa-q-view-content">
											<a name="6109"></a><div class="entry-content"><p>Hello,</p>

<p>I am solving a linear system for a fluid dynamics problem of which I need to extract even some eigensolutions. I used solve(A, x, b, "lu") in c++ to solve it and I got the right solution. When I invoked SLEPcEigensolver with shift-and-invert option I received PETSc error messages. It complained about zero pivots in LU factorization.</p>

<p>The matrix could be singular, but in this case I can't understand how Fenics solved the system, maybe a different kind of pivoting. I could not find the objects where LU factorization and system solution is actually implemented in Fenics, to have a better insight in what is happening.<br>
Thank you a lot.</p>
</div>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../6109/solution-of-singular-linear-systems" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2014-11-28T10:42:16+0000"></span>Nov 28, 2014</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/Stefano" class="qa-user-link url nickname">Stefano</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">460</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c6109_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468057-54b706c25094d3f3f9e05655749d3d8e9466bc77">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a6136">
									<form method="post" action="../../6109/solution-of-singular-linear-systems">
										<div class="qa-voting qa-voting-net" id="voting_6136">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468057-5f83de4ee3829c39f01017551e365a2c727fe652">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../6109/solution-of-singular-linear-systems">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="6136"></a><div class="entry-content"><p>LU and other techniques quite often work, but not always. <br>
The LU factorization happens outside FEniCS, </p>

<p>There are several different LU solvers and libraries that can be used<br>
from dolfin, see: <br>
<a rel="nofollow" href="https://bitbucket.org/fenics-project/dolfin/src/12a8c744503fb50a51e7444bd23d22bb0de4ef7e/dolfin/la/?at=master">https://bitbucket.org/fenics-project/dolfin/src/12a8c744503fb50a51e7444bd23d22bb0de4ef7e/dolfin/la/?at=master</a></p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../6109/solution-of-singular-linear-systems?show=6136#a6136" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-12-03T20:54:11+0000"></span>Dec 3, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Kent-Andre+Mardal" class="qa-user-link url nickname">Kent-Andre Mardal</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">14,380</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c6136_list">
												<div class="qa-c-list-item  hentry comment" id="c6145">
													<div class="qa-c-item-content">
														<a name="6145"></a><div class="entry-content"><p>Hello<br>
Thank you very much. I read the scripts listed in your link. In particular PETScLusolver.cpp, which I think is used in the direct solution when using problems defined with PETScMatrix. In the end I realized my problem was due to pivoting. I found that there is a flag in PETScLUsolver.cpp on MAT_SOLVER_MUMPS as a method for performing LU factorization. This explains why the program was able to solve the problem but not to extract the eigenvalues. In SLEPcEigensolver.cpp there is no reference to such methods for performing factorization, or maybe I was not able to find them.</p>

<p>I found easier to do it directly from SLEPc. After creating the eigensolver I accessed the inthernal PETSc's KSP object, the linear system solver, and then set the parameters of its preconditioner, PC object, with MAT_SOLVER_MUMPS. Maybe all these procedures could be done directly using Dolfin's methods. <br>
Thank you<br>
Stefano</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../6109/solution-of-singular-linear-systems?show=6145#c6145" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-12-05T13:33:43+0000"></span>Dec 5, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Stefano" class="qa-user-link url nickname">Stefano</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">460</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c6217">
													<div class="qa-c-item-content">
														<a name="6217"></a><div class="entry-content"><p>I am having the same problem with eigenvalue solver. Is it possible to set the PC object in python ? Can you show how to do that ?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../6109/solution-of-singular-linear-systems?show=6217#c6217" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-12-16T15:15:17+0000"></span>Dec 16, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/praveen" class="qa-user-link url nickname">praveen</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,760</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c6219">
													<div class="qa-c-item-content">
														<a name="6219"></a><div class="entry-content"><p>Hello<br>
Unfortunately I'm not using python interface and I'm not expert of it. I think it is quite difficult even using the lower level c++ procedures. I was able to do it just using directly SLEPc. Sorry.<br>
Hello<br>
Stefano </p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../6109/solution-of-singular-linear-systems?show=6219#c6219" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-12-17T10:05:47+0000"></span>Dec 17, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Stefano" class="qa-user-link url nickname">Stefano</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">460</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468057-472fc4245873809318646b619e875ba1a64d224f">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>