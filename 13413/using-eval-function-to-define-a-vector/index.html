<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Using eval function to define a vector - FEniCS Q&amp;A</title>
		<meta name="description" content="Hello I want to define a 2*1 vector inside a class and use the eval function to define the components ...  a sequence. Any idea how to fix it? Thanks!">
		<meta name="keywords" content="ufl,function-evaluation,expression-evaluation">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/13413/using-eval-function-to-define-a-vector">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Using eval function to define a vector</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q13413">
								<form method="post" action="../../13413/using-eval-function-to-define-a-vector">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_13413">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467864-8fd82c78334a87ea3b8499259e1dd6b3237e4b98">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../13413/using-eval-function-to-define-a-vector">
										<div class="qa-q-view-content">
											<a name="13413"></a><div class="entry-content"><p>Hello<br>
I want to define a 2*1 vector inside a class and use the eval function to define the components of this vector, like:</p>

<pre><code>class BodyForce(Expression):

    def __init__(self, **kwargs):

        self.value = kwargs['value']

    def eval(self, value,x):

        value[0] = self.value[0]
        value[1] = self.value[1]

    def value_shape(self):
        return (2,)

GG = BodyForce(value=(Constant(A)*(c - 1.), 0.0), degree=1)
</code></pre>

<p>The thing is the first component of this vector is with respect to "c" which is an unknown that is needed to be calculated. In addition this vector should be applied in all over the domain. I have to use this vector in my variational problem. The contributing term from this vector in the variational problem is:</p>

<pre><code>inner(GG,v_3) * dx
</code></pre>

<p>I get this error:</p>

<pre><code>raceback (most recent call last):
  File "/home/hp/Desktop/ert/23.py", line 171, in &lt;module&gt;
    solve(F == 0, z, bcs)
  File "/home/hp/Desktop/ert/23.py", line 151, in eval
    value[0] = self.value[0]
ValueError: setting an array element with a sequence.
</code></pre>

<p>Any idea how to fix it?<br>
Thanks!</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/ufl" rel="tag" class="qa-tag-link">ufl</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/function-evaluation" rel="tag" class="qa-tag-link">function-evaluation</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/expression-evaluation" rel="tag" class="qa-tag-link">expression-evaluation</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../13413/using-eval-function-to-define-a-vector" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2017-05-10T22:10:30+0000"></span>May 11, 2017</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/Leo" class="qa-user-link url nickname">Leo</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">840</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c13413_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467864-80d17e277cde65e20581c3cb098a540e29d864e8">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a13462">
									<form method="post" action="../../13413/using-eval-function-to-define-a-vector">
										<div class="qa-voting qa-voting-net" id="voting_13462">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467864-8fd82c78334a87ea3b8499259e1dd6b3237e4b98">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../13413/using-eval-function-to-define-a-vector">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="13462"></a><div class="entry-content"><p>I'm not sure what you want to achieve, but it seems that you want to define a constant coefficient (A (c - 1), 0), where c varies, I guess in an iterative method.</p>

<p>If you want to define an expression which depends on some coefficient and you want to update this coefficient, you can just access it as a property of the object:</p>

<pre><code>mesh = UnitSquareMesh(1,1)
V = FunctionSpace(mesh, 'Lagrange', 1)
v = TestFunction(V)
GG = Expression(("A*(c-1)","0"), A=7.0, c=42.0, degree=1)
a = inner(GG, grad(v))*dx
M1 = assemble(a)
GG.A = 14.0
GG.c = -7.0
M2 = assemble(a)
(M1-M2).array()  # we did something
</code></pre>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-avatar">
														<a href="../../user/mdbenito" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/6545a7c3ba26a36c62facacf39cb4b51?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
													</span>
													<span class="qa-a-item-meta">
														<a href="../../13413/using-eval-function-to-define-a-vector?show=13462#a13462" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-05-14T08:57:38+0000"></span>May 14, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/mdbenito" class="qa-user-link url nickname">mdbenito</a></span></span>
															<span class="qa-a-item-who-title">FEniCS User</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">4,530</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2017-05-16T16:08:54+0000"></span>May 16, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/Leo" class="qa-user-link url nickname">Leo</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c13462_list">
												<div class="qa-c-list-item  hentry comment" id="c13485">
													<div class="qa-c-item-content">
														<a name="13485"></a><div class="entry-content"><p>Hello<br>
Thanks for your response but the thing that I am looking for is different. <br>
As I explained I want to define a Vector. The first component of this vector is : A(c-1) where "A" is constant but "c" is unknown and is present in the variational form. The second component of this vector is zero.<br>
I have already solved the problem by defining this vector in another way :</p>

<pre><code># Define vectorial body force
def F():
    return as_vector([Constant(A)*(c - 1.)] +[0.0])
</code></pre>

<p>I just wanna know if it is possible to define the "F" in this fashion:</p>

<pre><code>class BodyForce(Expression):

    def __init__(self, **kwargs):

        self.value = kwargs['value']

    def eval(self, value,x):

        value[0] = self.value[0]
        value[1] = self.value[1]

    def value_shape(self):
        return (2,)

F = BodyForce(value=(Constant(A)*(c - 1.), 0.0), degree=1)
</code></pre>

<p>However I could not get it to work!<br>
I want it to play the same role as a vector like F() as I mentioned above. I need to mention that I got this idea from your answer in : </p>

<p><a rel="nofollow" href="https://fenicsproject.org/qa/13149/clamped-beam-under-the-end-load-problem">https://fenicsproject.org/qa/13149/clamped-beam-under-the-end-load-problem</a></p>

<p>In other words I want to know if it is possible to define a vector by combining:</p>

<ol>
<li>class</li>
<li>def <strong>init</strong>(self, **kwargs),</li>
<li>def eval(self, value,x).</li>
</ol>

<p>Thanks in advance for your time.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13413/using-eval-function-to-define-a-vector?show=13485#c13485" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-15T15:59:22+0000"></span>May 15, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Leo" class="qa-user-link url nickname">Leo</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">840</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13504">
													<div class="qa-c-item-content">
														<a name="13504"></a><div class="entry-content"><p>I see... well the approach with <code>eval</code> in the class cannot work, or at least not in that form, since <code>value</code> is a numpy array, and you cannot assign <code>Constant(A)*(c-1)</code> to its first component. What about this:</p>

<pre><code>class BodyForce(Expression):

    def __init__(self, **kwargs):
        self.A = kwargs['A']
        self.c = kwargs['c']
        self.x1 = kwargs['x1']

        assert iscallable(self.c), 'I need to call c(x)'
        assert isintance(self.A, float) and isinstance(self.x1, float), 'I need scalar constants'

    def eval(self, value,x):
        value[0] = self.A * (self.c(x)-1)
        value[1] = self.x1

    def value_shape(self):
        return (2,)
</code></pre>

<p>And use it with</p>

<pre><code>GG = BodyForce(A=A, c=c, x1=0, degree=1)
</code></pre>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/mdbenito" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/6545a7c3ba26a36c62facacf39cb4b51?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../13413/using-eval-function-to-define-a-vector?show=13504#c13504" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-16T10:08:45+0000"></span>May 16, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/mdbenito" class="qa-user-link url nickname">mdbenito</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,530</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13511">
													<div class="qa-c-item-content">
														<a name="13511"></a><div class="entry-content"><p>I changed what you suggested a little bit. I think there was a typo in there. So this is what I replaced in my code:</p>

<pre><code>class BodyForce(Expression):

    def __init__(self, **kwargs):
        self.A = kwargs['A']
        self.c = kwargs['c']
        self.x1 = kwargs['x1']

        assert callable(self.c)
        assert isinstance(self.A, float) and isinstance(self.x1, float)

    def eval(self, value,x):
        value[0] = self.A * (self.c(x)-1)
        value[1] = self.x1

    def value_shape(self):
        return (2,)
</code></pre>

<p>But then I got a new error: </p>

<pre><code>assert isinstance(self.A, float) and isinstance(self.x1, float)
AssertionError
</code></pre>

<p>Then I removed the lines :</p>

<pre><code>assert callable(self.c)
assert isinstance(self.A, float) and isinstance(self.x1, float)
</code></pre>

<p>This time it worked but it increased the time of running dramatically. I guess it is not a right approach to define a vector this way. Anyway, thanks again for providing the support. </p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13413/using-eval-function-to-define-a-vector?show=13511#c13511" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-16T16:08:50+0000"></span>May 16, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Leo" class="qa-user-link url nickname">Leo</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">840</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13513">
													<div class="qa-c-item-content">
														<a name="13513"></a><div class="entry-content"><p>My pleasure. The assertions were there just to make it clear that we wanted to be multiplying numbers, not dolfin Constants or stuff like that. And yes, I can see it taking a lot longer, being pure python instead of whatever it is that dolfin does under the hood. Happy hacking!</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/mdbenito" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/6545a7c3ba26a36c62facacf39cb4b51?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../13413/using-eval-function-to-define-a-vector?show=13513#c13513" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-16T16:27:19+0000"></span>May 16, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/mdbenito" class="qa-user-link url nickname">mdbenito</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,530</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467864-f7ae24f15390f7d6215f4fcd2bbaf41f9faaab43">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>