<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Is it possible to apply many point sources to b without a python for loop? - FEniCS Q&amp;A</title>
		<meta name="description" content="I need to do the python loop below for each time step in a transient solution with many &gt;100 point  ... ).apply( b ) # Use this for some calculation.">
		<meta name="keywords" content="assemble,point-wise,pointsource,source">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/13172/it-possible-apply-many-point-sources-without-python-for-loop">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Is it possible to apply many point sources to b without a python for loop?</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q13172">
								<form method="post" action="../../13172/it-possible-apply-many-point-sources-without-python-for-loop">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_13172">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467855-6b31f02f08938ce6c5df8895da3ee7a4a94c76f9">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../13172/it-possible-apply-many-point-sources-without-python-for-loop">
										<div class="qa-q-view-content">
											<a name="13172"></a><div class="entry-content"><p>I need to do the python loop below for each time step in a transient solution with many &gt;100 point sources. If there a way of applying them all at the same time given a list of points without having to use point.apply(b) for each one? Could I use c++ code in the python script?</p>

<pre><code>mesh_obj = UnitSquareMesh(100,100)
V = FunctionSpace( mesh_obj, "CG", 1 )
v = TestFunction( V )
L = Constant(0.0) * v * dx
b  = assemble ( L )

for pt in list_of_points:
    PointSource( V, Point( pt ), 1.0 ).apply( b )
    # Use this for some calculation.
</code></pre>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/assemble" rel="tag" class="qa-tag-link">assemble</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/point-wise" rel="tag" class="qa-tag-link">point-wise</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/pointsource" rel="tag" class="qa-tag-link">pointsource</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/source" rel="tag" class="qa-tag-link">source</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../13172/it-possible-apply-many-point-sources-without-python-for-loop" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2017-04-23T04:40:33+0000"></span>Apr 23, 2017</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/alexmm" class="qa-user-link url nickname">alexmm</a></span></span>
													<span class="qa-q-view-who-title">FEniCS User</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">4,240</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c13172_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467855-5f472296f29de0ec454bfe08b7cf2c11795cad88">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a13173">
									<form method="post" action="../../13172/it-possible-apply-many-point-sources-without-python-for-loop">
										<div class="qa-voting qa-voting-net" id="voting_13173">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+3<span class="votes-up"><span class="value-title" title="3"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467855-6b31f02f08938ce6c5df8895da3ee7a4a94c76f9">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../13172/it-possible-apply-many-point-sources-without-python-for-loop">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="13173"></a><div class="entry-content"><p>Yes it is possible to apply the point sources all at the same time.  You need to provide a list of tuples each which contain the point and magnitude of the point source and then apply.</p>

<p>Here is some sample code.</p>

<pre><code>mesh_obj = UnitSquareMesh(10,10)
V = FunctionSpace( mesh_obj, "CG", 1 )
v = TestFunction( V )
L = Constant(0.0) * v * dx
b  = assemble ( L )
point_sources = [(Point(0.5, 0.5), 1.0), (Point(0.3, 0.7), 1.0)]

ps = PointSource(V, point_sources)
ps.apply(b)
</code></pre>

<p>If you are running in parallel, you need to make sure that the points are either all provided on one processor or only locally on the processor that own the points.  This stops them being added twice.</p>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-meta">
														<a href="../../13172/it-possible-apply-many-point-sources-without-python-for-loop?show=13173#a13173" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-04-23T10:52:12+0000"></span>Apr 23, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Ettie+Unwin" class="qa-user-link url nickname">Ettie Unwin</a></span></span>
															<span class="qa-a-item-who-title">FEniCS Novice</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">650</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2017-04-26T16:06:45+0000"></span>Apr 26, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/chris_richardson" class="qa-user-link url nickname">chris_richardson</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c13173_list">
												<div class="qa-c-list-item  hentry comment" id="c13175">
													<div class="qa-c-item-content">
														<a name="13175"></a><div class="entry-content"><p>Thank you Ettie thats exactly what I was looking for. For the parallel point source issue, do you have a sample code?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13172/it-possible-apply-many-point-sources-without-python-for-loop?show=13175#c13175" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-23T19:42:02+0000"></span>Apr 23, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/alexmm" class="qa-user-link url nickname">alexmm</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,240</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13180">
													<div class="qa-c-item-content">
														<a name="13180"></a><div class="entry-content"><p>If you just have a list and don't know which processor owns them, the easiest way is just to choose one of the processors to add it on, in this example it is the rank 0 processor.  The function then works out which processor owns them to add them to the correct part of the matrix.</p>

<pre><code>mesh_obj= UnitSquareMesh(1,1)
V = FunctionSpace( mesh_obj, "CG", 1 )
v = TestFunction( V )
L = Constant(0.0) * v * dx
b  = assemble ( L )  
point_sources = [];

if MPI.rank(mesh_obj.mpi_comm()) == 0:
     point_sources = [(Point(0.5, 0.5), 1.0), (Point(0.3, 0.7), 1.0)]

ps = PointSource(V, point_sources)
ps.apply(b)
</code></pre>

<p>If you know which ones are on each processor you can have a different list for each of them.  If you look in the unit tests for the PointSource function there are some tests showing some more examples of how to add them in parallel.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13172/it-possible-apply-many-point-sources-without-python-for-loop?show=13180#c13180" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-24T10:22:00+0000"></span>Apr 24, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Ettie+Unwin" class="qa-user-link url nickname">Ettie Unwin</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">650</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13202">
													<div class="qa-c-item-content">
														<a name="13202"></a><div class="entry-content"><p>Hi Ettie, I'm trying to put all the points and magnitudes for the point source on a list like this:</p>

<pre><code>point_sources = []
nSources = int(l/l_i)
edge     = (l-l_i*nSources)/2.0

for nx in range(0, nSources+1): 
    for ny in range(0, nSources+1): 
    for nz in range(0, nSources+1):

        x = -l/2.0 + edge + nx*l_i
        y = -l/2.0 + edge + ny*l_i
        z = -l/2.0 + edge + nz*l_i

        if np.sqrt(x*x + y*y + z*z) &lt; d_i/2.0:
        point_sources.append((Point(x, y, z), ps_mag))  

delta = PointSource(V, point_sources)
</code></pre>

<p>But I get the following error:</p>

<p>File "main.py", line 89, in <br>
    delta = PointSource(V, point_sources)<br>
  File "/usr/lib/python2.7/dist-packages/dolfin/cpp/fem.py", line 1744, in <strong>init</strong><br>
    _fem.PointSource_swiginit(self, _fem.new_PointSource(V, p, magnitude))<br>
TypeError: in method 'new_PointSource', argument 2 of type 'dolfin::Point const &amp;'<br>
Aborted (core dumped)</p>

<p>Do you know what the problem is?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13172/it-possible-apply-many-point-sources-without-python-for-loop?show=13202#c13202" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-25T03:17:00+0000"></span>Apr 25, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/alexmm" class="qa-user-link url nickname">alexmm</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,240</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13224">
													<div class="qa-c-item-content">
														<a name="13224"></a><div class="entry-content"><p>The code you posted is not working, I run the exact same code and I get the same error:</p>

<p>Calling FFC just-in-time (JIT) compiler, this may take some time.<br>
Traceback (most recent call last):<br>
  File "test.py", line 23, in <br>
    ps = PointSource(V, point_sources)<br>
  File "/usr/lib/python2.7/dist-packages/dolfin/cpp/fem.py", line 1744, in <strong>init</strong><br>
    _fem.PointSource_swiginit(self, _fem.new_PointSource(V, p, magnitude))<br>
TypeError: in method 'new_PointSource', argument 2 of type 'dolfin::Point const &amp;'<br>
Aborted (core dumped)</p>

<p>I'm using dolfin version 2016.2.0</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13172/it-possible-apply-many-point-sources-without-python-for-loop?show=13224#c13224" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-26T01:51:34+0000"></span>Apr 26, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/alexmm" class="qa-user-link url nickname">alexmm</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,240</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13226">
													<div class="qa-c-item-content">
														<a name="13226"></a><div class="entry-content"><p>This feature was only added to the development version in the past month or so.  If you are using the stable release it won't be there until a new release is made.  I would suggest trying the development version.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13172/it-possible-apply-many-point-sources-without-python-for-loop?show=13226#c13226" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-26T08:56:53+0000"></span>Apr 26, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Ettie+Unwin" class="qa-user-link url nickname">Ettie Unwin</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">650</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13233">
													<div class="qa-c-item-content">
														<a name="13233"></a><div class="entry-content"><p>So you mean the PointSource function accepting a list is not in the stable release? It works for one point source. I will try the development version thank you</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13172/it-possible-apply-many-point-sources-without-python-for-loop?show=13233#c13233" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-26T13:48:38+0000"></span>Apr 26, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/alexmm" class="qa-user-link url nickname">alexmm</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,240</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13235">
													<div class="qa-c-item-content">
														<a name="13235"></a><div class="entry-content"><p>You need to use the development version of DOLFIN available from the bitbucket repository.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/nate" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=969593914916706065&amp;qa_size=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../13172/it-possible-apply-many-point-sources-without-python-for-loop?show=13235#c13235" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-26T14:21:22+0000"></span>Apr 26, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/nate" class="qa-user-link url nickname">nate</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">17,050</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467855-f2a255e8e1e4680151e7ceed6dea62c3238064e5">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>