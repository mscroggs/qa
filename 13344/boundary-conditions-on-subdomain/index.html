<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Boundary conditions on subdomain - FEniCS Q&amp;A</title>
		<meta name="description" content="Hi, I'd like to specify a boundary condition as being on the edge of a mesh subdomain, rather than  ...  [1]: https://image.ibb.co/n9QiMQ/text4495.png">
		<meta name="keywords" content="dirichletbc,boundary-conditions,boundary">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/13344/boundary-conditions-on-subdomain">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Boundary conditions on subdomain</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q13344">
								<form method="post" action="../../13344/boundary-conditions-on-subdomain">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_13344">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+3<span class="votes-up"><span class="value-title" title="3"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467862-c4301b867c2931eb50a6578190ec9521ca7bf93f">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../13344/boundary-conditions-on-subdomain">
										<div class="qa-q-view-content">
											<a name="13344"></a><div class="entry-content"><p>Hi, I'd like to specify a boundary condition as being on the edge of a mesh subdomain, rather than having to supply a particular condition in my code (e.g. near(x[0], 1)). I have read the fenics tutorial and have successfully made mesh subdomains (Sec 4.5 in the tutorial vol 1), but am uncertain as to how to specify the edges of these subdomains for boundary conditions.</p>

<p>For example I might want to solve the Laplace equation, del^2 u = 0, for the geometry shown below, with the solution u=5 at the boundaries of the arbitrary shape near the centre and u=0 at the edges of the square domain. How would I specify the edges of the arbitrary shape as a DirichletBC without specifying any coordinates?</p>

<p>Can somebody please post a simple example, and if possible a complete script with simple mesh definitions (e.g. a circle inside a square).</p>

<p>Thanks for your help.</p>

<p><img src="https://image.ibb.co/n9QiMQ/text4495.png" alt="enter image description here"></p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/dirichletbc" rel="tag" class="qa-tag-link">dirichletbc</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/boundary-conditions" rel="tag" class="qa-tag-link">boundary-conditions</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/boundary" rel="tag" class="qa-tag-link">boundary</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../13344/boundary-conditions-on-subdomain" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2017-05-05T22:24:22+0000"></span>May 6, 2017</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/NH86Sbd" class="qa-user-link url nickname">NH86Sbd</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">180</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c13344_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467862-70695278c92c9636c50d4e6b084c5d3112938769">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">2 Answers</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a13376">
									<form method="post" action="../../13344/boundary-conditions-on-subdomain">
										<div class="qa-voting qa-voting-net" id="voting_13376">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467862-c4301b867c2931eb50a6578190ec9521ca7bf93f">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../13344/boundary-conditions-on-subdomain">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="13376"></a><div class="entry-content"><p>Hi, </p>

<p>I had the same problem. Here is an example that might help you:</p>

<pre><code>from dolfin import *
from mshr import *
from math import pi

# -------------------- #
#     Create  mesh     #
# -------------------- #
rectangle = Rectangle(Point(-1., -1.), Point(1., 1.))
R = 0.5
origin = Point(0.,0.)
circle = Circle(origin, R, segments=32)
domain = rectangle
domain.set_subdomain(1, circle)
domain.set_subdomain(2, rectangle - circle)
mesh = generate_mesh(domain, 15) # 15 is the resolution


# Create subdomains
subdomains = MeshFunction("size_t", mesh, 2, mesh.domains())


# -------------------- #
#   Create boundaries  #
# -------------------- #
class Left(SubDomain):
    def inside(self, x, on_boundary):
        return on_boundary and abs(x[0] + 1.) &lt; DOLFIN_EPS

class Right(SubDomain):
    def inside(self, x, on_boundary):
        return on_boundary and abs(x[0] - 1.) &lt; DOLFIN_EPS

class Bottom(SubDomain):
    def inside(self, x, on_boundary):
        return on_boundary and abs(x[1] + 1.) &lt; DOLFIN_EPS

class Top(SubDomain):
    def inside(self, x, on_boundary):
        return on_boundary and abs(x[1] - 1.) &lt; DOLFIN_EPS


boundaries = FacetFunction("size_t", mesh, 0 ) # this index 0 is an alternative to the command boundaries.set_all(0)

Bottom().mark(boundaries, 1)
Left().mark(boundaries, 2)
Right().mark(boundaries, 2)
Top().mark(boundaries, 3)

# ---------------------------- #
#   Create boundary interface  #
# ---------------------------- #
# Option 1: 
    for f in facets(mesh):
   domains = []
   for c in cells(f):
       domains.append(subdomains[c])
   domains = list(set(domains)) # remove duplicates
   if len(domains) &gt; 1: # it is on the interface
       boundaries[f] = 4
# Option 2:
#for f in facets(mesh): # For all edges in the mesh
#    p0 = Vertex(mesh, f.entities(0)[0]) # save the two ending points p0 and p1
#    p1 = Vertex(mesh, f.entities(0)[1])
#    if near(p0.x(0)*p0.x(0) + p0.x(1)*p0.x(1), R*R, 0.05) and near(p1.x(0)*p1.x(0) + p1.x(1)*p1.x(1), R*R, 0.05): # check if the points lie on the circle - if yes, put a label on this edge
#        boundaries[f] = 4



# --------------------------------- #
# Chech that everything is correct  #
# --------------------------------- #

# Define a function of ones on the mesh
V = FunctionSpace(mesh, "CG", 1)
f = Function(V)
f.vector()[:] = 1.

# dS on the inteface = 2*pi*R
dS = dS(subdomain_data=boundaries)
form4 = f*dS(4) # integration on the whole facet marked with number 4
print form4
ans = assemble(form4)   
print ans, "vs", 2*pi*R

# dS on an external boundary = 0
form1 = f*dS(1) 
ans = assemble(form1)  
print ans, "vs", 2., "~&gt;", "dS is non zero only in the boundaries' interface!"

# ds on an external boundary = 2
ds = ds(subdomain_data=boundaries)
form1 = f*ds(1) # integration on the external boundary marked with number 1
ans = assemble(form1)   
print ans, "vs", 2.
</code></pre>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-meta">
														<a href="../../13344/boundary-conditions-on-subdomain?show=13376#a13376" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-05-08T10:05:49+0000"></span>May 8, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/caterinabig" class="qa-user-link url nickname">caterinabig</a></span></span>
															<span class="qa-a-item-who-title">FEniCS User</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">1,460</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2017-05-09T19:38:44+0000"></span>May 9, 2017</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/NH86Sbd" class="qa-user-link url nickname">NH86Sbd</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c13376_list">
												<div class="qa-c-list-item  hentry comment" id="c13384">
													<div class="qa-c-item-content">
														<a name="13384"></a><div class="entry-content"><p>Thank you for responding,</p>

<p>If you had the same problem, then how did you resolve the problem? The example you have posted is interesting, and I could see aspects of it as being a part of the solution, but it is also not a direct answer to my question. No boundary conditions are applied in this example. Do you think you could answer the question more directly? How can I use this to apply boundary conditions to these subdomains.</p>

<p>Thanks again.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13384#c13384" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-08T23:31:43+0000"></span>May 9, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/NH86Sbd" class="qa-user-link url nickname">NH86Sbd</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">180</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13393">
													<div class="qa-c-item-content">
														<a name="13393"></a><div class="entry-content"><p>Hi again,</p>

<p>I've given this a bit more of a go and by working from your example I have been successful. This method isn't particularly elegant - it's looping through all facets, as per the suggestion from meron, but it has managed to get the job done. You will notice a part of your example code within the script, thank you.</p>

<p>My final (successful) code is as follows</p>

<pre><code>import fenics as fn
import mshr as ms

# Define Constants
domain_width = 10.0
circ_rad = 2.0

#Define Mesh Objects
domain = ms.Rectangle(fn.Point(-domain_width/2, -domain_width/2),
                    fn.Point(domain_width/2, domain_width/2))
circ = ms.Circle(fn.Point(0.0, 0.0), circ_rad/2)

# Make subdomain from mesh elements
domain.set_subdomain(2, circ)

# Generate Mesh 
mesh = ms.generate_mesh(domain, 200)

# Define boundaries 
boundary_markers = fn.MeshFunction('size_t', mesh, 2, mesh.domains())
boundaries = fn.MeshFunction('size_t', mesh, 1, mesh.domains())

# Use the cell domains associated with each facet to set the boundary
for f in fn.facets(mesh):
    domains = []
    for c in fn.cells(f):
        domains.append(boundary_markers[c])

    domains = list(set(domains))
    if len(domains) &gt; 1:
        boundaries[f] = 2


# Make Function Space
V = fn.FunctionSpace(mesh, 'P', 2)

# Boundary on central shape
box_bc = fn.DirichletBC(V, fn.Constant(5), boundaries, 2)

# Outer Boundary
domain_bc = fn.DirichletBC(V, fn.Constant(0), 'on_boundary')
bcs = [box_bc, domain_bc]

# Solve
u = fn.TrialFunction(V)
v = fn.TestFunction(V)
a = fn.dot(fn.grad(u), fn.grad(v)) * fn.dx
L = fn.Constant('0') * v * fn.dx
u = fn.Function(V)
fn.solve(a == L, u, bcs)

# Output
outputFile = fn.File('postOutput.pvd')
outputFile &lt;&lt; u
</code></pre>

<p>The output of this script is shown in the image below</p>

<p><img src="https://image.ibb.co/mgFOqk/post_output2.png" alt="enter image description here"></p>

<p>Note that my boundary is labelled 2, and that this can be changed if the script is to be used by others. I believe that this script could quite easily be modified to, for example, set boundary conditions on two shapes by replacing the </p>

<pre><code>    if len(domains) &gt; 1: # it is on the interface
        boundaries[f] = 2
</code></pre>

<p>with something that checks which domains are listed and assigns the appropriate boundary identifier.</p>

<p>I will mark this as the best answer, since I have actually got a working solution from it, but I think it is fair to say that looping through all facets shouldn't be necessary. As meron demonstrated boundaries are not automatically identified, while the subdomains are. This feels like a bug; although I am a new user and it is possible that there's a very good reason for this that I am unaware of. In any case I feel that setting a boundary condition on a geometric object defined with the software should not be so involved.</p>

<p>Thank you very much for your help caterinabig and meron.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13393#c13393" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-09T19:33:42+0000"></span>May 9, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/NH86Sbd" class="qa-user-link url nickname">NH86Sbd</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">180</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
																<br>
																<span class="qa-c-item-what">edited</span>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="updated"><span class="value-title" title="2017-05-10T07:42:49+0000"></span>May 10, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span><span class="qa-c-item-who-data"><a href="../../user/NH86Sbd" class="qa-user-link url nickname">NH86Sbd</a></span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13414">
													<div class="qa-c-item-content">
														<a name="13414"></a><div class="entry-content"><p>I agree, it's not very elegant, but it works and you have to do it only once when you generate the mesh. </p>

<p>Indeed, once you know how to mark facets on the interface (in your case with number 2) then you simply use the DirichletBC function as for any other boundary:</p>

<pre><code>box_bc = fn.DirichletBC(V, fn.Constant(5), boundaries, 2)
</code></pre>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13414#c13414" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-11T07:39:20+0000"></span>May 11, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/caterinabig" class="qa-user-link url nickname">caterinabig</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">1,460</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467862-98b4e2dd03aba917012794be5e1469ee21b434b8">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
								<div class="qa-a-list-item  hentry answer" id="a13354">
									<form method="post" action="../../13344/boundary-conditions-on-subdomain">
										<div class="qa-voting qa-voting-net" id="voting_13354">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467862-c4301b867c2931eb50a6578190ec9521ca7bf93f">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../13344/boundary-conditions-on-subdomain">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="13354"></a><div class="entry-content"><p>Hey there,</p>

<p>I think what you need is covered in the tutorial <a rel="nofollow" href="https://fenicsproject.org/pub/tutorial/html/._ftut1013.html#ftut:possion:2D:2mat:impl">here</a>. Does that help?</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/wilhelmbraun" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=8837047155364839364&amp;qa_size=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../13344/boundary-conditions-on-subdomain?show=13354#a13354" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-05-06T19:28:10+0000"></span>May 6, 2017</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/wilhelmbraun" class="qa-user-link url nickname">wilhelmbraun</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">2,070</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c13354_list">
												<div class="qa-c-list-item  hentry comment" id="c13355">
													<div class="qa-c-item-content">
														<a name="13355"></a><div class="entry-content"><p>Hi thank you for responding. As far as I can see what I want is not covered in that part of the tutorial. In the linked example the subdomain is specified with </p>

<pre><code>tol = 1E-14
class Omega_0(SubDomain):
        def inside(self, x, on_boundary):
            return x[1] &lt;= 0.5 + tol
</code></pre>

<p>however my question is how to avoid having to specify things like x[1] &lt;= 0.5.</p>

<p>Perhaps I could be more clear. If I define a mesh with, for example,</p>

<pre><code>import fenics as fn
import mshr as ms

domain_width = 10.0
circ_rad = 2.0

domain = ms.Rectangle(fn.Point(-domain_width/2, -domain_width/2),
                      fn.Point(domain_width/2, domain_width/2))                                                                      
circ = ms.Circle(fn.Point(0.0, 0.0), circ_rad/2)                                                                                 
domain.set_subdomain(2, circ)
mesh = ms.generate_mesh(domain, 30)
</code></pre>

<p>This makes a mesh with a clear circle. I would then like to specify a DirichletBC on the edge of this circle, <strong>without</strong> having to manually specify the equation of the circle.</p>

<p>I have not yet achieved this, however I have tried things such as</p>

<pre><code>V = fn.FunctionSpace(mesh, 'P', 2) 
boundary_markers = fn.MeshFunction('size_t', mesh, 1, mesh.domains())

box_bc = fn.DirichletBC(V, fn.Constant(5.0), boundary_markers, 2)
domain_bc = fn.DirichletBC(V, fn.Constant(0.0), 'on_boundary')                                                                                                      
bcs = [box_bc, domain_bc]
</code></pre>

<p>However when using this to solve, I get "Warning: Found no facets matching domain for boundary condition." and the BC is not applied anywhere. I'd like to know where I am going wrong.</p>

<p>Thanks again for your help.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13355#c13355" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-06T20:17:06+0000"></span>May 6, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/NH86Sbd" class="qa-user-link url nickname">NH86Sbd</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">180</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13356">
													<div class="qa-c-item-content">
														<a name="13356"></a><div class="entry-content"><p>What can go wrong is that with your specified boundary marker, the mesh is too coarse to "see" the circle- one fix is to make your mesh less coarse, which should be straightforward to achieve. Does that work?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/wilhelmbraun" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=8837047155364839364&amp;qa_size=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13356#c13356" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-06T20:20:42+0000"></span>May 6, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/wilhelmbraun" class="qa-user-link url nickname">wilhelmbraun</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,070</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13357">
													<div class="qa-c-item-content">
														<a name="13357"></a><div class="entry-content"><p>I have just tried making my mesh more dense by using 200, rather than 30 in the generate_mesh() function. It now reads</p>

<pre><code>mesh = ms.generate_mesh(domain, 200)
</code></pre>

<p>This has not fixed the issue, and I still receive the "*** Warning: Found no facets matching domain for boundary condition."</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13357#c13357" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-06T20:33:23+0000"></span>May 6, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/NH86Sbd" class="qa-user-link url nickname">NH86Sbd</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">180</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13358">
													<div class="qa-c-item-content">
														<a name="13358"></a><div class="entry-content"><p>Can you find cells in the subdomain defined by the circle?  <br>
You can find how to do this <a rel="nofollow" href="https://fenicsproject.org/qa/6500/identify-all-cells-within-subdomain">here</a>.</p>

<p>If not, the subdomain was not created for some reason.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/wilhelmbraun" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=8837047155364839364&amp;qa_size=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13358#c13358" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-06T21:06:51+0000"></span>May 6, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/wilhelmbraun" class="qa-user-link url nickname">wilhelmbraun</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,070</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13359">
													<div class="qa-c-item-content">
														<a name="13359"></a><div class="entry-content"><p>I'm not sure how to do this when I have specified my geometry with mshr, and then haven't manually made a SubDomain child class.</p>

<p>If you know how to achieve what I'm asking for please could you post an example code.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13359#c13359" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-06T21:29:22+0000"></span>May 6, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/NH86Sbd" class="qa-user-link url nickname">NH86Sbd</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">180</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13361">
													<div class="qa-c-item-content">
														<a name="13361"></a><div class="entry-content"><p>Hi again,</p>

<p>I wasn't sure how to check this using the methods on that thread. Their examples had a subdomain being defined as a SubDomain child class. My subdomains are made as a part of the mesh, and thus I don't have a manually defined SubDomain child class.</p>

<p>To try and overcome this, I've tried to tag the cells inside the subdomain. To do this I changed my meshfunction to be 2D and then made an expression, which allows me to check the cell index. I applied a Dirichlet boundary to <strong>every</strong> point (set with a function that always returns true), with a value set by this expression. This has allowed me to highlight cells which belong to different domains. My full code is </p>

<pre><code>import fenics as fn
import mshr as ms

# Define Constants
domain_width = 10.0
circ_rad = 2.0

#Define Mesh Objects
domain = ms.Rectangle(fn.Point(-domain_width/2, -domain_width/2),
                  fn.Point(domain_width/2, domain_width/2))
circ = ms.Circle(fn.Point(0.0, 0.0), circ_rad/2)

# Make subdomain from mshr geometric elements
domain.set_subdomain(2, circ)

# Generate Mesh and MeshFunction
mesh = ms.generate_mesh(domain, 200)
boundary_markers = fn.MeshFunction('size_t', mesh, 2, mesh.domains())

# Make Function Space
V = fn.FunctionSpace(mesh, 'P', 2)

# Boundary Conditions
class tempClass(fn.Expression):
    '''
    Temporary expression for setting dummy boundary condition
    '''
    def __init__(self, markers, **kwargs):
    self.markers = markers

    def eval_cell(self, values, x, cell):
    if self.markers[cell.index] == 2:
        values[0] = 5.0
    else:
        values[0] = 0.0

def tempFunc(x, on_boundary):
    '''
    Temporary function for setting dummy boundary condition
    '''
    return True

# Boundary on central shape
box_potential = tempClass(boundary_markers, degree=1)  # Expression
box_bc = fn.DirichletBC(V, box_potential, tempFunc)

# Outer Boundary
domain_bc = fn.DirichletBC(V, fn.Constant(0), 'on_boundary')
bcs = [box_bc, domain_bc]

# Solve
u = fn.TrialFunction(V)
v = fn.TestFunction(V)
a = fn.dot(fn.grad(u), fn.grad(v)) * fn.dx
L = fn.Constant('0') * v * fn.dx
u = fn.Function(V)
fn.solve(a == L, u, bcs)

# Output
outputFile = fn.File('postOutput.pvd')
outputFile &lt;&lt; u
</code></pre>

<p>The output of this is shown in the image below. Clearly the circle is being identified as being in the subdomain of index 2. However I still do not know how to set a Dirichlet boundary condition on the edge of this subdomain in a similar way.</p>

<p><img src="https://image.ibb.co/cpDSy5/post_output.png" alt="enter image description here"></p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13361#c13361" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-07T11:55:01+0000"></span>May 7, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/NH86Sbd" class="qa-user-link url nickname">NH86Sbd</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">180</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
																<br>
																<span class="qa-c-item-what">edited</span>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="updated"><span class="value-title" title="2017-05-07T12:39:37+0000"></span>May 7, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span><span class="qa-c-item-who-data"><a href="../../user/NH86Sbd" class="qa-user-link url nickname">NH86Sbd</a></span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13362">
													<div class="qa-c-item-content">
														<a name="13362"></a><div class="entry-content"><p>Ok, that looks good. So you are able to set boundary conditions in the circle that appears yellow in the plot above, but what you want is to pose the boundary condition only on the outer edge? Clearly, this must have something to do with the way that <code>circ</code> is defined- everything <em>inside the circle</em> has a subdomain marker 2 . A solution is to define a second circle with a radius slightly bigger than the first one and then define Dirichlet BCs on the resulting annulus. E.g. if the second circle has a subdomain marker 4, then use </p>

<p><code>if self.markers[cell.index] != 2 and self.markers[cell_index] == 4:</code></p>

<p>to pose a BC on the annulus.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/wilhelmbraun" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=8837047155364839364&amp;qa_size=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13362#c13362" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-07T16:04:16+0000"></span>May 7, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/wilhelmbraun" class="qa-user-link url nickname">wilhelmbraun</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,070</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13364">
													<div class="qa-c-item-content">
														<a name="13364"></a><div class="entry-content"><p>Sorry, but the script above is nothing like what I actually want to achieve, it just highlights that the circle is being placed into a subdomain. I have not set a boundary condition on the circle, I "selected" it with an expression, and applied a boundary condition to every single point on the mesh; that's why the solution has every point as either 0 or 5. That's not much better than drawing a circle in mspaint, and it is <strong>not</strong> the same as applying a boundary condition on the circle.</p>

<p>It makes little difference to me whether I apply the boundary condition just to the edge of the circle or to the whole circle, but I want to apply the BC to the subdomain that the circle is in. Do you know how to do this?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13364#c13364" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-07T16:49:58+0000"></span>May 7, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/NH86Sbd" class="qa-user-link url nickname">NH86Sbd</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">180</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13370">
													<div class="qa-c-item-content">
														<a name="13370"></a><div class="entry-content"><p>Hi!<br>
It seems you can get subdomains (dx measure) but not boundaries (ds/dS) from the mesh.<br>
If you look at the line you used to compute the boundary markers on a facetfunction and inspect them<br>
</p><pre><br>
boundary_markers = fn.MeshFunction('size_t', mesh, 1, mesh.domains())<br>
import numpy as np<br>
print np.unique(boundary_markers.array()[:])<br>
</pre><br>
You can indeed see that no boundaries have been set.<br>
When using a cellfunction (change the 1 to 2) you can see the regions, but this can't be used to impose a boundary condition.<br>
Since I don't know how (and whether) the boundaries can actually be found in the mesh, you could write a script to compute the boundaries based on the subdomains (if you want I could send a script). Not a very nice solution, but it would work.
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../13344/boundary-conditions-on-subdomain?show=13370#c13370" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-08T07:55:40+0000"></span>May 8, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/meron" class="qa-user-link url nickname">meron</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,340</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467862-c326de0061d8a3c6ea9643482de9368f26bb89f1">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>