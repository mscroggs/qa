<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Remeshing advice - FEniCS Q&amp;A</title>
		<meta name="description" content='Dear all, I am playing with some domain changes, and I need to remesh my domain. ... with the equivalent of "PolygonalMeshGenerator.generate". Thanks!'>
		<meta name="keywords" content="mesh,updatemesh,c,remesh">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/7036/remeshing-advice">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Remeshing advice</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q7036">
								<form method="post" action="../../7036/remeshing-advice">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_7036">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+2<span class="votes-up"><span class="value-title" title="2"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468101-6a63092f1b218e184e4008c8b6393dd6361f6a2a">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../7036/remeshing-advice">
										<div class="qa-q-view-content">
											<a name="7036"></a><div class="entry-content"><p>Dear all,</p>

<p>I am playing with some domain changes, and I need to remesh my domain. Right now it's not smart, I just create a new mesh. However, the domain changes are really small (per step), so I could easily remesh a portion of it.</p>

<p>Can you give me some advice? I've never done this with Fenics, so I'm pretty newbie.</p>

<p>I will need to generate the domain (a cracked rectangle) using C++, with the equivalent of "PolygonalMeshGenerator.generate". </p>

<p>Thanks!</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/mesh" rel="tag" class="qa-tag-link">mesh</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/updatemesh" rel="tag" class="qa-tag-link">updatemesh</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/c" rel="tag" class="qa-tag-link">c</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/remesh" rel="tag" class="qa-tag-link">remesh</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../7036/remeshing-advice" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2015-05-04T16:28:18+0000"></span>May 4, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/senseiwa" class="qa-user-link url nickname">senseiwa</a></span></span>
													<span class="qa-q-view-who-title">FEniCS User</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">2,620</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c7036_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468101-fc0f9e706a19f45384889311e15bc99ec5c7fd43">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a7044">
									<form method="post" action="../../7036/remeshing-advice">
										<div class="qa-voting qa-voting-net" id="voting_7044">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468101-6a63092f1b218e184e4008c8b6393dd6361f6a2a">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../7036/remeshing-advice">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="7044"></a><div class="entry-content"><p>There is currently no support for remeshing of subdomains so you will need to remesh the whole thing, or: manually extract the portion you want to remesh, then remesh it so that it matches the remaining part of the mesh, then stitch the meshes back together again. That could make a nice utility function.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/logg" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/d2401a1635e91a5d9bf0db871a22abee?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../7036/remeshing-advice?show=7044#a7044" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2015-05-04T19:31:07+0000"></span>May 4, 2015</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/logg" class="qa-user-link url nickname">logg</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">11,790</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c7044_list">
												<div class="qa-c-list-item  hentry comment" id="c7053">
													<div class="qa-c-item-content">
														<a name="7053"></a><div class="entry-content"><p>So, that would be ok, if I can do it :)</p>

<p>In essence:</p>

<ol>
<li>I need to <strong>mark</strong> some cells, and that I think I can do: I did it in python for assigning boundary conditions, correct me if I'm wrong, but wouldn't that be the same concept?</li>
<li>Then, as far as I understand, I should <strong>remove</strong> the cells storing them apart, creating a de facto new domain.</li>
<li>After that, I must <strong>remesh</strong> my subdomain with I think some constraints on the boundary, leaving the nodes and edges untouched.</li>
<li>Finally, <strong>merge</strong> the new mesh with the old one.</li>
</ol>

<p>Can you point me in the right direction? What classes do you think I should be looking for? </p>

<p>Obviously, if the computation is distributed, something will be different, but I don't know anyting about the inner workings of fenics... I'm a newbie!</p>

<p>Thanks!</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../7036/remeshing-advice?show=7053#c7053" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-05-05T11:13:14+0000"></span>May 5, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/senseiwa" class="qa-user-link url nickname">senseiwa</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,620</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c7059">
													<div class="qa-c-item-content">
														<a name="7059"></a><div class="entry-content"><p>My first comment would be that this is a relatively hard function to code up. For such a function to really shine, it should be implemented in C++, made available to Python via SWIG and also run seamlessly in parallel.</p>

<p>However: I would suggest coding this up in Python: mark the region you want to remesh using a <code>CellFunction</code>, then extract that region as a <code>SubMesh</code>, then take the <code>BoundaryMesh</code> of that, manually create a polygon from it, send that polygon to the mesh generator, get a new mesh, then finally stitch it together with the rest using <code>MeshEditor</code> to create a new <code>Mesh</code>.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/logg" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/d2401a1635e91a5d9bf0db871a22abee?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../7036/remeshing-advice?show=7059#c7059" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-05-05T20:25:01+0000"></span>May 5, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/logg" class="qa-user-link url nickname">logg</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">11,790</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c7206">
													<div class="qa-c-item-content">
														<a name="7206"></a><div class="entry-content"><p>Thanks @logg,</p>

<p>I'm trying this approach, but I am stuck with the polygon generation. I get an error on the orientation, it seems that the vertices are not oriented CCW: <code>Unable to create polygon. Polygonv vertices must be given in counter clockwise order. This error was encountered inside CSGPrimitives2D.cpp.</code>.</p>

<p>I've tried with <code>std::vector</code> and an array (for no reason at all), but the error persists.</p>

<p>Do you have any recommendation?</p>

<p>Thanks!</p>

<pre><code>    // Extract a subdomain
    SubMesh submesh(simple, marker_extractor, 1);

    // Get the boundary
    BoundaryMesh boundary(submesh, "local");

    // Vector of Points from the boundary
    std::vector&lt;Point&gt; vv;

    // Iterate and add to vv each point
    for (CellIterator c(boundary); !c.end(); ++c)
    {
        double v[2];
        //std::vector&lt;double&gt; v;
        c-&gt;get_vertex_coordinates(v);

        std::cout &lt;&lt; "B idx " &lt;&lt; c-&gt;index() &lt;&lt; " coords " &lt;&lt; v[0] &lt;&lt; ", " &lt;&lt; v[1];

//        for(auto p : v)
//        {
//            std::cout &lt;&lt; p &lt;&lt; ",";
//        }

        std::cout &lt;&lt; std::endl;

        vv.push_back(Point(2, v));
    }

    // New polygon
    mshr::Polygon boundary_polygon(vv);
</code></pre>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../7036/remeshing-advice?show=7206#c7206" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-05-20T15:57:02+0000"></span>May 20, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/senseiwa" class="qa-user-link url nickname">senseiwa</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,620</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468101-0dfb6551ed8c68c98a1acf29c71d4df2f0bcf0c5">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>