<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>DG solve in parallel - FEniCS Q&amp;A</title>
		<meta name="description" content="Dear all, I have been trying to run my DG code in parallel and it generates the following  ... the linear solve in parallel? Thanks a lot! Vincent">
		<meta name="keywords" content="dg,parallel,linear-solver">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/4078/dg-solve-in-parallel">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">DG solve in parallel</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q4078">
								<form method="post" action="../../4078/dg-solve-in-parallel">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_4078">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+7<span class="votes-up"><span class="value-title" title="7"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467999-b58de5d3c4c86227781bf01c4ce39e645087a409">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../4078/dg-solve-in-parallel">
										<div class="qa-q-view-content">
											<a name="4078"></a><div class="entry-content"><p>Dear all,</p>

<p>I have been trying to run my DG code in parallel and it generates the following error:</p>

<blockquote>
  <p>Error:   Unable to perform operation in parallel.<br>
   Reason:  Assembly over interior facets is not yet working in parallel.</p>
</blockquote>

<p>I saw that it is simply because it has not been implemented so far (see <a rel="nofollow" href="https://answers.launchpad.net/dolfin/+question/219901">https://answers.launchpad.net/dolfin/+question/219901</a> )</p>

<p>But I was still wondering: would there be a way to assemble the forms in serial and perform the linear solve in parallel?</p>

<p>Thanks a lot!<br>
Vincent</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/dg" rel="tag" class="qa-tag-link">dg</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/parallel" rel="tag" class="qa-tag-link">parallel</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/linear-solver" rel="tag" class="qa-tag-link">linear-solver</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../4078/dg-solve-in-parallel" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2014-07-08T19:26:57+0000"></span>Jul 8, 2014</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/V_L" class="qa-user-link url nickname">V_L</a></span></span>
													<span class="qa-q-view-who-title">FEniCS User</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">4,440</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c4078_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467999-d84d5a51c830532fc9e680a4c75b7f3233655cba">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">3 Answers</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a4087">
									<form method="post" action="../../4078/dg-solve-in-parallel">
										<div class="qa-voting qa-voting-net" id="voting_4087">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+7<span class="votes-up"><span class="value-title" title="7"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467999-b58de5d3c4c86227781bf01c4ce39e645087a409">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../4078/dg-solve-in-parallel">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="4087"></a><div class="entry-content"><p>This will be supported in the main branch soon. Experimental support is in <a rel="nofollow" href="https://bitbucket.org/fenics-project/dolfin/branch/garth/ghost-mesh-dof-map">https://bitbucket.org/fenics-project/dolfin/branch/garth/ghost-mesh-dof-map</a></p>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-meta">
														<a href="../../4078/dg-solve-in-parallel?show=4087#a4087" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-07-10T08:33:39+0000"></span>Jul 10, 2014</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Garth+N.+Wells" class="qa-user-link url nickname">Garth N. Wells</a></span></span>
															<span class="qa-a-item-who-title">FEniCS Expert</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">35,930</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2014-07-10T13:00:44+0000"></span>Jul 10, 2014</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/V_L" class="qa-user-link url nickname">V_L</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c4087_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467999-99340ca6e84a98bb15ecfead19f8715f12740c8c">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
								<div class="qa-a-list-item  hentry answer" id="a4172">
									<form method="post" action="../../4078/dg-solve-in-parallel">
										<div class="qa-voting qa-voting-net" id="voting_4172">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467999-b58de5d3c4c86227781bf01c4ce39e645087a409">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../4078/dg-solve-in-parallel">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="4172"></a><div class="entry-content"><blockquote>
  <p>But I was still wondering: would there be a way to assemble the forms<br>
  in serial and perform the linear solve in parallel?</p>
</blockquote>

<p>You can serialize it if the parallelization is with OpenMP:</p>

<pre><code>int num_threads = dolfin::parameters["num_threads"];
dolfin::parameters["num_threads"] = 0;

// do assembly

dolfin::parameters["num_threads"] = num_threads;
</code></pre>

<p>I did this for assembling along the facets (boundary integral to get heat flux)</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/Charles" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/22e56480a5d5f76ee11abebe5dc8d5a6?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../4078/dg-solve-in-parallel?show=4172#a4172" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-07-20T15:29:18+0000"></span>Jul 20, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Charles" class="qa-user-link url nickname">Charles</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">4,220</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
													<br>
													<span class="qa-a-item-what">edited</span>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2014-07-21T16:39:14+0000"></span>Jul 21, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/Charles" class="qa-user-link url nickname">Charles</a></span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c4172_list">
												<div class="qa-c-list-item  hentry comment" id="c4174">
													<div class="qa-c-item-content">
														<a name="4174"></a><div class="entry-content"><p>I tried to do as you suggested:</p>

<pre><code>num_threads = dolfin.parameters["num_threads"]
dolfin.parameters["num_threads"] = 0

# do assembly

dolfin.parameters["num_threads"] = num_threads
</code></pre>

<p>but it still give me the same error ("Unable to perform operation in parallel.") along with:</p>

<blockquote>
  <p>mpirun detected that one or more processes exited with non-zero<br>
  status, thus causing the job to be terminated.</p>
</blockquote>

<p>So I changed it a little bit as follows:</p>

<pre><code>mpi_comm = mpi_comm_world()
my_rank = MPI.rank(mpi_comm)
num_threads = dolfin::parameters["num_threads"]
dolfin.parameters["num_threads"] = 0

if my_rank == 0:    
    # do assembly

dolfin.parameters["num_threads"] = num_threads
</code></pre>

<p>This time, it didn't return any error but the thread with rank 0 takes forever to do the assembly (I had to stop it while this process is done in a reasonable time if I run the code in serial).</p>

<p>Thanks for the suggestion though! :)</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../4078/dg-solve-in-parallel?show=4174#c4174" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-07-21T14:35:15+0000"></span>Jul 21, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/V_L" class="qa-user-link url nickname">V_L</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,440</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
																<br>
																<span class="qa-c-item-what">edited</span>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="updated"><span class="value-title" title="2014-07-21T16:52:23+0000"></span>Jul 21, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span><span class="qa-c-item-who-data"><a href="../../user/V_L" class="qa-user-link url nickname">V_L</a></span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c4176">
													<div class="qa-c-item-content">
														<a name="4176"></a><div class="entry-content"><p>I'm a novice with MPI, but I think having just rank 0 hitting the assembly will cause it to hang, as it is waiting for the other ranks to also reach the assemble call so that it can try and perform it in parallel.</p>

<p>My understanding is that the num_threads is only for the current process (rank), so setting it to zero won't help with MPI, just OpenMP.  I actually get an error whenever num_threads is not zero when using MPI.  The error simply states that MPI + MP is currently not supported.</p>

<p>This brings up a nice point though - how can I within an MPI run solve a problem locally on each worker? </p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/Charles" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/22e56480a5d5f76ee11abebe5dc8d5a6?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../4078/dg-solve-in-parallel?show=4176#c4176" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-07-21T16:37:02+0000"></span>Jul 21, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Charles" class="qa-user-link url nickname">Charles</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,220</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467999-9ad985966791e0f901d63f3a94b47c242a7a5048">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
								<div class="qa-a-list-item  hentry answer" id="a4249">
									<form method="post" action="../../4078/dg-solve-in-parallel">
										<div class="qa-voting qa-voting-net" id="voting_4249">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+4<span class="votes-up"><span class="value-title" title="4"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467999-b58de5d3c4c86227781bf01c4ce39e645087a409">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../4078/dg-solve-in-parallel">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="4249"></a><div class="entry-content"><p>Parallel DG support is now in the DOLFIN development version (master branch). There are a number of DG demos that now run in parallel.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../4078/dg-solve-in-parallel?show=4249#a4249" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-07-28T08:48:18+0000"></span>Jul 28, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Garth+N.+Wells" class="qa-user-link url nickname">Garth N. Wells</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">35,930</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c4249_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467999-731819da5b61a0805a9f3780683c5f9df1680ab3">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>