<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Adding vanishing boundary terms changes solution - FEniCS Q&amp;A</title>
		<meta name="description" content="Hello, I've think I've got a general question about the FEM method. When transforming a second ... than from before. Is there an explanation for that?">
		<meta name="keywords" content="internal-facets,solution,boundary-conditions">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/13559/adding-vanishing-boundary-terms-changes-solution">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Adding vanishing boundary terms changes solution</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q13559">
								<form method="post" action="../../13559/adding-vanishing-boundary-terms-changes-solution">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_13559">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467871-66e7553fd54958e3d33919657e6b5cd434031f6a">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../13559/adding-vanishing-boundary-terms-changes-solution">
										<div class="qa-q-view-content">
											<a name="13559"></a><div class="entry-content"><p>Hello, I've think I've got a general question about the FEM method. When transforming a second order PDE into the weak form we get the on term where the source is integrated over the whole volume and by partial integration and Gauss' law another term corresponding to the Neumann boundary condition. </p>

<p>$$ [...] +  \int f dV - \int g  dS $$</p>

<p>Both f and g are zero in my problem, so I thought I didn't have to add them to the formulation.<br>
But after adding them, while setting both f and g to zero (<code>Constant('0.0')</code>) I get different results than from before. Is there an explanation for that?</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/internal-facets" rel="tag" class="qa-tag-link">internal-facets</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/solution" rel="tag" class="qa-tag-link">solution</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/boundary-conditions" rel="tag" class="qa-tag-link">boundary-conditions</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../13559/adding-vanishing-boundary-terms-changes-solution" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2017-05-19T12:12:20+0000"></span>May 19, 2017</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/thecruuk" class="qa-user-link url nickname">thecruuk</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">160</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" id="c13559_list">
											<div class="qa-c-list-item  hentry comment" id="c13561">
												<div class="qa-c-item-content">
													<a name="13561"></a><div class="entry-content"><p>Hi, I think you should post a minimal example illustrating your problem. It seems unlikely that adding the zero function could have any effect on any equation :/</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/mdbenito" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/6545a7c3ba26a36c62facacf39cb4b51?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../13559/adding-vanishing-boundary-terms-changes-solution?show=13561#c13561" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-19T12:51:48+0000"></span>May 19, 2017</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/mdbenito" class="qa-user-link url nickname">mdbenito</a></span></span>
																<span class="qa-c-item-who-title">FEniCS User</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,530</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c13570">
												<div class="qa-c-item-content">
													<a name="13570"></a><div class="entry-content"><p>Here's the code I'm using.</p>

<pre><code>from fenics import *
import os
import numpy as np

parameters["form_compiler"]["optimize"]     = True
parameters["form_compiler"]["cpp_optimize"] = True

T = 4.0
Nt = 300
dt = T/Nt
L = 8.0
Nx = 200


mesh = IntervalMesh(Nx, -L, L)
V = FunctionSpace(mesh, 'CG', 1)

u_D = Constant(0.0)

def boundary(x, on_boundary):
    return on_boundary

bc = DirichletBC(V, u_D, boundary)

gamma = 0.281
sigma = gamma/np.sqrt(8*np.log(2.0))
y0 = 2.915;

ic = Expression('1/sqrt(8*pi*pow(sigma, 2.0)) * exp(-pow(x[0]-y0, 2)) / (2*pow(sigma, 2.0)) \
+ 1/sqrt(8*pi*pow(sigma, 2.0)) * exp(-pow(x[0]+y0, 2)) / (2*pow(sigma, 2.0))',
                 y0=y0,sigma=sigma,pi=np.pi,degree=2)

v = TestFunction(V)
u0 = Function(V)
u = Function(V)
f = Constant(0.0)
g = Constant(0.0)

name = "diffusion"
q = 1.25
I = Expression(('(2.0-q)*sinh(x[0])',),q=q,degree=2)
factor = 160.0/1150.0

def operator(u, v):
    return dot(grad(pow(u,2.0-q)),grad(v))*dx 
              + u*dot(I,grad(v))*dx 
              - g*v*ds 
              + f*v*dx


F = inner(u-u0, v)*dx + dt*operator(u, v)

# normalize to one. integrate over the whole domain
u0.interpolate(ic)
S = assemble(u0*dx(mesh))
u0.vector()[:] /= S
u.assign(u0)

solver = NewtonSolver()
solver.parameters["linear_solver"] = "lu"
solver.parameters["convergence_criterion"] = "incremental"
solver.parameters["relative_tolerance"] = 1e-6

solve(F == 0, u, bc)

vtkfile = File('diffusion/diffusion.pvd')
t = 0.0
u.rename('u', 'density')


vtkfile &lt;&lt; (u, t)

while t &lt; T:
    solve(F == 0, u, bc)
    vtkfile &lt;&lt; (u, t)

    u0.assign(u)
    t += dt
</code></pre>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../13559/adding-vanishing-boundary-terms-changes-solution?show=13570#c13570" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-19T14:24:00+0000"></span>May 19, 2017</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/thecruuk" class="qa-user-link url nickname">thecruuk</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Novice</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">160</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c13571">
												<div class="qa-c-item-content">
													<a name="13571"></a><div class="entry-content"><p>Ok, great. Can you specify how the two solutions differ, i.e. how large is the difference?</p>

<p>Thanks! </p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/wilhelmbraun" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=8837047155364839364&amp;qa_size=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../13559/adding-vanishing-boundary-terms-changes-solution?show=13571#c13571" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-05-19T15:01:32+0000"></span>May 19, 2017</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/wilhelmbraun" class="qa-user-link url nickname">wilhelmbraun</a></span></span>
																<span class="qa-c-item-who-title">FEniCS User</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,070</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467871-65e70b6dd5228532972e8b8db8c92bdb10220c26">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title" style="display:none;"></h2>
							<div class="qa-a-list" id="a_list">
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>