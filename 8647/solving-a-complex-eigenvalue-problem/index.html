<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Solving a complex eigenvalue problem - FEniCS Q&amp;A</title>
		<meta name="description" content="Hello, In a previous question of mine I asked if I could write an UFL form with complex coeffcients ...  some other C++ library? Thanks for any advice">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/8647/solving-a-complex-eigenvalue-problem">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Solving a complex eigenvalue problem</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q8647">
								<form method="post" action="../../8647/solving-a-complex-eigenvalue-problem">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_8647">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468184-2074d2433943caa5a448d5d492843d12350c5a68">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../8647/solving-a-complex-eigenvalue-problem">
										<div class="qa-q-view-content">
											<a name="8647"></a><div class="entry-content"><p>Hello,</p>

<p>In a previous question of mine I asked if I could write an UFL form with complex coeffcients and the answer was negative so I decided to write two UFL forms corresponding to the real and imaginary parts of my problem. With this approach I obtain and assemble two real matrixes.<br>
Is it possible, remaining in my FEniCS/C++ code, to sum or merge them into one matrix (thus obtaining the complete complex matrix of my problem) and then call an external solver capable of dealing with complex eigenproblems, possibly with some other C++ library?</p>

<p>Thanks for any advice </p>
</div>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../8647/solving-a-complex-eigenvalue-problem" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2015-11-20T19:31:43+0000"></span>Nov 20, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/ededonati" class="qa-user-link url nickname">ededonati</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">200</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c8647_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468184-0b16b83b00930155433d45d06f6d63f2b82f564f">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a8660">
									<form method="post" action="../../8647/solving-a-complex-eigenvalue-problem">
										<div class="qa-voting qa-voting-net" id="voting_8660">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468184-2074d2433943caa5a448d5d492843d12350c5a68">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../8647/solving-a-complex-eigenvalue-problem">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="8660"></a><div class="entry-content"><p>I am not sure exactly what you are trying to achieve, but some points:</p>

<p>If you want to deal with the matrices yourself you can do so in Python using petsc4py or even numpy, and I am confident that there is some C++ equivalent (using PETSc directly?). However...</p>

<p>I am not sure if I understand the 'to sum or merge them into one matrix' part. Instead of complex eigenvalue problem you should have two real ones, one for the real part and one for the imaginary part, where there might be some coupled terms present (i.e. dependency on the imaginary solution in the evp of the real part or vice versa). The best way to deal with this (Python API, you'll have to look for the C++ equivalent)</p>

<pre><code>V = FunctionSpace(mesh, 'CG' 1)
Vcomplex = V * V
ureal, uimag = TrialFunction(Vcomplex)
vreal, vimag = TestFunction(Vcomplex)
</code></pre>

<p>Then you can write the weak form with both real and imaginary parts together, where you use <code>vreal</code> for the real terms and <code>vimag</code> for the imaginary ones. When you assemble, it will automatically result in 1 matrix.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../8647/solving-a-complex-eigenvalue-problem?show=8660#a8660" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2015-11-23T12:58:06+0000"></span>Nov 23, 2015</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/maartent" class="qa-user-link url nickname">maartent</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">3,910</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c8660_list">
												<div class="qa-c-list-item  hentry comment" id="c8661">
													<div class="qa-c-item-content">
														<a name="8661"></a><div class="entry-content"><p>Thanks for your answer, but my problem is a bit different. I apologize if I was not clear when trying to explain it.</p>

<p>I have to solve an eigenvalue problem of the form:<br>
lambda M x = A x <br>
where A is a complex matrix A = Ar + i Ai</p>

<p>What I understood so far is that the only solution to assemble the matrix with an UFL form is to write one for Ar and one for Ai (maybe even in the same UFL file). The problem is: once I have Ar and Ai in my C++ code, how can I solve the eigenvalue problem?</p>

<p>I hope my explaination is not ambiguous<br>
Thanks for any further advice</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../8647/solving-a-complex-eigenvalue-problem?show=8661#c8661" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-11-23T13:14:06+0000"></span>Nov 23, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/ededonati" class="qa-user-link url nickname">ededonati</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">200</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c8664">
													<div class="qa-c-item-content">
														<a name="8664"></a><div class="entry-content"><p>The way you want to solve your complex eigenproblem requires a solver that can handle complex numbers, and your solution will be a complex vector [a1 + i b1, a2 + i b2, ...]. It should be possible, although I have no experience on how to do it. My guess would be to use PETSc to add Ar and Ai into a new, complex matrix and then call the SLEPc eigensolver directly in your C++ code.</p>

<p>However, if you want to avoid all that and stay within the dolfin-ecosystem, you can try to get the solution in the form [a1, a2, ..., b1, b2, ...] with the method I outlined above (and perhaps reconstruct the complex numbers later if you need them).</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../8647/solving-a-complex-eigenvalue-problem?show=8664#c8664" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-11-23T14:29:34+0000"></span>Nov 23, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/maartent" class="qa-user-link url nickname">maartent</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">3,910</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c8665">
													<div class="qa-c-item-content">
														<a name="8665"></a><div class="entry-content"><p>Thanks for your advice,</p>

<p>It is no problem for me to use PETSc or SLEPc. My doubts were focused on using a solver that can handle complex numbers. From what you have written I understand that SLEPc eigensolver is capable to do it.</p>

<p>Thanks for your answer</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../8647/solving-a-complex-eigenvalue-problem?show=8665#c8665" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-11-23T15:02:31+0000"></span>Nov 23, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/ededonati" class="qa-user-link url nickname">ededonati</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">200</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c13036">
													<div class="qa-c-item-content">
														<a name="13036"></a><div class="entry-content"><p>hi, i am trying to solve a complex eigenvalue problem now. Just wondering how to use PETSc to add Ar and Ai into a new, complex matrix.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../8647/solving-a-complex-eigenvalue-problem?show=13036#c13036" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2017-04-11T07:20:00+0000"></span>Apr 11, 2017</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/kingboxing" class="qa-user-link url nickname">kingboxing</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">120</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468184-28009c9c967c9eb75efb09d7d57c3313d2fb1a7b">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>