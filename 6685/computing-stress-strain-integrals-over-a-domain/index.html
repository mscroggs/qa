<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Computing stress, strain integrals over a domain - FEniCS Q&amp;A</title>
		<meta name="description" content="Hello I have been successful at creating a linear elasticity solver in FEniCS. I compute the  ... required. Any help will be much appreciated. Thanks">
		<meta name="keywords" content="integration,elasticity,volume-average">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/6685/computing-stress-strain-integrals-over-a-domain">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Computing stress, strain integrals over a domain</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q6685">
								<form method="post" action="../../6685/computing-stress-strain-integrals-over-a-domain">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_6685">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+2<span class="votes-up"><span class="value-title" title="2"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468083-d21fccb3fa868177da596cb7059b04770bec8bca">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../6685/computing-stress-strain-integrals-over-a-domain">
										<div class="qa-q-view-content">
											<a name="6685"></a><div class="entry-content"><p>Hello</p>

<p>I have been successful at creating a linear elasticity solver in FEniCS. I compute the displacement field in a <code>Function</code> object <code>u_sol</code>.</p>

<p>I am now interested in calculating volume averaged stress and strain over the domain. In essence I need to calculate (typed in Latex notation) $\langle \sigma \rangle = \frac{1}{\Omega} \int_{\Omega}{\sigma d \Omega}$.</p>

<p>I have the stress defined as a form as follows:</p>

<pre><code>def sigma(u):
    eps = epsilon(u)
    stress = 2.0*Mu*eps + Lambda*tr(eps)*Identity(u.geometric_dimension())
    return stress

def epsilon(u):
    strain = 0.5*(nabla_grad(u) + nabla_grad(u).T)
    return strain
</code></pre>

<p>Is it okay for me to write <code>avgStress_11 = assemble(sigma(u_sol)[0,0]*dx)</code> to compute the average stress (component by component)? I tried this, but the results I obtain are numerically wrong even though the displacement field seems to be okay. </p>

<p>I can provide more details of the code as, and if, required.  </p>

<p>Any help will be much appreciated.</p>

<p>Thanks</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/integration" rel="tag" class="qa-tag-link">integration</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/elasticity" rel="tag" class="qa-tag-link">elasticity</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/volume-average" rel="tag" class="qa-tag-link">volume-average</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../6685/computing-stress-strain-integrals-over-a-domain" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2015-03-04T07:36:29+0000"></span>Mar 4, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/debmukh" class="qa-user-link url nickname">debmukh</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">880</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c6685_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468083-318700b99d11d7292c3027cb030ebf9eeee7740c">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a6689">
									<form method="post" action="../../6685/computing-stress-strain-integrals-over-a-domain">
										<div class="qa-voting qa-voting-net" id="voting_6689">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468083-d21fccb3fa868177da596cb7059b04770bec8bca">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../6685/computing-stress-strain-integrals-over-a-domain">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="6689"></a><div class="entry-content"><p>Maybe try to do a projection first, i.e.</p>

<pre><code>sigmaTensor = project(sigma(u_sol),TensorFunctionSpace(mesh,'DG',0))
</code></pre>

<p>assuming you are using CG1 for u_sol. I also think that</p>

<pre><code>sym(grad(u))
</code></pre>

<p>is equivalent to your epsilon function.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/KristianE" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/8e8c30d82e263e44bd8fe50055a60421?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../6685/computing-stress-strain-integrals-over-a-domain?show=6689#a6689" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2015-03-04T10:42:59+0000"></span>Mar 4, 2015</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/KristianE" class="qa-user-link url nickname">KristianE</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">12,900</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c6689_list">
												<div class="qa-c-list-item  hentry comment" id="c6697">
													<div class="qa-c-item-content">
														<a name="6697"></a><div class="entry-content"><p>Thanks KristianE.</p>

<p>Could you kindly also tell how to set up the integral? <br>
I tried doing the following steps, but I get an error message saying <code>Can only integrate scalar expressions. The integrand is a tensor expression with value rank 2 and free indices ()</code></p>

<pre><code>T = TensorFunctionSpace(mesh,'DG',0)
sigmaTensor = project(sigma(u_sol),T)
sigmaInt = assemble(sigmaTensor*dx)
</code></pre>

<p>Also, mathematically, what is the <code>project</code> command doing?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../6685/computing-stress-strain-integrals-over-a-domain?show=6697#c6697" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-03-04T16:30:37+0000"></span>Mar 4, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/debmukh" class="qa-user-link url nickname">debmukh</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">880</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c6698">
													<div class="qa-c-item-content">
														<a name="6698"></a><div class="entry-content"><p>The projection does Galerkin projection. If you are using CG1 for u,  you should not lose any information by projecting to DG0.</p>

<p>I think you can use brackets as well as the sub function, where<br>
sigmaTensor[0,0] is the same as sigmaTensor.sub(0),<br>
sigmaTensor[0,1] is the same as sigmaTensor.sub(1),<br>
sigmaTensor[1,0] is the same as sigmaTensor.sub(2) and<br>
sigmaTensor[1,1] is the same as sigmaTensor.sub(3).</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/KristianE" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/8e8c30d82e263e44bd8fe50055a60421?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../6685/computing-stress-strain-integrals-over-a-domain?show=6698#c6698" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-03-04T18:02:11+0000"></span>Mar 4, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/KristianE" class="qa-user-link url nickname">KristianE</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">12,900</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c6708">
													<div class="qa-c-item-content">
														<a name="6708"></a><div class="entry-content"><p>KristianE, I don't get the point of your answer. Mathematically, the stress sigma(u) should already be in DG0,  according to your assumption u \in CG1. So the projection should only change the type of sigma(u) from a ufl.something to a dolfin.Function, but not the actual value of the assembled integral, or am I missing something?</p>

<p>So, debmukh, my answer would be that your original approach should have worked and that maybe something else is wrong with your code, which we can only help you with if you post it!</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/Gregor+Mitscha-Baude" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=3856551404141824203&amp;qa_size=20" width="16" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../6685/computing-stress-strain-integrals-over-a-domain?show=6708#c6708" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-03-06T09:30:45+0000"></span>Mar 6, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Gregor+Mitscha-Baude" class="qa-user-link url nickname">Gregor Mitscha-Baude</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,280</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c6710">
													<div class="qa-c-item-content">
														<a name="6710"></a><div class="entry-content"><p>Gregor, you are absolutely right. I thought,</p>

<pre><code>from dolfin import *
mesh = RectangleMesh(0,0,1,1,3,3)
u = Function(VectorFunctionSpace(mesh,'CG',1))
assemble(sym(grad(u))[0,0]*dx)
</code></pre>

<p>would produce an error message, but it does not. That is what you get for not providing a minimal example with your question :)<br>
I do not see the point of calculating the average stress component by component though. Normally one is interested in the maximum value of the von mises stress.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/KristianE" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/8e8c30d82e263e44bd8fe50055a60421?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../6685/computing-stress-strain-integrals-over-a-domain?show=6710#c6710" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-03-06T10:35:02+0000"></span>Mar 6, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/KristianE" class="qa-user-link url nickname">KristianE</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">12,900</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468083-2bab954517b8fc402040018a7ff0dc1e6089c8ff">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>