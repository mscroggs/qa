<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>" The point is not inside the domain" when using two meshes - FEniCS Q&amp;A</title>
		<meta name="description" content="Hello I have a problem including two parts. In the first part I have created the mesh in FEniCS and for the second  ... [0] = 200.5*(10**-6) and x[1]">
		<meta name="keywords" content="function-evaluation,domain,multi-domain">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/14066/the-point-is-not-inside-the-domain-when-using-two-meshes">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">" The point is not inside the domain" when using two meshes</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q14066">
								<form method="post" action="../../14066/the-point-is-not-inside-the-domain-when-using-two-meshes">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_14066">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516466505-5d12e238b4c1c39d0f19fc4a6c7f4a29850a1cfd">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../14066/the-point-is-not-inside-the-domain-when-using-two-meshes">
										<div class="qa-q-view-content">
											<a name="14066"></a><div class="entry-content"><p>Hello<br>
I have a problem including two parts. In the first part I have created the mesh in FEniCS and for the second part I imported the mesh from the GMSH. <br>
The goal in the first part is to calculate of variable "c" and use it to find the displacement in the second part. My domain is a rectangle (in the fist part) as shown here:</p>

<p><img src="http://i.imgur.com/tDIHEjt.jpg" alt="enter image description here"><br>
This is the domain for the second part (the same domain for the first part expanded a little vertically):<br>
<img src="http://i.imgur.com/AXUJ1rf.jpg" alt="enter image description here"><br>
The red rectangle is the same domain used for the first part. My complete code for the first part is available here:<br>
<a rel="nofollow" href="https://fenicsproject.org/qa/14053/unable-to-evaluate-function-at-point-error">https://fenicsproject.org/qa/14053/unable-to-evaluate-function-at-point-error</a><br>
As you can see I have defined my mesh in FEniCS and moved it upward (only in the y-direction). Here is the geo file of the mesh imported for the second part from gmesh:</p>

<pre><code>Point(1) = {0, 0, 0, 1.0};
Point(2) = {0, 2e-6, 0, 1.0};
Point(3) = {0, 12e-6, 0, 1.0};
Point(4) = {0, 192e-6, 0, 1.0};
Point(5) = {0, 202e-6, 0, 1.0};
Point(6) = {0, 204e-6, 0, 1.0};
Point(7) = {0.03, 0, 0, 1.0};
Point(8) = {0.03, 2e-6, 0, 1.0};
Point(9) = {0.03, 12e-6, 0, 1.0};
Point(10) = {0.03, 192e-6, 0, 1.0};
Point(11) = {0.03, 202e-6, 0, 1.0};
Point(12) = {0.03, 204e-6, 0, 1.0};

Line(1) = {1, 7};
Line(2) = {7, 8};
Line(3) = {8, 2};
Line(4) = {2, 1};
Line(5) = {2, 3};
Line(6) = {3, 9};
Line(7) = {9, 8};
Line(8) = {3, 4};
Line(9) = {4, 10};
Line(10) = {10, 9};
Line(11) = {10, 11};
Line(12) = {11, 5};
Line(13) = {5, 4};
Line(14) = {5, 6};
Line(15) = {6, 12};
Line(16) = {12, 11};

Line Loop(17) = {6, -10, -9, -8};
Plane Surface(18) = {17};

Transfinite Surface{18};
Transfinite Line{10,8}=40;
Transfinite Line{9,6}=2000;

Line Loop(19) = {5, 6, 7, 3};
Plane Surface(20) = {19};


Transfinite Line{5,7}=8;
Transfinite Line{3,6}=2000;

Line Loop(21) = {4, 1, 2, 3};
Plane Surface(22) = {21};


Transfinite Line{2,4}=3;
Transfinite Line{1,3}=2000;

Line Loop(23) = {9, 11, 12, 13};
Plane Surface(24) = {23};


Transfinite Line{11,13}=8;
Transfinite Line{9,12}=2000;

Line Loop(25) = {12, 14, 15, 16};
Plane Surface(26) = {25};


Transfinite Line{14,16}=3;
Transfinite Line{12,15}=2000;
</code></pre>

<p>For the second part I have divided the domain to some subdomains:</p>

<pre><code>mesh2 = Mesh("mesh2.xml")

class domain_A(SubDomain):
  def inside(self, x, on_boundary):
      return True if x[0] &gt;= 0.0 and x[0] &lt;= 0.03 and x[1] &gt;=  0. and x[1] &lt;=2.*(10**-6) else False

class domain_B(SubDomain):
  def inside(self, x, on_boundary):
      return True if x[0] &gt;= 0.0 and x[0] &lt;= 0.03 and x[1] &gt;=  2.*(10**-6) and x[1] &lt;= 12.*(10**-6) else False

class domain_C(SubDomain):
  def inside(self, x, on_boundary):
      return True if x[0] &gt;= 0.0 and x[0] &lt;= 0.03 and x[1] &gt;=  12.*(10**-6) and x[1] &lt;= 192.*(10**-6) else False

class domain_D(SubDomain):
  def inside(self, x, on_boundary):
      return True if x[0] &gt;= 0.0 and x[0] &lt;= 0.03 and x[1] &gt;=  192.*(10**-6) and x[1] &lt;= 202.0*(10**-6) else False

class domain_E(SubDomain):
  def inside(self, x, on_boundary):
      return True if x[0] &gt;= 0.0 and x[0] &lt;= 0.03 and x[1] &gt;= 202.0*(10**-6) and x[1] &lt;= 204.*(10**-6) else False

#marking subdomains
domains = CellFunction("size_t", mesh2)
domains.set_all(4)

domain_A = domain_A()
domain_A.mark(domains, 1)
domain_B = domain_B()
domain_B.mark(domains, 2)
domain_C = domain_C()
domain_C.mark(domains, 3)
domain_D = domain_D()
domain_D.mark(domains, 4)
domain_E = domain_E()
domain_E.mark(domains, 5)

#lable domain
dx = Measure('dx', domain=mesh2, subdomain_data=domains)
</code></pre>

<p>I am using the variable "c" in my variational form only for the domains B,C and D (covering exactly the domain where this variable was calculated on, in the first part). After running the code I get the error:</p>

<pre><code>*** Reason:  The point is not inside the domain...
</code></pre>

<p>This is weird because  the subdomains B,C,D defined in the second part cover exactly the domain used for calculation of "c" in the first part. I addition the mesh imported from Gmesh seems to be correct.<br>
I have already noticed the problem is related to the boundary between subdomains D and E (upper edge of the rectangular domain of the first part). When I move this boundary down like:</p>

<pre><code> class domain_D(SubDomain):
  def inside(self, x, on_boundary):
      return True if x[0] &gt;= 0.0 and x[0] &lt;= 0.03 and x[1] &gt;=  192.*(10**-6) and x[1] &lt;= 200.5*(10**-6) else False

class domain_E(SubDomain):
  def inside(self, x, on_boundary):
      return True if x[0] &gt;= 0.0 and x[0] &lt;= 0.03 and x[1] &gt;= 200.5*(10**-6) and x[1] &lt;= 204.*(10**-6) else False
</code></pre>

<p>In this case I do not get the error anymore but this boundary should be at exactly :<br>
 202.0<em>(10<strong>-6)  **not</strong>  200.5</em>(10**-6) <br>
In the meantime, I can evaluate the variable "c" in the end of the first part of my code:</p>

<pre><code>print c(0.0,202.0 * (10**(-6)) - DOLFIN_EPS)
</code></pre>

<p>And it gives me the value of "c" without any error. I do not understand why this variable is not recognized by FEniCS at that small part of the domain in the second part while it is inside the calculation domain. I have tried almost everything like involving the DOLF_EPS in the definition of the subdomains but it was not helpful.Maybe it is related to the moving my mesh coordinate, defining the subdomains in the second part or imported mesh for the second part. Do you know what I am doing wrong here? </p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/function-evaluation" rel="tag" class="qa-tag-link">function-evaluation</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/domain" rel="tag" class="qa-tag-link">domain</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/multi-domain" rel="tag" class="qa-tag-link">multi-domain</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../14066/the-point-is-not-inside-the-domain-when-using-two-meshes" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2017-06-21T06:08:33+0000"></span>Jun 21, 2017</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/Leo" class="qa-user-link url nickname">Leo</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">840</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c14066_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516466505-98702d7c88cde4351986a57c79c5dc705a8586ea">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title" style="display:none;"></h2>
							<div class="qa-a-list" id="a_list">
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>