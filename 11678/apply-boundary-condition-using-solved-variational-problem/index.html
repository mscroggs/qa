<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>How to apply a robin boundary condition using a solved variational problem - FEniCS Q&amp;A</title>
		<meta name="description" content='Hi all, In my current code I first solve the poisson equation in a large mesh with different  ... total" solution How could I compute these &#946; values?'>
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/11678/apply-boundary-condition-using-solved-variational-problem">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">How to apply a robin boundary condition using a solved variational problem</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q11678">
								<form method="post" action="../../11678/apply-boundary-condition-using-solved-variational-problem">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_11678">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467779-abd3ab7374a3f62fca20ac418661c090b85b3ecd">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../11678/apply-boundary-condition-using-solved-variational-problem">
										<div class="qa-q-view-content">
											<a name="11678"></a><div class="entry-content"><p>Hi all,</p>

<p>In my current code I first solve the poisson equation in a large mesh with different conducting properties.<br>
Next I want to solve in a submesh which is much smaller and will be changed to contain microscopic properties.</p>

<p>I would like to be able to find robin boundary conditions that I can apply on boundaries of the submesh based on the original calculation.</p>

<p>&#946; u + &#8706;u / &#8706;n = 0  in  &#8706;&#937;</p>

<p>So I have to find a &#946; that can "simulate" the rest of the domain. If I keep the submesh unchanged it should result in the same solution by applying the same flux boundary condition as we find in the "total" solution</p>

<p>How could I compute these &#946; values?</p>
</div>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../11678/apply-boundary-condition-using-solved-variational-problem" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2016-11-18T12:42:40+0000"></span>Nov 18, 2016</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/meron" class="qa-user-link url nickname">meron</a></span></span>
													<span class="qa-q-view-who-title">FEniCS User</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">2,340</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c11678_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467779-fc0a9bd7a17dfd6092155bc895da03e37e878bde">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a11680">
									<form method="post" action="../../11678/apply-boundary-condition-using-solved-variational-problem">
										<div class="qa-voting qa-voting-net" id="voting_11680">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467779-abd3ab7374a3f62fca20ac418661c090b85b3ecd">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../11678/apply-boundary-condition-using-solved-variational-problem">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="11680"></a><div class="entry-content"><p>Yes this is possible. You can interpolate the results of your FE solution on the initial mesh to be used in the boundary computation of the mesh of the subdomain at a geometric location.</p>

<p>For example, you can interpolate the value of a function at the point (0.5, 0.5) as follows:</p>

<pre><code>expr = Expression('sin(pi*x[0])*sin(pi*x[1])', element=V.ufl_element())
u = Function(V)
u.interpolate(expr)
print u(0.5, 0.5)
</code></pre>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/nate" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=969593914916706065&amp;qa_size=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../11678/apply-boundary-condition-using-solved-variational-problem?show=11680#a11680" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-11-18T14:47:13+0000"></span>Nov 18, 2016</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/nate" class="qa-user-link url nickname">nate</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">17,050</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c11680_list">
												<div class="qa-c-list-item  hentry comment" id="c11682">
													<div class="qa-c-item-content">
														<a name="11682"></a><div class="entry-content"><p>Thank you for answering.<br>
But my problem description might not be clear enough, or I don't understand how to apply your solution to my problem. Here is some code where I describe in more detail at what point I am having difficulty.</p>

<p></p><pre><code><br>
from dolfin import *

''' Create mesh and define function space'''<br>
mesh = UnitSquareMesh(5, 5)<br>
V = FunctionSpace(mesh, 'CG', 1)

''' Define Dirichlet boundary conditions'''<br>
u0 = Expression('1 + x[0]<em>x[0] + 2</em>x[1]*x[1]', degree=2)

class DirichletBoundary(SubDomain):<br>
    def inside(self, x, on_boundary):<br>
        tol = 1E-14   # tolerance for coordinate comparisons<br>
        return on_boundary and \<br>
               (abs(x[0]) &lt; tol or abs(x[0] - 1) &lt; tol)

u0_boundary = DirichletBoundary()<br>
bc = DirichletBC(V, u0, u0_boundary)

''' Define variational problem'''<br>
u = TrialFunction(V)<br>
v = TestFunction(V)<br>
f = Constant(-6.0)<br>
g = Expression('-4<em>x[1]', degree=1)<br>
a = inner(grad(u), grad(v))</em>dx<br>
L = f<em>v</em>dx - g<em>v</em>ds

''' Compute solution'''<br>
sol = Function(V)<br>
solve(a == L, sol, bc)<br>
</code></pre>

<p>This first part is just taken from the tutorial. Next I create a submesh and want to find robin boundaries that simulate the rest of the mesh:</p>

<p></p><pre><code><br>
''' create submesh and functionspace'''<br>
class MidSquare(SubDomain):<br>
    def inside(self, x, on_boundary):<br>
        return (between(x[0], (0.4, 0.6)) and between(x[1], (0.4, 0.6)))

subdomain = CellFunction('size_t', mesh)<br>
subdomain.set_all(0)<br>
midsquare = MidSquare()

midsquare.mark(subdomain,1)<br>
submesh = SubMesh(mesh, subdomain, 1)

subV = FunctionSpace(submesh, 'CG', 1)

dx_mydomains = CellFunction('size_t', submesh)<br>
dx_mydomains.set_all(0)<br>
ds_myfacets = FacetFunction('size_t', submesh)<br>
ds_myfacets.set_all(0)

'''Define variational problem'''<br>
u = TrialFunction(subV)<br>
v = TestFunction(subV)<br>
f = Constant(-6.0)

'''<br>
Do something to figure out the correct betas here based on the first solution<br>
It should be something like n.grad(sol) = beta * u along the boundary between mesh and submesh<br>
The beta values should make sure we find the same solution in the submesh,<br>
without having to solve the whole mesh<br>
I tried something like below, but how should i apply that as a boundary condition?<br>
n=FacetNormal(mesh)<br>
dvdn=dot(nabla_grad(sol),n)<br>
beta=dvdn/sol<br>
'''

beta = Expression('x[0]', degree=1) #example beta<br>
a = inner(grad(u), grad(v))<em>dx(subdomain_data=dx_mydomains) + beta</em>u<em>v</em>ds(subdomain_data=ds_myfacets)<br>
L = f<em>v</em>dx(subdomain_data=dx_mydomains)

'''Compute solution'''<br>
subsol = Function(subV)<br>
A, b = assemble_system(a, L )<br>
solve(A, subsol.vector(), b)

</code></pre>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../11678/apply-boundary-condition-using-solved-variational-problem?show=11682#c11682" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-11-19T09:40:26+0000"></span>Nov 19, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/meron" class="qa-user-link url nickname">meron</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,340</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
																<br>
																<span class="qa-c-item-what">edited</span>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="updated"><span class="value-title" title="2016-11-21T10:25:32+0000"></span>Nov 21, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span><span class="qa-c-item-who-data"><a href="../../user/meron" class="qa-user-link url nickname">meron</a></span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467779-0d094ffb2428304f5f6fffd13555b1a86c04a469">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>