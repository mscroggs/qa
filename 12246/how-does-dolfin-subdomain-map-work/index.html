<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>How does dolfin.SubDomain.map() work? - FEniCS Q&amp;A</title>
		<meta name="description" content='The documentation on the dolfin.SubDomain.map() function states, "Map coordinate x in domain H to coordinate y ... ?" I get the same output as "map?".'>
		<meta name="keywords" content="map,subdomain,periodic-bc">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/12246/how-does-dolfin-subdomain-map-work">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">How does dolfin.SubDomain.map() work?</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q12246">
								<form method="post" action="../../12246/how-does-dolfin-subdomain-map-work">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_12246">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467814-937a0aa1495845887f98ea1d7d1a6b860e80bda4">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../12246/how-does-dolfin-subdomain-map-work">
										<div class="qa-q-view-content">
											<a name="12246"></a><div class="entry-content"><p>The documentation on the dolfin.SubDomain.map() function states, "Map coordinate x in domain H to coordinate y in domain G." An example of how to use this function is given in the following link in the PeriodicBoundary class.</p>

<p><a rel="nofollow" href="https://fenicsproject.org/olddocs/dolfin/2016.1.0/python/demo/documented/periodic/python/documentation.html">https://fenicsproject.org/olddocs/dolfin/2016.1.0/python/demo/documented/periodic/python/documentation.html</a></p>

<p>How does this function work? If I understand correctly in this example the values at x = 0 are mapped to x = 1. I would think we'd want to write the following.</p>

<pre><code>def map(self, x, y):
    y[0] = x[0] + 1.0
    y[1] = x[1]
</code></pre>

<p>Instead the example has the following.</p>

<pre><code>def map(self, x, y):
    y[0] = x[0] - 1.0
    y[1] = x[1]
</code></pre>

<p>Why is that?<br>
Also, where can I learn more about the inner workings of this function? When I run "map??" I get the same output as "map?".</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/map" rel="tag" class="qa-tag-link">map</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/subdomain" rel="tag" class="qa-tag-link">subdomain</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/periodic-bc" rel="tag" class="qa-tag-link">periodic-bc</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../12246/how-does-dolfin-subdomain-map-work" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2017-01-25T17:37:14+0000"></span>Jan 25, 2017</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/aldenpack" class="qa-user-link url nickname">aldenpack</a></span></span>
													<span class="qa-q-view-who-title">FEniCS User</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">1,450</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c12246_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467814-be76def17260ca7f13ca6aef6a7319d62c1d4712">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">2 Answers</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a12266">
									<form method="post" action="../../12246/how-does-dolfin-subdomain-map-work">
										<div class="qa-voting qa-voting-net" id="voting_12266">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467814-937a0aa1495845887f98ea1d7d1a6b860e80bda4">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../12246/how-does-dolfin-subdomain-map-work">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="12266"></a><div class="entry-content"><p>Hi, reading the source code showing how the class is used for computing <a rel="nofollow" href="https://bitbucket.org/fenics-project/dolfin/src/76daae450830e57bd91c308f4d77118e9032c1c2/dolfin/mesh/PeriodicBoundaryComputation.cpp?at=master&amp;fileviewer=file-view-default#PeriodicBoundaryComputation.cpp-72">periodic</a> domains should clarify things for you. Basically the role of  <code>map</code> is to help find p such that <code>inside(q) == True</code> where <code>q = map(p)</code>.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/MiroK" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/f566be3274ec73e3a6dda27bca11631c?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../12246/how-does-dolfin-subdomain-map-work?show=12266#a12266" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-01-27T10:51:18+0000"></span>Jan 27, 2017</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/MiroK" class="qa-user-link url nickname">MiroK</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">80,920</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c12266_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467814-74ff453dc2c7fa821327d4cad519e9f25c09748c">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
								<div class="qa-a-list-item  hentry answer" id="a12267">
									<form method="post" action="../../12246/how-does-dolfin-subdomain-map-work">
										<div class="qa-voting qa-voting-net" id="voting_12267">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467814-937a0aa1495845887f98ea1d7d1a6b860e80bda4">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../12246/how-does-dolfin-subdomain-map-work">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="12267"></a><div class="entry-content"><p>Hopefully the following two remarks will answer your question:<br>
First of all, in the 'inside' function you can use whatever variable name to name the coordinate points, so there is no problem if you feel more comfortable by defining the 'inside' function as:</p>

<pre><code>def inside(self, y, on_boundary):
    return bool(y[0] &lt; DOLFIN_EPS and y[0] &gt; -DOLFIN_EPS and on_boundary)
</code></pre>

<p>To me, this notation makes clear that 'y' indeed denotes the coordinates of the target domain.<br>
Secondly, what the map practically does, is to assign <strong>the same dof number to matching coordinates</strong>. To better appreciate this remark, consider the following working example:</p>

<pre><code>from dolfin import * 

class PeriodicBoundary(SubDomain):

    # Left boundary is "target domain" G
    def inside(self, y, on_boundary):
        return bool(y[0] &lt; DOLFIN_EPS and \
                    y[0] &gt; -DOLFIN_EPS and on_boundary)

    # Map right boundary (H) to left boundary (G)
    def map(self, x, y):
        y[0] = x[0] - 1.0
        y[1] = x[1]

mesh = UnitSquareMesh(2,2)

# This is non-periodic
#V    = FunctionSpace(mesh,'CG',1)

# This is Periodic
V    = FunctionSpace(mesh,'CG',1,constrained_domain=PeriodicBoundary())

dofmap = V.dofmap()
print 'Number of dofs', len(dofmap.dofs())

cell_to_dof     = [ [dof for dof in dofmap.cell_dofs(cell)] \
                    for cell in range(mesh.num_cells())]
cell_dof_coords = [V.element().tabulate_dof_coordinates(cell)\
                    for cell in cells(mesh) ] 

for i in range(len(cell_to_dof)):
    print 'Cell', i , 'has dof numbers', cell_to_dof[i],\
        'with dof coordinates: \n', cell_dof_coords[i]
</code></pre>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../12246/how-does-dolfin-subdomain-map-work?show=12267#a12267" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-01-27T10:53:39+0000"></span>Jan 27, 2017</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/jmmal" class="qa-user-link url nickname">jmmal</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">5,890</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c12267_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467814-790e31c393625609cf7aeb92b2fdd8970485a60f">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>