<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>ALE.move class and mesh displacement - FEniCS Q&amp;A</title>
		<meta name="description" content="Dear all, I am using the class ALE in order to move my mesh according to  ... -reference/cpp/function/ALE_move.html#dolfin.cpp.function.ALE_move">
		<meta name="keywords" content="ale,boundary-conditions">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/9076/ale-move-class-and-mesh-displacement">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">ALE.move class and mesh displacement</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q9076">
								<form method="post" action="../../9076/ale-move-class-and-mesh-displacement">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_9076">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468206-de47329d7665239600d2f6a41a46b3005fd6434b">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../9076/ale-move-class-and-mesh-displacement">
										<div class="qa-q-view-content">
											<a name="9076"></a><div class="entry-content"><p>Dear all,</p>

<p>I am using the class ALE in order to move my mesh according to new boundaries at each time step:</p>

<pre><code>ALE.move(mesh, new_boundary)
</code></pre>

<p>Now, I would like to access the resulting displacement to compute the velocity of the mesh movement, and set this velocity as DC boundary condition for the next time step of the simulation. As it says in the <a rel="nofollow" href="http://fenicsproject.org/documentation/dolfin/1.6.0/python/programmers-reference/cpp/function/ALE_move.html#dolfin.cpp.function.ALE_move">documentation</a> the resulting displacement is "encapsulated in Expression subclass MeshDisplacement". My question is how I can access this displacement and use it to compute the velocity. I tried something like this:</p>

<pre><code>V = VectorFunctionSpace(mesh, 'CG', 1)
u_mesh = Function(V)
displ = ALE.move(mesh, new_boundary)
u_mesh = displ/dt
bcu = DirichletBC(V, u_mesh, subdomain_wall, 1)
</code></pre>

<p>But it fails in the calculation of u_mesh. I would like to know how to use displ to compute u_mesh.<br>
Many thanks in advance for your help and suggestions!</p>

<p>Sebastiano</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/ale" rel="tag" class="qa-tag-link">ale</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/boundary-conditions" rel="tag" class="qa-tag-link">boundary-conditions</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../9076/ale-move-class-and-mesh-displacement" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2016-01-20T03:31:21+0000"></span>Jan 20, 2016</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/Sebastiano" class="qa-user-link url nickname">Sebastiano</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">220</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c9076_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468206-373b6a87635200225cae9ae5670481da5a639a03">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a9102">
									<form method="post" action="../../9076/ale-move-class-and-mesh-displacement">
										<div class="qa-voting qa-voting-net" id="voting_9102">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468206-de47329d7665239600d2f6a41a46b3005fd6434b">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../9076/ale-move-class-and-mesh-displacement">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="9102"></a><div class="entry-content"><p>Hi, consider</p>

<pre><code>from dolfin import *
import numpy as np

dt = 0.5
mesh = UnitSquareMesh(4, 4)
bmesh = RectangleMesh(Point(1, 1), Point(2, 2), 4, 4)
bmesh = BoundaryMesh(bmesh, 'exterior')
u = ALE.move(mesh, bmesh)

# Velocity as function
V = VectorFunctionSpace(mesh, 'CG', 1)
v = interpolate(u, V)
v.vector()[:] /= dt 
bcf = DirichletBC(V, v, 'on_boundary')

# Velocity as expression
class Velocity(Expression):
    def __init__(self, u, dt):
        self.u = u
        self.dt = dt
    def eval_cell(self, value, x, cell):
        self.u.eval_cell(value, x, cell)
        value /= dt
    def value_shape(self):
        return (2, )

v = Velocity(u, dt)
bcg = DirichletBC(V, v, 'on_boundary')

# Check
f = bcf.get_boundary_values() 
g = bcg.get_boundary_values()
assert len(set(g.keys())-set(f.keys())) == 0
assert all(near(f[key], g[key]) for key in f)
</code></pre>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-avatar">
														<a href="../../user/MiroK" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/f566be3274ec73e3a6dda27bca11631c?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
													</span>
													<span class="qa-a-item-meta">
														<a href="../../9076/ale-move-class-and-mesh-displacement?show=9102#a9102" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-01-22T10:26:38+0000"></span>Jan 22, 2016</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/MiroK" class="qa-user-link url nickname">MiroK</a></span></span>
															<span class="qa-a-item-who-title">FEniCS Expert</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">80,920</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2016-02-03T20:27:26+0000"></span>Feb 3, 2016</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/Sebastiano" class="qa-user-link url nickname">Sebastiano</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c9102_list">
												<div class="qa-c-list-item  hentry comment" id="c9188">
													<div class="qa-c-item-content">
														<a name="9188"></a><div class="entry-content"><p>Many thanks for your answer. The movement and the boundary condition work as expected now. I have just a question regarding the movement of the mesh.<br>
Using the ALE.move does intend that the mesh is also smoothed after the movement? Or I have to use:</p>

<pre><code>mesh.smooth(num_smooth)
</code></pre>

<p>after ALE.move?<br>
Many thanks.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../9076/ale-move-class-and-mesh-displacement?show=9188#c9188" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-02-02T22:46:51+0000"></span>Feb 2, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Sebastiano" class="qa-user-link url nickname">Sebastiano</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">220</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c9189">
													<div class="qa-c-item-content">
														<a name="9189"></a><div class="entry-content"><p>Hi, move according to the boundary mesh uses smoothing. See <a rel="nofollow" href="https://github.com/FEniCS/dolfin/blob/master/dolfin/ale/ALE.cpp#L36">here</a>.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/MiroK" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/f566be3274ec73e3a6dda27bca11631c?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../9076/ale-move-class-and-mesh-displacement?show=9189#c9189" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-02-03T08:12:53+0000"></span>Feb 3, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/MiroK" class="qa-user-link url nickname">MiroK</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">80,920</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468206-70ccade83ac003a069d1b654f3d7f01dfbc64764">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>