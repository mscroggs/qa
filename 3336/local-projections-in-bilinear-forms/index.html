<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>local projections in bilinear forms - FEniCS Q&amp;A</title>
		<meta name="description" content="Suppose V = FunctionSpace(mesh, 'N1curl', 1) W = VectorFunctionSpace(mesh, 'Lagrange',  ... /fenicsproject.org/pipermail/fenics/2014-March/001381.html">
		<meta name="keywords" content="projection,measure,interpolant">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/3336/local-projections-in-bilinear-forms">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">local projections in bilinear forms</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q3336">
								<form method="post" action="../../3336/local-projections-in-bilinear-forms">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_3336">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+4<span class="votes-up"><span class="value-title" title="4"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467967-9b2d9fb3b1bec9186bb804304ffdc7dca9d30d58">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../3336/local-projections-in-bilinear-forms">
										<div class="qa-q-view-content">
											<a name="3336"></a><div class="entry-content"><p>Suppose</p>

<pre><code>  V = FunctionSpace(mesh, 'N1curl', 1)
  W = VectorFunctionSpace(mesh, 'Lagrange', 2)
  v = TrialFunction(V)
  w = TestFunction(W)
</code></pre>

<p>or vice versa (v the test function, w the trial).  There are a number of circumstances where one wants to include a term like</p>

<pre><code>  v * Pi_h(w) * dx
</code></pre>

<p>in the bilinear form, where Pi_h denote the projection into the N1curl space using the tangential integrals along the edges.</p>

<p>In 2d this <em>can</em> be done in FEniCS, by introducing a new test function in the N1curl space and using the dS measure to include edge integral terms.  In this way, the MITC plate elements can be implemented, for example (details on request).</p>

<p>However in 3d we don't have a measure to integrate over the edges, which are no longer facets.  This leads to two questions:</p>

<ol>
<li>Is it possible to add terms that are integrals over  element edges<br>
in 3D?</li>
<li>Is it possible to include a projection in the bilinear form by some<br>
other means?</li>
</ol>

<p>This is crucial for some work we are doing now and we are willing to dig into the code and make modification or additions, but would need some direction on where to look and how to start.  So we would be grateful for any suggestions, pointers to other work, or ideas.</p>

<p>For related questions see <a rel="nofollow" href="http://fenicsproject.org/qa/1876/edge-interpolant">here</a> and <a rel="nofollow" href="http://fenicsproject.org/pipermail/fenics/2014-March/001381.html">here</a>.</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/projection" rel="tag" class="qa-tag-link">projection</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/measure" rel="tag" class="qa-tag-link">measure</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/interpolant" rel="tag" class="qa-tag-link">interpolant</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-avatar">
												<a href="../../user/dnarnold" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/95fa33c4f1fa2e34eb3498eaa8b0a091?s=50" width="50" height="50" class="qa-avatar-image" alt=""></a>
											</span>
											<span class="qa-q-view-meta">
												<a href="../../3336/local-projections-in-bilinear-forms" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2014-04-22T00:46:32+0000"></span>Apr 22, 2014</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/dnarnold" class="qa-user-link url nickname">dnarnold</a></span></span>
													<span class="qa-q-view-who-title">FEniCS User</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">2,360</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c3336_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467967-56948f92ce726148d3241c2140b1d851bdd54015">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a3339">
									<form method="post" action="../../3336/local-projections-in-bilinear-forms">
										<div class="qa-voting qa-voting-net" id="voting_3339">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467967-9b2d9fb3b1bec9186bb804304ffdc7dca9d30d58">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../3336/local-projections-in-bilinear-forms">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="3339"></a><div class="entry-content"><p>In answer to 1.: As you know, such terms are currently not supported. In order to proceed one would have to define a new measure and associated integral type in UFL, corresponding code generation in FFC/UFC and additions to the assembler in DOLFIN. However, the main difficulty lies with the fact that an element edge in 3D can be shared by an unknown amount of elements making matters different from the existing measures and implementation not immediate. </p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/Marie+E.+Rognes" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/3fe6d56fa31612bacc6320b6a19b0ba5?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../3336/local-projections-in-bilinear-forms?show=3339#a3339" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-04-22T10:13:32+0000"></span>Apr 22, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Marie+E.+Rognes" class="qa-user-link url nickname">Marie E. Rognes</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">5,380</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c3339_list">
												<div class="qa-c-list-item  hentry comment" id="c3376">
													<div class="qa-c-item-content">
														<a name="3376"></a><div class="entry-content"><p>An important case, even for integration over facets, is when the quantity being integrated has the same value for all the elements meeting the facet.  In that case it doesn't matter which element containing the facet is chosen.  One can be picked "at random".  This is the case needed to compute a projection, so this is probably what we will try to code.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/dnarnold" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/95fa33c4f1fa2e34eb3498eaa8b0a091?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../3336/local-projections-in-bilinear-forms?show=3376#c3376" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-04-25T17:18:32+0000"></span>Apr 25, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/dnarnold" class="qa-user-link url nickname">dnarnold</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">2,360</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c3417">
													<div class="qa-c-item-content">
														<a name="3417"></a><div class="entry-content"><p>Ok, so I would recommend the following route for starting to look at this (but with no guarantees...) </p>

<p>1) Start by using and modifying the C++ interface. </p>

<p>2) Look at the DOLFIN Assembler class: dolfin/fem/Assembler.cpp in particular the functions assemble and assemble_interior_facets (for inspiration). Search for calls for tabulate_tensor. These calls are calls to code generated by FFC for computing the element tensors. A new integral type and associated assembler function would need to be added for co-dimension 2 entities. Pay particular attention to the dimensions of the element tensors: the cell integral is related to a single cell, the interior facet integral is related to a macro cell. Get this to work first (with dummy tabulate_tensor calls for instance) for the new, say, 'assemble_edges' as a proof of concept. </p>

<p>3) The code for the tabulate_tensors needs to be generated by FFC and moreover, which code to generate needs to be specified in UFL. So, then you would need to <br>
3a) Add the relevant measure to UFL (this should be easy) <br>
3b) Add the relevant code generation in FFC (if you know what code to generate, cf point 2, this could be somewhat time consuming but not a show-stopper I think) </p>

<p>I'd be happy to provide further input if you get past point 2). And of course, there is the parallel aspect of everything but that is not my area of expertise... </p>

<p>Hope this helps.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/Marie+E.+Rognes" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/3fe6d56fa31612bacc6320b6a19b0ba5?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../3336/local-projections-in-bilinear-forms?show=3417#c3417" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-04-29T20:25:49+0000"></span>Apr 29, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Marie+E.+Rognes" class="qa-user-link url nickname">Marie E. Rognes</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">5,380</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467967-eb4e89aa627f3a84d58444f0848c7f3b03f4eef0">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>