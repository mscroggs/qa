<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>mark internal facets - FEniCS Q&amp;A</title>
		<meta name="description" content="Hi guys, I have a mesh constituted of 3d cubes. I want to mark all facets on the plane x[0]= ... Someone can tell me what's wrong on the code? Thanks.">
		<meta name="keywords" content="internal-facets,mark,internal-bc,facetfunction">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/11656/mark-internal-facets">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">mark internal facets</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q11656">
								<form method="post" action="../../11656/mark-internal-facets">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_11656">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467778-4d643b71a6f8972df3080044a892e51b4876dd35">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../11656/mark-internal-facets">
										<div class="qa-q-view-content">
											<a name="11656"></a><div class="entry-content"><p>Hi guys,</p>

<p>I have a mesh constituted of 3d cubes. I want to mark all facets on the plane x[0]=a that are located between x1min and x1max along the direction x[1] and between x2min and x2max along the direction x[2].</p>

<p>The code below,</p>

<pre><code>Facets_domain = FacetFunction('size_t', mesh)

class Bndry_(SubDomain):
    def inside(self, x, on_boundary):
        return (abs(x[0]-a) &lt; tolerance_boundary_location
                and x[1] &gt; x1min-tolerance_boundary_location
                and x[1] &lt; x1max+tolerance_boundary_location
                and x[2] &gt; x2min-tolerance_boundary_location
                and x[2] &lt; x2max+tolerance_boundary_location)
Bndry_().mark(Facets_domain,1)
</code></pre>

<p>marks correctly the facets as i want, except that only the facets at the exterior are marked. Actually, i want to mark the facets within the volume to specify later a flux as an internal boundary condition.</p>

<p>Someone can tell me what's wrong on the code?<br>
Thanks.</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/internal-facets" rel="tag" class="qa-tag-link">internal-facets</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/mark" rel="tag" class="qa-tag-link">mark</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/internal-bc" rel="tag" class="qa-tag-link">internal-bc</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/facetfunction" rel="tag" class="qa-tag-link">facetfunction</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../11656/mark-internal-facets" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2016-11-16T22:46:23+0000"></span>Nov 16, 2016</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/fussegli" class="qa-user-link url nickname">fussegli</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">700</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" id="c11656_list">
											<div class="qa-c-list-item  hentry comment" id="c11657">
												<div class="qa-c-item-content">
													<a name="11657"></a><div class="entry-content"><p>I am actually wandering how to code an internal Neumann BC on precise locations.<br>
Even if i can mark correctly the internal facets (with a value 1 in this example), i am wondering if i can modify the variational formulation as simple as:</p>

<pre><code>F=... - desired_flux_value*v*ds(1)
</code></pre>

<p>Especially since i want to impose a zero flux condition on these facets (desired_flux_value=0), then... i actually add 0 to the variational formulation. I guess that's not the correct way to do this.<br>
Does someone know how to correctly introduce internal Neumann BC on internal facets?<br>
Any help would be appreciate.</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../11656/mark-internal-facets?show=11657#c11657" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-11-16T23:13:14+0000"></span>Nov 17, 2016</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/fussegli" class="qa-user-link url nickname">fussegli</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Novice</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">700</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467778-f2969635b6104799c0fb28c712fd9dc560cf2a3d">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a11663">
									<form method="post" action="../../11656/mark-internal-facets">
										<div class="qa-voting qa-voting-net" id="voting_11663">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+2<span class="votes-up"><span class="value-title" title="2"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467778-4d643b71a6f8972df3080044a892e51b4876dd35">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../11656/mark-internal-facets">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="11663"></a><div class="entry-content"><p>Regarding the boundary condition, you have to use <code>dS</code> instead of <code>ds</code> for integrals over interior facets. Implementing the boundary condition is more involved than just adding another integral on the right hand side though. You also have to allow for discontinuity across the internal boundary, at least for the test functions. Take a look at the answer to <a rel="nofollow" href="https://fenicsproject.org/qa/10927/neumann-bc-depending-on-solution">10927</a>.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../11656/mark-internal-facets?show=11663#a11663" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-11-17T13:36:26+0000"></span>Nov 17, 2016</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Magne+Nordaas" class="qa-user-link url nickname">Magne Nordaas</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">13,820</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c11663_list">
												<div class="qa-c-list-item  hentry comment" id="c11670">
													<div class="qa-c-item-content">
														<a name="11670"></a><div class="entry-content"><p>Ok, then, here is a simplified version of my code:<br>
I impose a Dirichlet BC at the left and at the right boundary of a rectangle, and i want one Neumann BC at the middle of the domain (stationary diffusion)</p>

<pre><code>from dolfin import *

print "The current version of FEniCS is",dolfin.dolfin_version()
# The current version of FEniCS is 2016.1.0

### Check machine precision and choose as a consequence the tolerance
print 'Machine precision={value}'.format(value=DOLFIN_EPS)
tolerance_boundary_location = DOLFIN_EPS*1000;
print 'Boundary detection tolerance={value}'.format(value=tolerance_boundary_location)

### Create simple geometry
length_0=2; length_1=1; length_2=1
n_0 = 6; n_1=3; n_2=3
mesh = BoxMesh(Point(0.0, 0.0, 0.0), Point(length_0, length_1, length_2), n_0, n_1,n_2)
plot(mesh, title='Mesh of the total domain', interactive=True)

### Set finite elements
V = FunctionSpace(mesh, 'Lagrange', 1)

### Set Dirichlet boundary location at left and rigth
# Location
def LeftBndry(x):
    return ( abs(x[0]-0) &lt; tolerance_boundary_location )
def RightBndry(x):
    return ( abs(x[0]-length_0) &lt; tolerance_boundary_location )
# Values of the concentrations field on this location
c_left = 50 
c_right = 100
BC_Dirichlet_left_value = Constant(c_left)
BC_Dirichlet_right_value = Constant(c_right)
# Apply over the finite element function space, the specified concentrations values, on the specified boundary
BC_Dirichlet_left = DirichletBC(V, BC_Dirichlet_left_value, LeftBndry)
BC_Dirichlet_right = DirichletBC(V, BC_Dirichlet_right_value, RightBndry)
# Total dirichlet boundaries
bc_dirichlet_tot = [BC_Dirichlet_left, BC_Dirichlet_right]

### Set Internal Neumann Boundary condition
# Define all the facets
all_facet_domains = FacetFunction("size_t", mesh)
# Set location of the bc 
class Neumann_internal_boundary(SubDomain):
        def inside(self, x, on_boundary):
            return abs(x[0]-1) &lt; tolerance_boundary_location
# Mark the facets that satisfy the location condition           
Neumann_internal_boundary().mark(all_facet_domains, 1)
# Specify internal facets
dS_internal_neumann = dS(subdomain_data = all_facet_domains)
# Set flux value
flux_value = 1


### Write variational formulation

# Define trial function u on the finite element function space
u_trial = TrialFunction(V)
# Define test functions v on the finite element function space
v_test = TestFunction(V)

# Define function f
f = Constant(0)

# Integrands of a(u,v)
a = inner (nabla_grad(u_trial),nabla_grad(v_test))*dx

# Integrands of L(v)
L = f*v_test*dx

# Define the unknown function to be computed on the finite element function space
C = Function(V)

### Solve the PDE variational problem 
solve(a == L, C, bc_dirichlet_tot)

# Plot the solution
plot(C, title='Solution C', interactive=True)
</code></pre>

<p>Then, from this point, how can i add the internal Neumann Boundary condition ?<br>
I believe i have correctly identified the internal factes with the keyword dS.<br>
Then, i guess i have to change the variational formulation, but i don't know how to do it correctly. I have read in the Fenics book about some operator (jump) that can be used only with internal facets, but i don't understand how to use them, and even if i have to use them in my case. <br>
I am trying to understand the example you notice in your answer, if i can use it in my problem, but if you know how to write corretly the internal, it would help me a lot.<br>
Thanks.</p>

<p>PS: it seems in the example you sent me (Neumann BC depending on solution), that the jump operator is used only because he wants the flux at the internal equal to the local difference from the two domains at the interface, which is not my case : (i want to add on &#915;: a&#8711;u&#8901;n=k, and not =k[[u]], with his notation)</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../11656/mark-internal-facets?show=11670#c11670" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-11-17T18:11:32+0000"></span>Nov 17, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/fussegli" class="qa-user-link url nickname">fussegli</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">700</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
																<br>
																<span class="qa-c-item-what">edited</span>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="updated"><span class="value-title" title="2016-11-17T18:20:55+0000"></span>Nov 17, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span><span class="qa-c-item-who-data"><a href="../../user/fussegli" class="qa-user-link url nickname">fussegli</a></span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c11674">
													<div class="qa-c-item-content">
														<a name="11674"></a><div class="entry-content"><p>I have found in the forum, that this expression should be enough:</p>

<pre><code>L = f*v*dx + g("+")*v("+")*dSs(0)
</code></pre>

<p><a rel="nofollow" href="https://fenicsproject.org/qa/2744/how-to-make-interior-neumann-bc-dependent-on-fe-function">https://fenicsproject.org/qa/2744/how-to-make-interior-neumann-bc-dependent-on-fe-function</a></p>

<p><a rel="nofollow" href="https://fenicsproject.org/qa/2532/how-to-set-up-interior-neumann-boundaries">https://fenicsproject.org/qa/2532/how-to-set-up-interior-neumann-boundaries</a></p>

<p>I am trying it.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../11656/mark-internal-facets?show=11674#c11674" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-11-18T00:17:04+0000"></span>Nov 18, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/fussegli" class="qa-user-link url nickname">fussegli</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">700</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467778-be9b2e276607868113458f69cd9412557ed1d1f3">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>