<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>strange 'out of memory' problem in FEniCS - FEniCS Q&amp;A</title>
		<meta name="description" content="I develop my own FEM codes on top of FEniCS, when the total number of dofs is approximately more  ... () line 379 in src/ksp/ksp/interface/itfunc.c">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/1628/strange-out-of-memory-problem-in-fenics">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">strange 'out of memory' problem in FEniCS</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q1628">
								<form method="post" action="../../1628/strange-out-of-memory-problem-in-fenics">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_1628">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467894-5207cd9d1c4517a335a483a84d1146138a89e9bd">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../1628/strange-out-of-memory-problem-in-fenics">
										<div class="qa-q-view-content">
											<a name="1628"></a><div class="entry-content"><p>I develop my own FEM codes on top of FEniCS, when the total number of dofs is approximately more than 10,000, it crashes and shows the following 'out of memory' error. It seems like to happen at LUSolver. Although LU solver has more memory requirement, the dofs is far less than that big. I also use "top" command to monitor the MEM condition. It shows the memory used in my workstation is only less than 5%. It is strange to me that the out of memory error occurs. Anyone has ideas? Thanks.</p>

<p>My problem is nonlinear, I use dolfin's NewtonSolver("LU").</p>

<hr>

<p>UMFPACK V5.4.0 (May 20, 2009): ERROR: out of memory</p>

<p>[0]PETSC ERROR: --------------------- Error Message ------------------------------------<br>
[0]PETSC ERROR: Error in external library!<br>
[0]PETSC ERROR: umfpack_UMF_numeric failed!<br>
[0]PETSC ERROR: ------------------------------------------------------------------------<br>
[0]PETSC ERROR: Petsc Release Version 3.2.0, Patch 5, Sat Oct 29 13:45:54 CDT 2011 <br>
[0]PETSC ERROR: See docs/changes/index.html for recent updates.<br>
[0]PETSC ERROR: See docs/faq.html for hints about trouble shooting.<br>
[0]PETSC ERROR: See docs/index.html for manual pages.<br>
[0]PETSC ERROR: ----------------------------------------------------------------<br>
[0]PETSC ERROR: Unknown Name on a linux-gnu named thanasis by xzh705 Fri Nov  8 <br>
[0]PETSC ERROR: Libraries linked from /build/buildd/petsc-3.2.dfsg/linux-gnu-c-o<br>
[0]PETSC ERROR: Configure run at Tue Dec  4 18:27:39 2012<br>
[0]PETSC ERROR: Configure options --with-shared-libraries --with-debugging=0 --ulacs=1 --with-blacs-include=/usr/include --with-blacs-lib="[/usr/lib/libblacsCinude=/usr/include --with-mumps-lib="[/usr/lib/libdmumps.so,/usr/lib/libzmumps.so,/libumfpack.so,/usr/lib/libamd.so]" --with-cholmod=1 --with-cholmod-include=/usrhypre-dir=/usr --with-ptscotch=1 --with-ptscotch-include=/usr/include/scotch --w<br>
[0]PETSC ERROR: ----------------------------------------------------------------<br>
[0]PETSC ERROR: MatLUFactorNumeric_UMFPACK() line 204 in src/mat/impls/aij/seq/u<br>
[0]PETSC ERROR: MatLUFactorNumeric() line 2876 in src/mat/interface/matrix.c<br>
[0]PETSC ERROR: PCSetUp_LU() line 160 in src/ksp/pc/impls/factor/lu/lu.c<br>
[0]PETSC ERROR: PCSetUp() line 819 in src/ksp/pc/interface/precon.c<br>
[0]PETSC ERROR: KSPSetUp() line 260 in src/ksp/ksp/interface/itfunc.c<br>
[0]PETSC ERROR: KSPSolve() line 379 in src/ksp/ksp/interface/itfunc.c</p>
</div>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../1628/strange-out-of-memory-problem-in-fenics" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2013-11-09T00:16:35+0000"></span>Nov 9, 2013</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/xzhao99" class="qa-user-link url nickname">xzhao99</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">270</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c1628_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467894-570c531d751905177e01d1e0ee0789fc3935da9f">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a1629">
									<form method="post" action="../../1628/strange-out-of-memory-problem-in-fenics">
										<div class="qa-voting qa-voting-net" id="voting_1629">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+2<span class="votes-up"><span class="value-title" title="2"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467894-5207cd9d1c4517a335a483a84d1146138a89e9bd">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../1628/strange-out-of-memory-problem-in-fenics">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="1629"></a><div class="entry-content"><p>Someone correct me if I'm wrong but I think this is a UMFPACK issue (I used to observe the same error). It seems to be memory-limited. Change the direct solver to MUMPS and the problem should disappear.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../1628/strange-out-of-memory-problem-in-fenics?show=1629#a1629" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2013-11-09T08:15:34+0000"></span>Nov 9, 2013</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Theodore" class="qa-user-link url nickname">Theodore</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Novice</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">780</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c1629_list">
												<div class="qa-c-list-item  hentry comment" id="c1638">
													<div class="qa-c-item-content">
														<a name="1638"></a><div class="entry-content"><p>Thank you for your answer. Could you tell me how to change the direct solver in FEniCS/dolfin? It seems FEniCS support different 'backend' which include PETSc, STL and uBLAS. Does one of them has MUMPS solver? Thanks.</p>

<p>XZ</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../1628/strange-out-of-memory-problem-in-fenics?show=1638#c1638" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2013-11-10T14:26:31+0000"></span>Nov 10, 2013</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/xzhao99" class="qa-user-link url nickname">xzhao99</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">270</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c1642">
													<div class="qa-c-item-content">
														<a name="1642"></a><div class="entry-content"><p>PETSc can be compiled with MUMPS, SuperLU.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/Jan+Blechta" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/dc6f8dce77e4a0bd5adc7ff31ab83741?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../1628/strange-out-of-memory-problem-in-fenics?show=1642#c1642" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2013-11-11T09:23:14+0000"></span>Nov 11, 2013</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">51,420</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467894-76044b242af0a227d65fe90d035d750928cf9b9c">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>