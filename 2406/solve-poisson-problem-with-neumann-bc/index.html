<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Solve Poisson problem with Neumann BC - FEniCS Q&amp;A</title>
		<meta name="description" content="**How to solve the Poisson problem with a pure Neumann boundary condition?** The usual Poisson  ... `neumann-poisson`][3]** using direct solver.">
		<meta name="keywords" content="neumann-poisson,singular-poisson,lagrange-multiplier,preconditioner,krylov-solver">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/2406/solve-poisson-problem-with-neumann-bc">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Solve Poisson problem with Neumann BC</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q2406">
								<form method="post" action="../../2406/solve-poisson-problem-with-neumann-bc">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_2406">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+12<span class="votes-up"><span class="value-title" title="13"></span></span><span class="votes-down"><span class="value-title" title="1"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467925-9645c35b2d26e801c0a065b242da33f02a9ae6f4">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../2406/solve-poisson-problem-with-neumann-bc">
										<div class="qa-q-view-content">
											<a name="2406"></a><div class="entry-content"><p><strong>How to solve the Poisson problem with a pure Neumann boundary condition?</strong></p>

<p>The usual Poisson problem with pure Neumann BC<br>
$$ \int_\Omega \nabla u \cdot \nabla v \,\mathrm{d}x <br>
         = \int_\Omega f\,v\,\mathrm{d}x + \int_{\partial\Omega} g\,v\,\mathrm{d}s<br>
      \textrm{ for all } v\in V $$<br>
is singular when $V = H^1(\Omega)$.</p>

<p>The necessary (and also sufficient in this setting) condition for existence of a solution is<br>
$$ \int_\Omega f\,\mathrm{d}x + \int_{\partial\Omega} g\,\mathrm{d}s = 0 .$$</p>

<p><strong>Possible approaches to implementation</strong></p>

<ol>
<li><p>Supply null-space to Krylov solver (which can handle it) and orthogonalize the data to the null space to fulfill the necessary condition. Implemented in <strong><a rel="nofollow" href="http://fenicsproject.org/documentation/dolfin/1.3.0/python/demo/documented/singular-poisson/python/documentation.html">demo <code>singular-poisson</code></a></strong> using PETSc backend, GMRES (no need to use GMRES, CG is suitable here!) and no preconditioner.</p></li>
<li><p>Restrict the problem by applying <code>DirichletBC(..., method=pointwise)</code> to just one DOF and take care of the necessary condition either algebraically (for example using <code>normalize</code>) or by projection of the original data at DOLFIN <code>Function</code> level. <strong>Demo needed!</strong></p></li>
<li><p>Add a Lagrange multiplier which takes care of both the necessary condition and the singularity of the original problem. Implemented in <strong><a rel="nofollow" href="http://fenicsproject.org/documentation/dolfin/1.3.0/python/demo/documented/neumann-poisson/python/documentation.html">demo <code>neumann-poisson</code></a></strong> using direct solver.</p></li>
</ol>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/neumann-poisson" rel="tag" class="qa-tag-link">neumann-poisson</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/singular-poisson" rel="tag" class="qa-tag-link">singular-poisson</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/lagrange-multiplier" rel="tag" class="qa-tag-link">lagrange-multiplier</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/preconditioner" rel="tag" class="qa-tag-link">preconditioner</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/krylov-solver" rel="tag" class="qa-tag-link">krylov-solver</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-avatar">
												<a href="../../user/Jan+Blechta" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/dc6f8dce77e4a0bd5adc7ff31ab83741?s=50" width="50" height="50" class="qa-avatar-image" alt=""></a>
											</span>
											<span class="qa-q-view-meta">
												<a href="../../2406/solve-poisson-problem-with-neumann-bc" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2014-01-23T15:06:04+0000"></span>Jan 23, 2014</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Expert</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">51,420</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
												<br>
												<span class="qa-q-view-what">edited</span>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="updated"><span class="value-title" title="2014-02-05T09:21:45+0000"></span>Feb 5, 2014</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span><span class="qa-q-view-who-data"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" id="c2406_list">
											<div class="qa-c-list-item  hentry comment" id="c2422">
												<div class="qa-c-item-content">
													<a name="2422"></a><div class="entry-content"><p>The Problem is singular alright, but that doesn't usually mean you need to restrict the spaces. The original task would be to find one solution (out of the many that possibly exist). One possibility is to use a Krylov method on the problem, another is to extend the problem using Lagrange multipliers. The latter has some pitfalls, one being that it isn't immediately clear what is a good preconditioner for the system.</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/nschloe" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/500a1e2e864ae08f386afde2cd21add0?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2422#c2422" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T19:05:34+0000"></span>Jan 23, 2014</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/nschloe" class="qa-user-link url nickname">nschloe</a></span></span>
																<span class="qa-c-item-who-title">FEniCS User</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">7,120</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c2423">
												<div class="qa-c-item-content">
													<a name="2423"></a><div class="entry-content"><p>Please, add your method to the question as another possibility.</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/Jan+Blechta" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/dc6f8dce77e4a0bd5adc7ff31ab83741?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2423#c2423" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T19:09:20+0000"></span>Jan 23, 2014</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">51,420</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c2424">
												<div class="qa-c-item-content">
													<a name="2424"></a><div class="entry-content"><p>I already did.</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/nschloe" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/500a1e2e864ae08f386afde2cd21add0?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2424#c2424" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T19:15:30+0000"></span>Jan 23, 2014</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/nschloe" class="qa-user-link url nickname">nschloe</a></span></span>
																<span class="qa-c-item-who-title">FEniCS User</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">7,120</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c2425">
												<div class="qa-c-item-content">
													<a name="2425"></a><div class="entry-content"><p>I meant to the summary above, in the statement of the question. It is closest to approach 1. but you just claim that in works without setting null space.</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/Jan+Blechta" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/dc6f8dce77e4a0bd5adc7ff31ab83741?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2425#c2425" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T19:18:11+0000"></span>Jan 23, 2014</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">51,420</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c2430">
												<div class="qa-c-item-content">
													<a name="2430"></a><div class="entry-content"><p>Maybe we could formulate it like that:<br>
Q: How to I solve problem XYZ?<br>
A1: "supply null space"<br>
A2: "restrict the problem"<br>
A3: "Krylov ..."<br>
...<br>
(Right now, the answers are basically provided in the question.)</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/nschloe" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/500a1e2e864ae08f386afde2cd21add0?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2430#c2430" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T20:26:14+0000"></span>Jan 23, 2014</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/nschloe" class="qa-user-link url nickname">nschloe</a></span></span>
																<span class="qa-c-item-who-title">FEniCS User</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">7,120</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c2431">
												<div class="qa-c-item-content">
													<a name="2431"></a><div class="entry-content"><p>Ok, next week.</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/Jan+Blechta" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/dc6f8dce77e4a0bd5adc7ff31ab83741?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2431#c2431" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T20:55:34+0000"></span>Jan 23, 2014</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">51,420</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467925-59841e7cbcc7b1e97e89e5e8449213367c6e08ca">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">3 Answers</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a2410">
									<form method="post" action="../../2406/solve-poisson-problem-with-neumann-bc">
										<div class="qa-voting qa-voting-net" id="voting_2410">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+6<span class="votes-up"><span class="value-title" title="6"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467925-9645c35b2d26e801c0a065b242da33f02a9ae6f4">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../2406/solve-poisson-problem-with-neumann-bc">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="2410"></a><div class="entry-content"><p>Krylov solvers can deal with singular systems natively as long as the problem is well-posed, i.e., the right-hand side is indeed in the image of the linear operator. Consequently, the original problem above problem can be solved with CG (it's positive semidefinite); an extension by Lagrange multipliers is not necessary.</p>

<p>A little bit of care has to be taken when using preconditioners. AMG for example will do a optimal job if you make sure that the coarse solve doesn't mess with the nullspace. Using an iterative solver (like Jacobi) on the coarse solve will do the trick, and AMG will work as well as it does for a Dirichlet-Poisson-type problem, i.e., the number of Krylov iterations necessary to reach any given residual norm is independent of the size of the equation system.</p>

<p>The following code illustrates the behavior.</p>

<pre><code>from dolfin import *

mesh = UnitSquareMesh(20, 20)
V = FunctionSpace(mesh, 'CG', 1)

f = Expression('sin(x[0]) * sin(x[1])')

u = TrialFunction(V)
v = TestFunction(V)
a = dot(grad(u), grad(v)) * dx
L = f * v * dx

A = assemble(a)
b = assemble(L)

# Make sure the system is consistent, i.e., the right-hand side is in the image
# of A. This is equivalent to the rhs not having a component in the kernel of
# A (since A is symmetric).
e = Function(V)
e.interpolate(Constant(1.0))
evec = e.vector()
evec /= norm(evec)
alpha = b.inner(evec)
b -= alpha * evec

x = Function(V)

prec = PETScPreconditioner('hypre_amg')
PETScOptions.set('pc_hypre_boomeramg_relax_type_coarse', 'jacobi')
solver = PETScKrylovSolver('cg', prec)
solver.parameters['absolute_tolerance'] = 0.0
solver.parameters['relative_tolerance'] = 1.0e-10
solver.parameters['maximum_iterations'] = 100
solver.parameters['monitor_convergence'] = True
# Create solver and solve system
A_petsc = as_backend_type(A)
b_petsc = as_backend_type(b)
x_petsc = as_backend_type(x.vector())
solver.set_operator(A_petsc)
solver.solve(x_petsc, b_petsc)
</code></pre>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-avatar">
														<a href="../../user/nschloe" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/500a1e2e864ae08f386afde2cd21add0?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
													</span>
													<span class="qa-a-item-meta">
														<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2410#a2410" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T17:45:25+0000"></span>Jan 23, 2014</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/nschloe" class="qa-user-link url nickname">nschloe</a></span></span>
															<span class="qa-a-item-who-title">FEniCS User</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">7,120</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2014-02-05T09:29:06+0000"></span>Feb 5, 2014</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c2410_list">
												<div class="qa-c-list-item  hentry comment" id="c2411">
													<div class="qa-c-item-content">
														<a name="2411"></a><div class="entry-content"><p><strong>Errata</strong></p>

<pre><code>solver = PETScKrylovSolver('cg')
</code></pre>

<p>should be</p>

<pre><code>solver = PETScKrylovSolver('cg', prec)
</code></pre>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/Jan+Blechta" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/dc6f8dce77e4a0bd5adc7ff31ab83741?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2411#c2411" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T18:04:52+0000"></span>Jan 23, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">51,420</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c11705">
													<div class="qa-c-item-content">
														<a name="11705"></a><div class="entry-content"><p>Great solution to my problem. I would like to use it on a machine where only petsc4py is installed. What would become your code with only petsc4py library elements ? My try:</p>

<pre><code>  from petsc4py import PETSc
  comm = PETSc.COMM_WORLD
  method_PETSc = PETSc.KSP()
  method_PETSc.create(comm)
  pc_PETSc = method_PETSc.getPC()
  #PETSc.Options().setValue('pc_hypre_boomeramg_relax_type_coarse', 'jacobi')
  pc_PETSc.setType('hypre')
  pc_PETSc.setFromOptions()
  print '### Preconditionner set to: '+str(pc_PETSc.getType())
  pc_PETSc.setHYPREType('boomeramg')
</code></pre>

<p>returns:</p>

<pre><code>### Preconditionner set to: hypre
 Traceback (most recent call last):
   File "test_prec.py", line 11, in &lt;module&gt;
     pc_PETSc.setHYPREType('boomeramg')
   File "PETSc/PC.pyx", line 320, in petsc4py.PETSc.PC.setHYPREType (src/petsc4py.PETSc.c:142383)
 petsc4py.PETSc.Error: error code 56
 [0] PCHYPRESetType() line 14 in src/include/compat/hypre.h
 [0] No support for this operation for this object type
 [0] PCHYPRESetType() requires HYPRE 
</code></pre>

<p>What do I do wrong ??<br>
Thanks a lot for your support.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=11705#c11705" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-11-21T16:38:56+0000"></span>Nov 21, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/martinpauthenet" class="qa-user-link url nickname">martinpauthenet</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">220</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467925-5a3ba6131980c930f89ec7638695f41f03eb34f4">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
								<div class="qa-a-list-item  hentry answer" id="a2407">
									<form method="post" action="../../2406/solve-poisson-problem-with-neumann-bc">
										<div class="qa-voting qa-voting-net" id="voting_2407">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="1"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467925-9645c35b2d26e801c0a065b242da33f02a9ae6f4">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../2406/solve-poisson-problem-with-neumann-bc">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="2407"></a><div class="entry-content"><p>Implementation of approach 3. using </p>

<ul>
<li>modified demo <code>neumann-poisson</code> by Marie,</li>
<li>MINRES (problem is symmetric, indefinite),</li>
<li>BoomerAMG with Jacobi coarsener by Nico,</li>
<li>preconditioning operator $\int ( \nabla u \cdot \nabla v + c\,d ) \,\mathrm{d}x$ inspired by <code>stokes-iterative</code> demo by Garth.</li>
</ul>

<p>Unfortunately, PETSc's MINRES does not support <code>KSP_NORM_UNPRECONDITIONED</code> or <code>PC_RIGHT</code> so residuals/cost cannot be compared to other implementations. Comparison could be done using errornorm of some manufactured solution.</p>

<p><strong>Deprecation warning: Nico's approach should be preferred when Krylov solver is supposed to be employed. There is no need introduce Lagrange multiplier when Krylov solver can handle null space of constants. Big advantage of Nico's approach is that it keeps the problem positive definite.</strong></p>

<pre><code>from dolfin import *

# Create mesh and define function space
mesh = UnitSquareMesh(64, 64)
V = FunctionSpace(mesh, "CG", 1)
R = FunctionSpace(mesh, "R", 0)
W = V * R

# Define variational problem
(u, c) = TrialFunction(W)
(v, d) = TestFunctions(W)
f = Expression("10*exp(-(pow(x[0] - 0.5, 2) + pow(x[1] - 0.5, 2)) / 0.02)")
g = Expression("-sin(5*x[0])")
a  = (inner(grad(u), grad(v)) + c*v + u*d)*dx
ap = (inner(grad(u), grad(v)) + c*d)*dx
L  = f*v*dx + g*v*ds

# Assemble
A  = assemble(a)
Ap = assemble(ap)
b  = assemble(L)

# Create Krylov solver
#PETScOptions.set("ksp_norm_type", "unpreconditioned")
#PETScOptions.set("ksp_pc_side", "right")
prec = PETScPreconditioner('hypre_amg')
prec.parameters['hypre']['BoomerAMG']['relax_type_coarse'] = 'jacobi'
solver = PETScKrylovSolver('minres', prec)
#solver.parameters['convergence_norm_type'] = 'true'
solver.parameters['absolute_tolerance'] = 0.0
solver.parameters['relative_tolerance'] = 1e-15 
solver.parameters['maximum_iterations'] = 100
solver.parameters['monitor_convergence'] = True

# Solve system
w = Function(W)
solver.set_operators(A, Ap)
solver.solve(w.vector(), b)
(u, c) = w.split()

# Plot solution
plot(u, interactive=True)
</code></pre>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/Jan+Blechta" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/dc6f8dce77e4a0bd5adc7ff31ab83741?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2407#a2407" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T15:07:05+0000"></span>Jan 23, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">51,420</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
													<br>
													<span class="qa-a-item-what">edited</span>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2014-02-05T09:28:18+0000"></span>Feb 5, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c2407_list">
												<div class="qa-c-list-item  hentry comment" id="c2415">
													<div class="qa-c-item-content">
														<a name="2415"></a><div class="entry-content"><p>In this approach, you invert the matrix <code>Ap</code>, a 2x2 block matrix. The blocks (1,2) and (2,1) are null, and the block (1,1) is exactly your original problem which you're trying not to invert in the first place.</p>

<p>It seems that this approach is unnecessarily complicated. Just invert <code>Ap(1,1)</code>.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/nschloe" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/500a1e2e864ae08f386afde2cd21add0?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2415#c2415" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T18:32:23+0000"></span>Jan 23, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/nschloe" class="qa-user-link url nickname">nschloe</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">7,120</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c2416">
													<div class="qa-c-item-content">
														<a name="2416"></a><div class="entry-content"><p>So you suggest to switch preconditioning operator to</p>

<pre><code>ap = (inner(grad(u), grad(v)) + 0.0*d)*dx
</code></pre>

<p>do you? This does not work.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/Jan+Blechta" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/dc6f8dce77e4a0bd5adc7ff31ab83741?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2416#c2416" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T18:41:10+0000"></span>Jan 23, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">51,420</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c2418">
													<div class="qa-c-item-content">
														<a name="2418"></a><div class="entry-content"><p>That operator is even less regular, so it's not too surprising it won't work.<br>
What I suggest is to invert <code>A(1,1)</code> directly, using AMG. I do that in the alternative answer, and you do that implicitly as well, but on top of that decorate it with Lagrange.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/nschloe" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/500a1e2e864ae08f386afde2cd21add0?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2418#c2418" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T18:44:27+0000"></span>Jan 23, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/nschloe" class="qa-user-link url nickname">nschloe</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">7,120</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c2420">
													<div class="qa-c-item-content">
														<a name="2420"></a><div class="entry-content"><p>So basically, you don't suggest a better solution of the Lagrange multiplied problem, but rather tell us not to solve it.</p>

<p>BTW I don't see any good reason now why this problem is evil. It should be evil because:</p>

<ul>
<li>DOLFIN <code>SparsityPatternBuilder</code> and <code>Assembler</code> do not like it</li>
<li>Garth and Nico do not like it</li>
</ul>

<p>I would like to see an evidence.</p>

<p>There is also a possibility that the Lagrange multiplier column makes the problem numerically better than the original problem which depends on the floating-point-enforced necessary condition. Indeed, it is hard, if not impossible, to fasten a tolerance of yours solution.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/Jan+Blechta" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/dc6f8dce77e4a0bd5adc7ff31ab83741?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2420#c2420" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T18:58:30+0000"></span>Jan 23, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">51,420</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c2426">
													<div class="qa-c-item-content">
														<a name="2426"></a><div class="entry-content"><p>I'd indeed rather the problem without the Laplace multipliers. It seems that the multiplier is introduced to make the problem regular, but that isn't actually necessary; the 0-eigenvalue doesn't hurt convergence. Also, the extended problem <em>must</em> converge more slowly than the original problem since it has the exacty same spectrum except that it splits the 0-eigenvalue (which doesn't influence the convergence) into two separate eigenvalues which the Krylov iteration does need to account for. On top of that, one of them is negative, so you're losing the comfort of your (semi)definiteness and need to move to indefinite methods (MINRES).</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/nschloe" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/500a1e2e864ae08f386afde2cd21add0?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2426#c2426" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T19:20:35+0000"></span>Jan 23, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/nschloe" class="qa-user-link url nickname">nschloe</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">7,120</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c2428">
													<div class="qa-c-item-content">
														<a name="2428"></a><div class="entry-content"><p>Ok, I agree. Also some scaling for multiplier terms may be useful to scale additional eigenvalues well as Kent-Andre suggested.</p>

<p>Nevertheless, can you convince me that you can tighten a tolerance in your setting?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/Jan+Blechta" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/dc6f8dce77e4a0bd5adc7ff31ab83741?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2428#c2428" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T19:25:12+0000"></span>Jan 23, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Jan+Blechta" class="qa-user-link url nickname">Jan Blechta</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">51,420</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c2429">
													<div class="qa-c-item-content">
														<a name="2429"></a><div class="entry-content"><p>Hm, what do you by "tighten a tolerance"? You should be able to converge to any level of tolerance well above machine precision (10^{-13} or so).</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/nschloe" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/500a1e2e864ae08f386afde2cd21add0?s=20" width="20" height="20" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=2429#c2429" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2014-01-23T20:23:57+0000"></span>Jan 23, 2014</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/nschloe" class="qa-user-link url nickname">nschloe</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">7,120</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467925-6bb670c91a38b8d99c3fd3b198b838c150ea140e">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
								<div class="qa-a-list-item  hentry answer" id="a11591">
									<form method="post" action="../../2406/solve-poisson-problem-with-neumann-bc">
										<div class="qa-voting qa-voting-net" id="voting_11591">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467925-9645c35b2d26e801c0a065b242da33f02a9ae6f4">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../2406/solve-poisson-problem-with-neumann-bc">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="11591"></a><div class="entry-content"><p>Personally, I simply apply a Dirichlet BC to one node. It works very well: i performed some homogenization calculation on micro structure to get the effective diffusion of the medium, and i have good accuracy between Dirichlet-Dirichlet case, Dirichlet-Neuman case and Neuman-Neuman case.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../2406/solve-poisson-problem-with-neumann-bc?show=11591#a11591" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-11-10T22:25:45+0000"></span>Nov 10, 2016</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/fussegli" class="qa-user-link url nickname">fussegli</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Novice</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">700</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c11591_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467925-9eb9cd4386a02ba4afb54cc58f5794538a917951">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>