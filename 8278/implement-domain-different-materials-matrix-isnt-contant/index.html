<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>how to implement a domain with different materials with K is matrix (k isn't contant) ? - FEniCS Q&amp;A</title>
		<meta name="description" content="Dear all, i want to do same work with that i found in http://fenicsproject.org/documentation/tutorial/ ...  some way to solve it? Thank you very much!">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/8278/implement-domain-different-materials-matrix-isnt-contant">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">how to implement a domain with different materials with K is matrix (k isn't contant) ?</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q8278">
								<form method="post" action="../../8278/implement-domain-different-materials-matrix-isnt-contant">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_8278">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468165-a057a8a8d67d4439739ed930481bbd8ae4dfd200">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../8278/implement-domain-different-materials-matrix-isnt-contant">
										<div class="qa-q-view-content">
											<a name="8278"></a><div class="entry-content"><p>Dear all,</p>

<p>i want to do same work with that i found in <a rel="nofollow" href="http://fenicsproject.org/documentation/tutorial/materials.html">http://fenicsproject.org/documentation/tutorial/materials.html</a> but i want to change K constant with k matrix <br>
in this lien to define k, he write:</p>

<p>V0 = FunctionSpace(mesh, 'DG', 0)<br>
k  = Function(V0)<br>
k_values = [1.5, 50]  # values of k in the two subdomains<br>
for cell_no in range(len(subdomains.array())):<br>
    subdomain_no = subdomains.array()[cell_no]<br>
    k.vector()[cell_no] = k_values[subdomain_no]</p>

<p>So  if i have matrix, for exampe  </p>

<p>D1 = as_matrix([[3, 0], [0, 1]])<br>
D2 = as_matrix([[1, 0], [0, 3])</p>

<p>how I can solve the same problem?<br>
Could you please give me some way to solve it? Thank you very much!</p>
</div>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../8278/implement-domain-different-materials-matrix-isnt-contant" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2015-10-04T21:11:29+0000"></span>Oct 4, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/marwa" class="qa-user-link url nickname">marwa</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">150</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c8278_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468165-d34b86624650b4b935c87effee591954e3ea50c1">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a8281">
									<form method="post" action="../../8278/implement-domain-different-materials-matrix-isnt-contant">
										<div class="qa-voting qa-voting-net" id="voting_8281">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+2<span class="votes-up"><span class="value-title" title="2"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468165-a057a8a8d67d4439739ed930481bbd8ae4dfd200">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../8278/implement-domain-different-materials-matrix-isnt-contant">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="8281"></a><div class="entry-content"><p>The discontinuous coefficient is not handled well in that tutorial. The implementation relies on the assumption that mesh entities and dofs are enumerated in the same way, an assumption that does not hold in general.</p>

<p>A better solution is to subclass Expression. See full example below.</p>

<pre><code>from dolfin import *

class DiscontinuousCoefficient(Expression):
    def __init__(self, cell_function, coeffs):
        self.cell_function = cell_function
        self.coeffs = coeffs

    def value_shape(self):
        return (2,2)

    def eval_cell(self, values, x, cell):
        subdomain_id = self.cell_function[cell.index]
        local_coeff = self.coeffs[subdomain_id]
        local_coeff.eval_cell(values, x, cell)


mesh = UnitSquareMesh(32, 32)
V = FunctionSpace(mesh, "CG", 1)
bc = DirichletBC(V, 0., "on_boundary")

cf = CellFunction("size_t", mesh)
right = CompiledSubDomain("x[0]&gt;0.5-DOLFIN_EPS")
right.mark(cf, 1)

C_left = Constant(((1.0, 0.0,),
                   (0.0, 0.1)))

C_right = Constant(((0.1, 0.0,),
                    (0.0, 1.0)))

C = DiscontinuousCoefficient(cf, [C_left, C_right])

u, v = TrialFunction(V), TestFunction(V)
a = inner(C * grad(u), grad(v)) * dx
L = v * dx

uh = Function(V)
solve(a == L, uh, bc)
</code></pre>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../8278/implement-domain-different-materials-matrix-isnt-contant?show=8281#a8281" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2015-10-05T08:42:26+0000"></span>Oct 5, 2015</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Magne+Nordaas" class="qa-user-link url nickname">Magne Nordaas</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">13,820</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c8281_list">
												<div class="qa-c-list-item  hentry comment" id="c8284">
													<div class="qa-c-item-content">
														<a name="8284"></a><div class="entry-content"><p>Dear Magne,</p>

<p>First, thank you for your answer, but i don't unterstande what's the utility of <strong>class DiscontinuousCoefficient</strong> and where do you use </p>

<p>right = CompiledSubDomain("x[0]&gt;0.5-DOLFIN_EPS")<br>
right.mark(cf, 1)</p>

<p>in your exampe ?</p>

<p>Please, other question:<br>
if i have domain with four different materials (no juste two materials), what can i do ?<br>
Could you please give me some way to solve it? Thank you very much!</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../8278/implement-domain-different-materials-matrix-isnt-contant?show=8284#c8284" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-10-05T15:54:16+0000"></span>Oct 5, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/marwa" class="qa-user-link url nickname">marwa</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">150</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468165-4b658174d45feda113a945e68e41bd375507b3d8">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>