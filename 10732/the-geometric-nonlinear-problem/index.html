<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>The geometric nonlinear problem - FEniCS Q&amp;A</title>
		<meta name="description" content="I want to solve the Problem ![enter image description here][1] Newton  ... =&amp;dp-logid=4746912061687618373&amp;dp-callid=0&amp;size=c710_u400&amp;quality=100">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/10732/the-geometric-nonlinear-problem">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">The geometric nonlinear problem</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q10732">
								<form method="post" action="../../10732/the-geometric-nonlinear-problem">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_10732">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467075-0891c138beda4775057eb0caa4c9dd2cf9bcdb80">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../10732/the-geometric-nonlinear-problem">
										<div class="qa-q-view-content">
											<a name="10732"></a><div class="entry-content"><p>I want to solve the Problem<br>
<img src="http://thumbnail0.baidupcs.com/thumbnail/d4cd7890f71f4e0863b088c00edbe4d4?fid=2737273674-250528-1000548434027681&amp;time=1469260800&amp;rt=sh&amp;sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-jhe2eLNzQj7BuGcJXQTCI8YtUVs=&amp;expires=8h&amp;chkv=0&amp;chkbd=0&amp;chkpc=&amp;dp-logid=4746912061687618373&amp;dp-callid=0&amp;size=c710_u400&amp;quality=100" alt="enter image description here"></p>

<pre><code>Newton iteration 47: r (abs) = -nan (tol = 1.000e-10) r (rel) = -nan (tol = 1.000e-09)
  Newton iteration 48: r (abs) = -nan (tol = 1.000e-10) r (rel) = -nan (tol = 1.000e-09)
  Newton iteration 49: r (abs) = -nan (tol = 1.000e-10) r (rel) = -nan (tol = 1.000e-09)
  Newton iteration 50: r (abs) = -nan (tol = 1.000e-10) r (rel) = -nan (tol = 1.000e-09)
Traceback (most recent call last):
  File "demo_leaf.py", line 83, in &lt;module&gt;
    solve(F == 0, u_total)
  File "/usr/lib/python2.7/dist-packages/dolfin/fem/solving.py", line 300, in solve
    _solve_varproblem(*args, **kwargs)
  File "/usr/lib/python2.7/dist-packages/dolfin/fem/solving.py", line 349, in _solve_varproblem
    solver.solve()
RuntimeError: 

*** -------------------------------------------------------------------------
*** DOLFIN encountered an error. If you are not able to resolve this issue
*** using the information listed below, you can ask for help at
***
***     fenics-support@googlegroups.com
***
*** Remember to include the error message listed below and, if possible,
*** include a *minimal* running example to reproduce the error.
***
*** -------------------------------------------------------------------------
*** Error:   Unable to solve nonlinear system with NewtonSolver.
*** Reason:  Newton solver did not converge because maximum number of iterations reached.
*** Where:   This error was encountered inside NewtonSolver.cpp.
*** Process: 0
*** 
*** DOLFIN version: 2016.1.0
*** Git changeset:  unknown
*** -------------------------------------------------------------------------
</code></pre>
</div>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../10732/the-geometric-nonlinear-problem" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2016-07-23T08:00:56+0000"></span>Jul 23, 2016</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/riyexue20167" class="qa-user-link url nickname">riyexue20167</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">120</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" id="c10732_list">
											<div class="qa-c-list-item  hentry comment" id="c10735">
												<div class="qa-c-item-content">
													<a name="10735"></a><div class="entry-content"><p>Quoting the error message: "include a minimal running example to reproduce the error."</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../10732/the-geometric-nonlinear-problem?show=10735#c10735" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-07-26T05:40:53+0000"></span>Jul 26, 2016</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Christian+Waluga" class="qa-user-link url nickname">Christian Waluga</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">12,310</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467075-5eec6df93dadcbf1489e1d4513f5b58b660647dd">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a10743">
									<form method="post" action="../../10732/the-geometric-nonlinear-problem">
										<div class="qa-voting qa-voting-net" id="voting_10743">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467075-0891c138beda4775057eb0caa4c9dd2cf9bcdb80">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../10732/the-geometric-nonlinear-problem">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="10743"></a><div class="entry-content"><p>Since you have not shared your problem, consider the following suggestions to be generic in nature.</p>

<ul>
<li><p>The most common reason behind this is wrongly chosen/ physically incompatible or unsound parameters. Check if your physical parameters are realistic for the problem you are trying to solve. Write the units as comments in your code, so you are not using just any random values.</p></li>
<li><p>Check the time step. Try playing around with it. Reduce it to a level after which you are sure that it cannot be a reason for non-convergence.</p></li>
<li><p>Check your boundary conditions. The problem may not converge because of incorrect BC that do not make any sense physically.</p></li>
<li><p>Increase the nonlinear solver iteration parameter to a high value above 50</p>

<p>nonlinear_solver.parameters["maximum_iterations"]    = 500;</p></li>
<li><p>Try changing the value of your forcing function (source). It may be too much for your model parameters. I don't know how to put this in words technically but hope you get what I mean.</p></li>
</ul>

<p>One of these corrections or a combination of them should get your code working considering that you have programmed it correctly. Play around with the values a little bit. </p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/Chaitanya_Raj_Goyal" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=5557427273671820211&amp;qa_size=40" width="40" height="25" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../10732/the-geometric-nonlinear-problem?show=10743#a10743" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-07-26T18:12:45+0000"></span>Jul 26, 2016</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Chaitanya_Raj_Goyal" class="qa-user-link url nickname">Chaitanya_Raj_Goyal</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">4,150</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c10743_list">
												<div class="qa-c-list-item  hentry comment" id="c10815">
													<div class="qa-c-item-content">
														<a name="10815"></a><div class="entry-content"><pre><code>from dolfin import *
import numpy as np
import scipy as sp

# Optimization options for the form compiler
parameters["form_compiler"]["cpp_optimize"] = True
ffc_options = {"optimize": True, \
               "eliminate_zeros": True, \
               "precompute_basis_const": True, \
               "precompute_ip_const": True}

# Sub domain for Periodic boundary condition
class PeriodicBoundary(SubDomain):
    # Left boundary is "target domain" G
    def inside(self, x, on_boundary):
        return bool(x[0] &lt; DOLFIN_EPS and x[0] &gt; -DOLFIN_EPS and on_boundary)
    # Map right boundary (H) to left boundary (G)
    def map(self, x, y):
        y[0] = x[0] - 20.0
        y[1] = x[1]

# computation domain
L = 5.0
W = 1.0
h = 0.02

# growth epsilon parameters
n = 10
beta = 0.065
epsilon_g = Expression("0.065*pow(x[1]/1, 10)")

# create mesh 
mesh = RectangleMesh(Point(0.0, 0.0), Point(L, W), 20, 4, "right/left")
print("Plotting a RectangleMesh")
plot(mesh, title="Rectangle")

# define function space
P2 = VectorElement("Lagrange", mesh.ufl_cell(), 2)
P1 = FiniteElement("Lagrange", mesh.ufl_cell(), 1)
TH = P2 * P1
W = FunctionSpace(mesh, TH)

# Mark boundary subdomians
left =  CompiledSubDomain("near(x[0], side) &amp;&amp; on_boundary", side = 0.0)
right = CompiledSubDomain("near(x[0], side) &amp;&amp; on_boundary", side = 20.0)

# define functions
du_total = TrialFunction(W)
u_total = Function(W)
v = TestFunction(W) 
u, zeta = split(u_total)

# Kinematics
epsilon = sym(grad(u)) + grad(grad(zeta))/2
epsilon_gg = as_matrix([[epsilon_g, 0], [0, 0]])
epsilon_e = epsilon - epsilon_gg

# Elasticity parameters
E = 1          # the Young 's modulus
mu = 0.3        # the Poisson 's ratio

# the bending energy density
F_b = E*pow(h, 3)/12/(1 - pow(mu, 2))*(pow(tr(grad(grad(zeta))), 2) + 2*(1 - mu)*det(tr(grad(grad(zeta)))))*dx

# the stretching energy density
F_s = E*h/(1 - pow(mu, 2))*(pow(tr(epsilon_e), 2) + 2*(1 - mu)*det(epsilon_e))*dx

# total potential energy
Psi = F_s + F_b

# compute first variation of Pi
F = derivative(Psi, u_total, v)

# computer jacobian of F
# J = derivative(F, u_total, du_total)

# solver variational problem
solve(F == 0, u_total)

# save solution in VTK format
file = File("output/leaf.pvd");
file &lt;&lt; zeta

# Plot and hold solution
plot(zeta, mode = "displacement")
interactive()
</code></pre>

<p>this is my code, the problem cannot solved!</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../10732/the-geometric-nonlinear-problem?show=10815#c10815" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-08-04T08:13:16+0000"></span>Aug 4, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/riyexue20167" class="qa-user-link url nickname">riyexue20167</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">120</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467075-254d272df49d0f23d337e59968555b8b9d81c231">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>