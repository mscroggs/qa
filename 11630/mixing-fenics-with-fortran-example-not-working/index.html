<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Mixing fenics with fortran example not working - FEniCS Q&amp;A</title>
		<meta name="description" content="The example found in http://hplgit.github.io/fenics-mixed/doc/web/index.html on the coupling of  ...  version 2016.1.0. Thanks in advanced, Lucas.">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/11630/mixing-fenics-with-fortran-example-not-working">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Mixing fenics with fortran example not working</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q11630">
								<form method="post" action="../../11630/mixing-fenics-with-fortran-example-not-working">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_11630">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467776-05735d3d3c8c1dd49476bc72abc9389f7aafbe8c">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../11630/mixing-fenics-with-fortran-example-not-working">
										<div class="qa-q-view-content">
											<a name="11630"></a><div class="entry-content"><p>The example found in <a rel="nofollow" href="http://hplgit.github.io/fenics-mixed/doc/web/index.html">http://hplgit.github.io/fenics-mixed/doc/web/index.html</a> on the coupling of incompressible Navier-Stokes and Windkessel models (for a network representing a cerebral aneurysm) is not working.<br>
Computed fluxes are always zero. Even trying to compute the area of outlets returns zero.<br>
Any indications?<br>
I am using version 2016.1.0.<br>
Thanks in advanced,<br>
Lucas.</p>
</div>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../11630/mixing-fenics-with-fortran-example-not-working" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2016-11-15T13:59:05+0000"></span>Nov 15, 2016</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/Lucas+Muller" class="qa-user-link url nickname">Lucas Muller</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">140</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c11630_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467776-b5fbdc83a87150f40f416837e606a6ff1680d7df">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a14172">
									<form method="post" action="../../11630/mixing-fenics-with-fortran-example-not-working">
										<div class="qa-voting qa-voting-net" id="voting_14172">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467776-05735d3d3c8c1dd49476bc72abc9389f7aafbe8c">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../11630/mixing-fenics-with-fortran-example-not-working">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="14172"></a><div class="entry-content"><p>Hi Lucas,</p>

<p>I experienced the same issue when testing this code for my project. Every boundary integral returned zero, which shouldn't be the case. </p>

<p>I see that it has been some time since you've asked this question, but you or others might still be helped with this solution. The problem seems to be that the boundary parts are not imported from the mesh after you execute "mesh = Mesh("aneurysm.xml.gz")". <br>
You should add the following lines:</p>

<pre><code>#import mesh 
mesh = Mesh("aneurysm.xml.gz")

#obtain boundary parts of the mesh
D = mesh.topology().dim()
boundaries = MeshFunction("size_t", mesh, D - 1, mesh.domains())

ds = ds(subdomain_data = boundaries)
</code></pre>

<p>You can now test the scipt by</p>

<pre><code>#Define function space
Q = FunctionSpace(mesh, "Lagrange", 1)

#compute area of surface with identity 1 and 2
area_1 = assemble(interpolate(Constant(1), Q) * ds( 1 ))
area_2 = assemble(interpolate(Constant(1), Q) * ds( 2 ))
print(area_1)
print(area_1)
</code></pre>

<p>It should now return the area of the surface.</p>

<p>After the velocity solution is obtained, the fluxes can be calculated as follows, with u_ being the velocity solution. </p>

<pre><code>n = FacetNormal(self.mesh)
flux1 = inner(u_, n)*ds(1)
flux2 = inner(u_, n)*ds(2)

Q1 = assemble(flux1)
Q2 = assemble(flux2)
</code></pre>

<p>Hope this helps,</p>

<p>Martijn</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../11630/mixing-fenics-with-fortran-example-not-working?show=14172#a14172" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2017-06-30T14:33:55+0000"></span>Jun 30, 2017</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/MB" class="qa-user-link url nickname">MB</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Novice</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">160</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c14172_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467776-004c4ee1ffcb17ab700fbe7a3254370663a2286e">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>