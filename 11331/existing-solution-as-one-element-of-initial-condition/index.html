<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Existing Solution as One Element of Initial Condition - FEniCS Q&amp;A</title>
		<meta name="description" content="So I have a slightly awkward set of boundaries in a Cahn-Hilliard type problem which makes  ...  accomplished. Many thanks in advance for any advice">
		<meta name="keywords" content="initial-condition,mixed-function-space">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/11331/existing-solution-as-one-element-of-initial-condition">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Existing Solution as One Element of Initial Condition</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q11331">
								<form method="post" action="../../11331/existing-solution-as-one-element-of-initial-condition">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_11331">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467106-2b4c123efaa6991eb3885cadcec01cd9f9644212">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../11331/existing-solution-as-one-element-of-initial-condition">
										<div class="qa-q-view-content">
											<a name="11331"></a><div class="entry-content"><p>So I have a slightly awkward set of boundaries in a Cahn-Hilliard type problem which makes getting a good initial guess reasonably difficult. I would like to solve Laplace's equation to get an initial condition, which I have done, obtaining a function mu0.</p>

<pre><code>def macro_solver(mesh, boundaries, mu0):

    # Create mesh and build function space
    P1 = FiniteElement("Lagrange", mesh.ufl_cell(), 2)
    ME = FunctionSpace(mesh, P1*P1)

    # Class representing the initial conditions
    class InitialConditions(Expression):
        def eval(self, values, x):
            values[0] = -np.tanh(5*(x[0]-1-0.05*cos(6.28*x[1])))
            values[1] = mu0
        def value_shape(self):
            return (2,) 
</code></pre>

<p>This is essentially what I want to do, now a cursory look suggests using the FunctionAssigner class, but mu0 is on a different function space so needs projection and there is no obvious demo or useful documentation as to how this might be accomplished.</p>

<p>Many thanks in advance for any advice</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/initial-condition" rel="tag" class="qa-tag-link">initial-condition</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/mixed-function-space" rel="tag" class="qa-tag-link">mixed-function-space</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../11331/existing-solution-as-one-element-of-initial-condition" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2016-10-10T10:55:13+0000"></span>Oct 10, 2016</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/varnis" class="qa-user-link url nickname">varnis</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">390</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c11331_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467106-ae368671ed1edd48d89bb36e0f94cf995134a570">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a11381">
									<form method="post" action="../../11331/existing-solution-as-one-element-of-initial-condition">
										<div class="qa-voting qa-voting-net" id="voting_11381">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467106-2b4c123efaa6991eb3885cadcec01cd9f9644212">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../11331/existing-solution-as-one-element-of-initial-condition">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="11381"></a><div class="entry-content"><p>Let V be the finite element space of your Cahn-Hilliard type problem which, if I understood the question correctly, has two components. Let W be the auxiliary space of the laplace problem which, if I understood the question correctly, has one component. Make sure to use the same FE for both V and W.</p>

<p>Please consider defining an Expression for "-np.tanh(5<em>(x[0]-1-0.05</em>cos(6.28*x[1]))", project it to W and then assign it to the initial guess. In a similar way, assign also mu_0 to the initial guess.</p>

<p>Pseudo code:</p>

<pre><code>expression = Expression("tanh(....)", element=W.ufl_element())
initial_guess_0 = project(expression, W)
initial_guess_1 = mu_0

initial_guess = Function(V)
assign(initial_guess.sub(0), initial_guess_0)
assign(initial_guess.sub(1), initial_guess_1)
</code></pre>

<p>Best regards,<br>
Francesco</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../11331/existing-solution-as-one-element-of-initial-condition?show=11381#a11381" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-10-15T08:27:56+0000"></span>Oct 15, 2016</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/francesco.ballarin" class="qa-user-link url nickname">francesco.ballarin</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">4,070</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c11381_list">
												<div class="qa-c-list-item  hentry comment" id="c11402">
													<div class="qa-c-item-content">
														<a name="11402"></a><div class="entry-content"><p>Hi Francesco,</p>

<p>That answers half of the question (the technical half!), my understanding is that to use the NonlinearProblem approach we need to set up the class InitialConditions? This is then evaluated by the solver, but there doesn't seem to be provision for passing the guess mu to the eval method?</p>

<p>Apologies if this is an obvious question, but my understanding of python is somewhat rudimentary and this seems like a fairly standard thing to want to do?</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../11331/existing-solution-as-one-element-of-initial-condition?show=11402#c11402" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-10-17T12:30:09+0000"></span>Oct 17, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/varnis" class="qa-user-link url nickname">varnis</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Novice</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">390</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c11404">
													<div class="qa-c-item-content">
														<a name="11404"></a><div class="entry-content"><p>if F is the residual of your equation, a simple</p>

<pre><code>  solve(F==0, initial_guess, boundary_conditions)
</code></pre>

<p>should suffice. Note that at the end of the nonlinear iterations the problem solution will be stored in the initial_guess function. In a similar way for NonlinearProblem, it shoud be enough for you to provide the function where the initial guess is stored.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-meta">
																<a href="../../11331/existing-solution-as-one-element-of-initial-condition?show=11404#c11404" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-10-17T14:16:13+0000"></span>Oct 17, 2016</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/francesco.ballarin" class="qa-user-link url nickname">francesco.ballarin</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,070</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467106-cc2227302f8833e668f29c104966cf7b2742367d">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>