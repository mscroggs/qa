<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Computing integrals over moving subdomains - FEniCS Q&amp;A</title>
		<meta name="description" content="Hello all, I am trying to solve a problem where I have a circular sub-domain moving through a  ...  re-calculate the form for the integral. while time">
		<meta name="keywords" content="subdomains,dynamic">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/5623/computing-integrals-over-moving-subdomains">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Computing integrals over moving subdomains</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q5623">
								<form method="post" action="../../5623/computing-integrals-over-moving-subdomains">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_5623">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468035-b79c9ed8c790bf816feb08de6d975ca587f4cb3a">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../5623/computing-integrals-over-moving-subdomains">
										<div class="qa-q-view-content">
											<a name="5623"></a><div class="entry-content"><p>Hello all,</p>

<p>I am trying to solve a problem where I have a circular sub-domain moving through a region in space, and I am trying to calculate an integral over this sub-domain (originating from a Lagrange multiplier constraint implementation). Right now the way I am doing this is to mark the domains using <code>CellFunctions</code> at every time step, then create a measure out of it, and then re-calculate the form for the integral. </p>

<pre><code> while time &lt;= finalTime
    domains = CellFunction("size_t", mesh)
    domains.set_all(0)
    circle = Circle()
    circle = circle.mark(domains, 1)
    dx = Measure("dx")[domains]
    ... other lines of code ....
    intCircle = inner(lambda, v)*dx(1)
</code></pre>

<p>I am wondering whether it is needed for me to define the form for the integral inside the loop or defining it outside will work. Additionally, can I specify a deformation to <code>dx(1)</code>. Since I know the velocity and position, I can specify a rigid-body transformation to the domain <code>dx(1)</code> in theory - but I don't know whether that can be done in FEniCs in practice.</p>

<p>Any help whatsoever will be appreciated. </p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/subdomains" rel="tag" class="qa-tag-link">subdomains</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/dynamic" rel="tag" class="qa-tag-link">dynamic</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../5623/computing-integrals-over-moving-subdomains" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2014-09-24T18:10:57+0000"></span>Sep 24, 2014</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/debmukh" class="qa-user-link url nickname">debmukh</a></span></span>
													<span class="qa-q-view-who-title">FEniCS Novice</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">880</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
												<br>
												<span class="qa-q-view-what">edited</span>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="updated"><span class="value-title" title="2014-09-26T15:53:15+0000"></span>Sep 26, 2014</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span><span class="qa-q-view-who-data"><a href="../../user/debmukh" class="qa-user-link url nickname">debmukh</a></span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c5623_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468035-4cdc9bc13741a99d2c5e74db78f385d8901aaee0">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a5831">
									<form method="post" action="../../5623/computing-integrals-over-moving-subdomains">
										<div class="qa-voting qa-voting-net" id="voting_5831">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468035-b79c9ed8c790bf816feb08de6d975ca587f4cb3a">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../5623/computing-integrals-over-moving-subdomains">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="5831"></a><div class="entry-content"><p>I recommend defining the domains and form outside the loop:</p>

<pre><code>domains = CellFunction("size_t", mesh)
circle = Circle()
dx = Measure("dx", subdomain_data=domains)
intCircle = inner(lambda, v)*dx(1)

while time &lt;= finalTime
    domains.set_all(0)
    circle = circle.mark(domains, 1)
    ... other lines of code ....
</code></pre>

<p>To deal with the deformation, a common approach is to reformulate the PDE on the reference domain. It's also possible to modify the coordinates of the mesh, however then you need to be careful to avoid intersecting cells etc. Check out the ale demo in dolfin and mesh.move(). If you really want to do that I recommend posting a separate question with a title that draws the interest of others who do this.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/martinal" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/24eb33191219cc8eedd6b2a507802368?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../5623/computing-integrals-over-moving-subdomains?show=5831#a5831" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-10-23T13:59:33+0000"></span>Oct 23, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/martinal" class="qa-user-link url nickname">martinal</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">2,800</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c5831_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468035-60a59b760133568357473787dbc47defd6cd2cdd">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>