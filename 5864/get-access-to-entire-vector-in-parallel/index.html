<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Get access to entire vector in parallel? - FEniCS Q&amp;A</title>
		<meta name="description" content="Hi! I need to access an entire array on each process when running my program in parallel ... broadcasting between processes may be required...? Joakim">
		<meta name="keywords" content="vector,parallel">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/5864/get-access-to-entire-vector-in-parallel">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Get access to entire vector in parallel?</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q5864">
								<form method="post" action="../../5864/get-access-to-entire-vector-in-parallel">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_5864">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468046-a8fc031e3163e6dea4636477a6186b8c3c91915b">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../5864/get-access-to-entire-vector-in-parallel">
										<div class="qa-q-view-content">
											<a name="5864"></a><div class="entry-content"><p>Hi!</p>

<p>I need to access an entire array on each process when running my program in parallel, not only the local part of the array. What would be the easiest way to do this? I assume that some broadcasting between processes may be required...?</p>

<p>Joakim</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/vector" rel="tag" class="qa-tag-link">vector</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/parallel" rel="tag" class="qa-tag-link">parallel</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-meta">
												<a href="../../5864/get-access-to-entire-vector-in-parallel" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2014-10-28T15:06:33+0000"></span>Oct 28, 2014</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/joakibo" class="qa-user-link url nickname">joakibo</a></span></span>
													<span class="qa-q-view-who-title">FEniCS User</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">1,140</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" style="display:none;" id="c5864_list">
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468046-9533041c9aaa1860a15da195f7948e187d17961c">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">2 Answers</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer" id="a5870">
									<form method="post" action="../../5864/get-access-to-entire-vector-in-parallel">
										<div class="qa-voting qa-voting-net" id="voting_5870">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468046-a8fc031e3163e6dea4636477a6186b8c3c91915b">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../5864/get-access-to-entire-vector-in-parallel">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="5870"></a><div class="entry-content"><p>Hi! The class <code>Vector</code> implements the method <code>gather</code>, maybe it can help.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-meta">
													<a href="../../5864/get-access-to-entire-vector-in-parallel?show=5870#a5870" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-10-29T16:14:01+0000"></span>Oct 29, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Massimiliano+Leoni" class="qa-user-link url nickname">Massimiliano Leoni</a></span></span>
														<span class="qa-a-item-who-title">FEniCS User</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">1,760</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
													<br>
													<span class="qa-a-item-what">edited</span>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2014-10-29T16:19:43+0000"></span>Oct 29, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/Massimiliano+Leoni" class="qa-user-link url nickname">Massimiliano Leoni</a></span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c5870_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468046-5a9580a04cdde3ef4fca47fa3b6d3192a3fb649b">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
								<div class="qa-a-list-item  hentry answer" id="a5880">
									<form method="post" action="../../5864/get-access-to-entire-vector-in-parallel">
										<div class="qa-voting qa-voting-net" id="voting_5880">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468046-a8fc031e3163e6dea4636477a6186b8c3c91915b">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../5864/get-access-to-entire-vector-in-parallel">
											<div class="qa-a-selection">
											</div>
											<div class="qa-a-item-content">
												<a name="5880"></a><div class="entry-content"><p>You can use dolfin's MPI class just to do simple MPI stuff in Python. If you need more there is, e.g., the <code>mpi4py</code> module that I have used occasionally to do more advanced send, broadcast, gather, allgather (that appears to be what you want), etc. It works well with numpy arrays. Remember that communication is expensive and you should try to keep it at a minimum.  </p>

<p>The <code>Vector.gather</code> can also be used to distribute the vector across processes. The following code <code>mpitest.py</code></p>

<pre><code>from dolfin import *
from numpy import array

mesh = UnitSquareMesh(2, 2)
V = FunctionSpace(mesh, "CG", 1)
u = interpolate(Expression("x[0]"), V)

x = Vector()
u.vector().gather(x, array(range(V.dim()), "intc"))

print MPI.rank(mpi_comm_world()), x.array() 
</code></pre>

<p>executed with two cpus leads to<br>
[mikael@ubuntu ~]$ mpirun -np 2 python mpitest.py<br>
Number of global vertices: 9<br>
Number of global cells: 8<br>
1 [ 1.   0.5  0.   0.   0.   0.5  0.5  1.   1. ]<br>
0 [ 1.   0.5  0.   0.   0.   0.5  0.5  1.   1. ]</p>

<p>So the entire vector is in x on both cpus, which I think is what you requested.</p>
</div>
											</div>
											<span class="qa-a-item-avatar-meta">
												<span class="qa-a-item-avatar">
													<a href="../../user/mikael-mortensen" class="qa-avatar-link"><img src="https://www.gravatar.com/avatar/d5614112a2818f1800a461e49ac229df?s=40" width="40" height="40" class="qa-avatar-image" alt=""></a>
												</span>
												<span class="qa-a-item-meta">
													<a href="../../5864/get-access-to-entire-vector-in-parallel?show=5880#a5880" class="qa-a-item-what">answered</a>
													<span class="qa-a-item-when">
														<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2014-10-30T20:41:23+0000"></span>Oct 30, 2014</span></span>
													</span>
													<span class="qa-a-item-who">
														<span class="qa-a-item-who-pad">by </span>
														<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/mikael-mortensen" class="qa-user-link url nickname">mikael-mortensen</a></span></span>
														<span class="qa-a-item-who-title">FEniCS Expert</span>
														<span class="qa-a-item-who-points">
															<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">29,340</span><span class="qa-a-item-who-points-pad"> points)</span>
														</span>
													</span>
												</span>
											</span>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c5880_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468046-5be80fcb4ed43f2c00ca1c1d05901607b2a54a7d">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>