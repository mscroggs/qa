<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>The order of mesh coordinates in FEniCS output files viewed in Paraview - FEniCS Q&amp;A</title>
		<meta name="description" content="I have a fenics based python code. I created a bash script which generates random numbers  ... fix this? Any suggestions will be highly appreciated.">
		<meta name="keywords" content="paraview,parallel,vtk,nodes,mesh">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/11586/order-mesh-coordinates-fenics-output-files-viewed-paraview">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">The order of mesh coordinates in FEniCS output files viewed in Paraview</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q11586">
								<form method="post" action="../../11586/order-mesh-coordinates-fenics-output-files-viewed-paraview">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_11586">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516467774-eb4e3763681504f6649ce615a54ea24c1cde04ce">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../11586/order-mesh-coordinates-fenics-output-files-viewed-paraview">
										<div class="qa-q-view-content">
											<a name="11586"></a><div class="entry-content"><p>I have a fenics based python code. I created a bash script which generates random numbers with a gaussian distribution, and assigns them to my code as an input value for Youngs Modulus - 'E'. For eg. the mean of my 'E' is 100MPa, and the coefficient of variation is 40%. So if I generate 100 random numbers, my code will run for 100 different values of 'E', and store 100 different folders with vtk solutions in them. This is exactly like Monte Carlo method.  </p>

<ul>
<li>I generated 100 samples for 'E' value and that gave me 100 vtk files. </li>
<li>I converted these 100 vtk files to 100 csv (comma separated value) files.</li>
<li>I imported all of these csv files in matlab.</li>
</ul>

<p>Here is the link to some of these csv files:</p>

<p><a rel="nofollow" href="https://github.com/ChaitanyaGoyal/CSV-files">https://github.com/ChaitanyaGoyal/CSV-files</a></p>

<p>You can observe that the first 3 columns contain the solution vectors in x,y, and z direction, while the last 3 columns contain the node coordinates. Column 3 and 6 are zero because this is a 2D simulation. Hence only 'x' and 'y' exist. The total no. of rows should be equal to the no. of nodes on the mesh. So I was interested in extracting column 1 and 2 for some further processing for each of the 100 outputs. </p>

<p>Now, the matlab script that I created for processing the solution vectors in 1st and 2nd column and was based on the assumption that the 4th and 5th columns of csv file which contain the x and y coordinate will remain in same order for all these csv files. That will enable me to compare solution vectors 'x' and 'y' (column 1 and 2), for all 100 samples in my script. I thought this was obvious because its the same mesh being used every time. However, I just observed that column 4 and 5 are not the same for different csv files. Not only are the node coordinates in column '4' and '5', in different order for different csv files, but even the total no. of coordinates (i.e, the no. of rows in csv) is different for some cases. This observation has messed up everything now. I needed consistent matrices with common '4th and 5th' columns, and with same no. of rows. How was I to expect that I will get different no. of rows (i.e. nodes) for running a problem 100 times on the exact same mesh, with a different parameter value.</p>

<p>Is there a way to fix this? Any suggestions will be highly appreciated.</p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/paraview" rel="tag" class="qa-tag-link">paraview</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/parallel" rel="tag" class="qa-tag-link">parallel</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/vtk" rel="tag" class="qa-tag-link">vtk</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/nodes" rel="tag" class="qa-tag-link">nodes</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/mesh" rel="tag" class="qa-tag-link">mesh</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-avatar">
												<a href="../../user/Chaitanya_Raj_Goyal" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=5557427273671820211&amp;qa_size=50" width="50" height="31" class="qa-avatar-image" alt=""></a>
											</span>
											<span class="qa-q-view-meta">
												<a href="../../11586/order-mesh-coordinates-fenics-output-files-viewed-paraview" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2016-11-10T07:05:12+0000"></span>Nov 10, 2016</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/Chaitanya_Raj_Goyal" class="qa-user-link url nickname">Chaitanya_Raj_Goyal</a></span></span>
													<span class="qa-q-view-who-title">FEniCS User</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">4,150</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" id="c11586_list">
											<div class="qa-c-list-item  hentry comment" id="c11592">
												<div class="qa-c-item-content">
													<a name="11592"></a><div class="entry-content"><p>If you are using the python interface of dolfin you can do something like this (to avoid the step of paraview):</p>

<pre><code>from dolfin import *
import numpy as np

mesh = UnitSquareMesh(10, 10)
V = FunctionSpace(mesh, "CG", 1)
u = interpolate(Expression("x[0]*x[1]"), V)

X = V.dofmap().tabulate_all_coordinates(mesh)
X.resize((V.dim(), 2))

x = X[:,0]
y = X[:,1]
values  = u.vector().array()

np.savetxt("foo.csv", np.c_[x, y, values], delimiter=",")
</code></pre>

<p>In the cpp interface something similar can be done using proper libraries and writing a simple function as <a rel="nofollow" href="http://stackoverflow.com/questions/25201131/writing-csv-files-from-c">here</a>. </p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/hernan_mella" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=14920815903966845416&amp;qa_size=20" width="20" height="11" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../11586/order-mesh-coordinates-fenics-output-files-viewed-paraview?show=11592#c11592" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-11-11T03:31:46+0000"></span>Nov 11, 2016</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span></span>
																<span class="qa-c-item-who-title">FEniCS Expert</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">19,460</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c11607">
												<div class="qa-c-item-content">
													<a name="11607"></a><div class="entry-content"><p>Thanks a lot for your suggestion on generation of csv directly from fenics. The main problem lies in getting this to work while running in parallel. I have also sent you a detailed email regarding the same. </p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/Chaitanya_Raj_Goyal" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=5557427273671820211&amp;qa_size=20" width="20" height="12" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../11586/order-mesh-coordinates-fenics-output-files-viewed-paraview?show=11607#c11607" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2016-11-12T02:08:57+0000"></span>Nov 12, 2016</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Chaitanya_Raj_Goyal" class="qa-user-link url nickname">Chaitanya_Raj_Goyal</a></span></span>
																<span class="qa-c-item-who-title">FEniCS User</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,150</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516467774-16a3ccb08051d10beb5b44eeecace913abecf8fb">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a11606">
									<form method="post" action="../../11586/order-mesh-coordinates-fenics-output-files-viewed-paraview">
										<div class="qa-voting qa-voting-net" id="voting_11606">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516467774-eb4e3763681504f6649ce615a54ea24c1cde04ce">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../11586/order-mesh-coordinates-fenics-output-files-viewed-paraview">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="11606"></a><div class="entry-content"><p>The problem is now solved. It was an interesting learning experience. I observed that the unstructured behaviour was a result of parallel running on high resolution mesh with high no. of processors. I ran many cases for static and dynamic problems for different mesh sizes on different no. of processors, and this behaviour was observed only when mesh resolution was above average AND the minimum no. of cores was 16 or above. The extra no. of rows in the CSV can be attributed to the repetition of nodes from the boundaries of adjacent subdomains.  </p>

<p>I created a MATLAB script which first removed the extra repetitive nodes (rows), and brought the no. of rows to the actual no. of nodes on the mesh (for all csv files). Then it sorted the 'x' and 'y' coordinate values for all CSV files and aligned the rows in perfect order which could be used at a later stage to generate vtk files from MATLAB for the resultant vectors.</p>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-avatar">
														<a href="../../user/Chaitanya_Raj_Goyal" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=5557427273671820211&amp;qa_size=40" width="40" height="25" class="qa-avatar-image" alt=""></a>
													</span>
													<span class="qa-a-item-meta">
														<a href="../../11586/order-mesh-coordinates-fenics-output-files-viewed-paraview?show=11606#a11606" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2016-11-12T02:07:36+0000"></span>Nov 12, 2016</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/Chaitanya_Raj_Goyal" class="qa-user-link url nickname">Chaitanya_Raj_Goyal</a></span></span>
															<span class="qa-a-item-who-title">FEniCS User</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">4,150</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" style="display:none;" id="c11606_list">
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516467774-5bc8b4cca8fed53923fdee3aebacfb371c95d354">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>