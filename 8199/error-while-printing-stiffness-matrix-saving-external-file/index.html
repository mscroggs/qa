<html><!-- Powered by Question2Answer - http://www.question2answer.org/ --><head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Error while printing stiffness matrix and saving it to an external file - FEniCS Q&amp;A</title>
		<meta name="description" content='Hi, This is a trivial question but any help is highly appreciated. I want to view my stiffness  ...  and when I use command File("stiffness.pvd")'>
		<meta name="keywords" content="matrix,python,numpy">
		<link rel="stylesheet" type="text/css" href="../../qa-theme/Snow/qa-styles.css">
		<link rel="canonical" href="http://fenicsproject.org/qa/8199/error-while-printing-stiffness-matrix-saving-external-file">
		<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]},
    TeX: { extensions: ["AMSmath.js","AMSsymbols.js"]}
  });
</script>
<script type="text/javascript" src="../../mathjax/MathJax.js"></script>
		<script src="../../jquery-1.7.2.min.js" type="text/javascript"></script>
		<script src="../../highlight.min.js"></script>
<script type="text/javascript">
$(function(){
	$('.wmd-input').keypress(function(){
		window.clearTimeout(hljs.Timeout);
		hljs.Timeout = window.setTimeout(function() {
			hljs.initHighlighting.called = false;
			hljs.initHighlighting();
		}, 500);
	});
	window.setTimeout(function() {
		hljs.initHighlighting.called = false;
		hljs.initHighlighting();
	}, 500);
});
</script>


	</head>
	<body class="qa-template-question qa-body-js-off">
		<div class="qa-body-wrapper">
			
			<div class="qa-header">
				<div class="qa-logo">
					<a href="../../" class="qa-logo-link" title="FEniCS Q&amp;A"><img src="../../qa-theme/fenics_qa.png" border="0" alt="FEniCS Q&amp;A"></a>
				</div>
				<div class="qa-header-clear">
				</div>
			</div> <!-- END qa-header -->
			
			<div class="qa-main-shadow">
				
				<div class="qa-main-wrapper">
					
					<div class="qa-sidepanel">
						<div class="qa-sidebar">
							This is a read only copy of the old FEniCS QA forum. Please visit the <a href="https://www.allanswered.com/community/s/fenics-project/">new QA forum</a> to ask questions
						</div>
						
					</div>
					
					<div class="qa-main">
						<h1>
							<span class="entry-title">Error while printing stiffness matrix and saving it to an external file</span>
						</h1>
						<div class="qa-part-q-view">
							<div class="qa-q-view  hentry question" id="q8199">
								<form method="post" action="../../8199/error-while-printing-stiffness-matrix-saving-external-file">
									<div class="qa-q-view-stats">
										<div class="qa-voting qa-voting-net" id="voting_8199">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">0<span class="votes-up"><span class="value-title" title="0"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> votes</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
									</div>
									<input type="hidden" name="code" value="0-1516468162-8c90053a82fb1d852a983d5853837c7bb51cc53e">
								</form>
								<div class="qa-q-view-main">
									<form method="post" action="../../8199/error-while-printing-stiffness-matrix-saving-external-file">
										<div class="qa-q-view-content">
											<a name="8199"></a><div class="entry-content"><p>Hi, This is a trivial question but any help is highly appreciated. I want to view my stiffness matrix and save it to an external file? Is it possible? </p>

<pre><code>import numpy as np

a = inner(sigma, grad(v))*dx 
L = -(dot(r, v)*dx + dot(f,v)*ds(1))

A,b = assemble_system(a,L,bc)

# View entire array ( not truncated form) 
np.set_printoptions(threshold='nan')
# print entire stiffness matrix and it's largest entries
print A.array(), np.sort(A.array()[abs(A.array())&gt;1e2])     
Y = A.array()
</code></pre>

<p>The above is not giving me any output and when I use command File("stiffness.pvd") &lt;&lt; Y, that doesn't work either. </p>
</div>
										</div>
										<div class="qa-q-view-tags">
											<ul class="qa-q-view-tag-list">
												<li class="qa-q-view-tag-item"><a href="../../tag/matrix" rel="tag" class="qa-tag-link">matrix</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/python" rel="tag" class="qa-tag-link">python</a></li>
												<li class="qa-q-view-tag-item"><a href="../../tag/numpy" rel="tag" class="qa-tag-link">numpy</a></li>
											</ul>
										</div>
										<span class="qa-q-view-avatar-meta">
											<span class="qa-q-view-avatar">
												<a href="../../user/Chaitanya_Raj_Goyal" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=5557427273671820211&amp;qa_size=50" width="50" height="31" class="qa-avatar-image" alt=""></a>
											</span>
											<span class="qa-q-view-meta">
												<a href="../../8199/error-while-printing-stiffness-matrix-saving-external-file" class="qa-q-view-what">asked</a>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="published"><span class="value-title" title="2015-09-24T15:36:48+0000"></span>Sep 24, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span>
													<span class="qa-q-view-who-data"><span class="vcard author"><a href="../../user/Chaitanya_Raj_Goyal" class="qa-user-link url nickname">Chaitanya_Raj_Goyal</a></span></span>
													<span class="qa-q-view-who-title">FEniCS User</span>
													<span class="qa-q-view-who-points">
														<span class="qa-q-view-who-points-pad">(</span><span class="qa-q-view-who-points-data">4,150</span><span class="qa-q-view-who-points-pad"> points)</span>
													</span>
												</span>
												<br>
												<span class="qa-q-view-what">edited</span>
												<span class="qa-q-view-when">
													<span class="qa-q-view-when-data"><span class="updated"><span class="value-title" title="2015-09-25T19:52:54+0000"></span>Sep 25, 2015</span></span>
												</span>
												<span class="qa-q-view-who">
													<span class="qa-q-view-who-pad">by </span><span class="qa-q-view-who-data"><a href="../../user/Chaitanya_Raj_Goyal" class="qa-user-link url nickname">Chaitanya_Raj_Goyal</a></span>
												</span>
											</span>
										</span>
										<div class="qa-q-view-buttons">
										</div>
										
										<div class="qa-q-view-c-list" id="c8199_list">
											<div class="qa-c-list-item  hentry comment" id="c8203">
												<div class="qa-c-item-content">
													<a name="8203"></a><div class="entry-content"><p>It will be easier for someone to help you if you post the full code (as long as you manage to write a short complete code). You are missing definitions of at least mesh, function space, test and trial functions above, so it is not easy for others to understand what the real problem is.</p>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-meta">
															<a href="../../8199/error-while-printing-stiffness-matrix-saving-external-file?show=8203#c8203" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-09-25T09:25:31+0000"></span>Sep 25, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Tormod+Landet" class="qa-user-link url nickname">Tormod Landet</a></span></span>
																<span class="qa-c-item-who-title">FEniCS User</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">5,130</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
											<div class="qa-c-list-item  hentry comment" id="c8212">
												<div class="qa-c-item-content">
													<a name="8212"></a><div class="entry-content"><p>Ok this is the code. It just keeps running, never gives an output.  Thanks for your time and help. Highly appreciate it.</p>

<pre><code>from dolfin import *
import numpy as np

# Load mesh and define function space
d0 = 8.
d1 = 1.
d2 = 1.
n0 = int(d0*6)
n1 = int(d1*6)
n2 = int(d2*6)
o = Point(0, 0, 0)
l = Point(8, 1, 1)

# Mesh for cantilever beam
Mesh = BoxMesh(o, l, n0, n1, n2)

Mesh.init()

#Note that for efficiency, only entities of dimension zero (vertices) and entities of the maximal dimension (cells) exist when creating a Mesh. Other entities must be explicitly created by calling init(). For example, all edges in a mesh may be created by a call to mesh.init(1). 

V  = VectorFunctionSpace(Mesh, "CG", 1)

tol = 1E-14 # tolerance http://www.stata.com/manuals14/m-1tolerance.pdf

# Left boundary 
class Left(SubDomain):
    def inside(self, x, on_boundary):
        return near(x[0], 0.0)

# Right boundary
class Right(SubDomain):
    def inside(self, x, on_boundary):
        return near(x[0], 8.0)      

# Top face at which load is added
class Top(SubDomain):
    def inside(self, x, on_boundary):
        return near(x[2], 1.0)

#Boundary segments
left = Left()
top = Top()
right = Right()

# Initialize mesh function for boundary domains
boundaries = FacetFunction("uint", Mesh)
boundaries.set_all(0)
left.mark(boundaries, 1)
top.mark(boundaries, 2)      

# Define variational problem
u = TrialFunction(V)
v = TestFunction(V)
f = Constant((0.0, -1.9, 0.0))

# Elasticity parameters
E = 200*(10**9)
nu = 0.24

mu, lmbda = Constant(E/(2*(1 + nu))), Constant(E*nu/((1 + nu)*(1 - 2*nu)))

# Strain
def eps(v):
    return sym(grad(v))

# Stress
def sigma(v):
    return 2.0*mu*sym(grad(v)) + lmbda*tr(sym(grad(v)))*Identity(v.cell().d) 

# Define new measures associated with the interior domains and exterior boundaries
ds = Measure("ds")[boundaries]

# Define variational problem
g_T= Constant((0.0, -8500000.0, 0.0))

a = inner(grad(v),sigma(u))*dx 

L= dot(v,g_T)*ds(2)+dot(v,g_T)*dx

# Boundary condition
left_end_displacement = Constant((0.0, 0.0, 0.0))

bc = [DirichletBC(V, left_end_displacement, left)] 

# Compute solution
u = Function(V)
A,b = assemble_system(a,L,bc)
u = Function(V)
U = u.vector()
solve(A,U,b)

np.set_printoptions(threshold='nan')
# print entire stiffness matrix and it's largest entries
print A.array(), np.sort(A.array()[abs(A.array())&gt;1e2])     
Y = A.array()
File("stiffnessmatrix.pvd", "compressed") &lt;&lt; Y

# Save solution to VTK format
File("Output_elas3D_PointLoad.pvd", "compressed") &lt;&lt; u
plot(u, mode="displacement",interactive=True)
</code></pre>
</div>
												</div>
												<div class="qa-c-item-footer">
													<span class="qa-c-item-avatar-meta">
														<span class="qa-c-item-avatar">
															<a href="../../user/Chaitanya_Raj_Goyal" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=5557427273671820211&amp;qa_size=20" width="20" height="12" class="qa-avatar-image" alt=""></a>
														</span>
														<span class="qa-c-item-meta">
															<a href="../../8199/error-while-printing-stiffness-matrix-saving-external-file?show=8212#c8212" class="qa-c-item-what">commented</a>
															<span class="qa-c-item-when">
																<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-09-25T16:11:19+0000"></span>Sep 25, 2015</span></span>
															</span>
															<span class="qa-c-item-who">
																<span class="qa-c-item-who-pad">by </span>
																<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Chaitanya_Raj_Goyal" class="qa-user-link url nickname">Chaitanya_Raj_Goyal</a></span></span>
																<span class="qa-c-item-who-title">FEniCS User</span>
																<span class="qa-c-item-who-points">
																	<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,150</span><span class="qa-c-item-who-points-pad"> points)</span>
																</span>
															</span>
														</span>
													</span>
													<div class="qa-c-item-buttons">
													</div>
												</div>
												<div class="qa-c-item-clear">
												</div>
											</div> <!-- END qa-c-item -->
										</div> <!-- END qa-c-list -->
										
										<input type="hidden" name="code" value="0-1516468162-fd2c3de5219cbcb0eca6adb3c19c5595acf06ebf">
										<input type="hidden" name="qa_click" value="">
									</form>
									<div class="qa-c-form">
									</div> <!-- END qa-c-form -->
									
								</div> <!-- END qa-q-view-main -->
								<div class="qa-q-view-clear">
								</div>
							</div> <!-- END qa-q-view -->
							
						</div>
						<div class="qa-part-a-list">
							<h2 id="a_list_title">1 Answer</h2>
							<div class="qa-a-list" id="a_list">
								
								<div class="qa-a-list-item  hentry answer answer-selected qa-a-list-item-selected" id="a8217">
									<form method="post" action="../../8199/error-while-printing-stiffness-matrix-saving-external-file">
										<div class="qa-voting qa-voting-net" id="voting_8217">
											<div class="qa-vote-count qa-vote-count-net">
												<span class="qa-netvote-count">
													<span class="qa-netvote-count-data">+1<span class="votes-up"><span class="value-title" title="1"></span></span><span class="votes-down"><span class="value-title" title="0"></span></span></span><span class="qa-netvote-count-pad"> vote</span>
												</span>
											</div>
											<div class="qa-vote-clear">
											</div>
										</div>
										<input type="hidden" name="code" value="0-1516468162-8c90053a82fb1d852a983d5853837c7bb51cc53e">
									</form>
									<div class="qa-a-item-main">
										<form method="post" action="../../8199/error-while-printing-stiffness-matrix-saving-external-file">
											<div class="qa-a-item-selected">
												<div class="qa-a-selection">
													<div class="qa-a-selected">&#160;</div>
													<div class="qa-a-selected-text">Best answer</div>
												</div>
												<div class="qa-a-item-content">
													<a name="8217"></a><div class="entry-content"><p>Maybe you should to do this to export:</p>

<pre><code>np.savetxt("stiffnessmatrix.txt", A.array())
</code></pre>

<p>and this to print:</p>

<pre><code>print("stiffness_matrix: "), A.array()
</code></pre>

<p>(*) It is perhaps a good idea to reduce (considerably) the number of nodes in the mesh to see if what you are printing it's o.k., e.g, run the code with this mesh:</p>

<pre><code>Mesh = BoxMesh(o, l, 1, 1, 1)
</code></pre>
</div>
												</div>
												<span class="qa-a-item-avatar-meta">
													<span class="qa-a-item-avatar">
														<a href="../../user/hernan_mella" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=14920815903966845416&amp;qa_size=40" width="40" height="22" class="qa-avatar-image" alt=""></a>
													</span>
													<span class="qa-a-item-meta">
														<a href="../../8199/error-while-printing-stiffness-matrix-saving-external-file?show=8217#a8217" class="qa-a-item-what">answered</a>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="published"><span class="value-title" title="2015-09-25T20:55:53+0000"></span>Sep 25, 2015</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span>
															<span class="qa-a-item-who-data"><span class="vcard author"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span></span>
															<span class="qa-a-item-who-title">FEniCS Expert</span>
															<span class="qa-a-item-who-points">
																<span class="qa-a-item-who-points-pad">(</span><span class="qa-a-item-who-points-data">19,460</span><span class="qa-a-item-who-points-pad"> points)</span>
															</span>
														</span>
														<br>
														<span class="qa-a-item-what">selected</span>
														<span class="qa-a-item-when">
															<span class="qa-a-item-when-data"><span class="updated"><span class="value-title" title="2015-09-29T22:13:23+0000"></span>Sep 30, 2015</span></span>
														</span>
														<span class="qa-a-item-who">
															<span class="qa-a-item-who-pad">by </span><span class="qa-a-item-who-data"><a href="../../user/Chaitanya_Raj_Goyal" class="qa-user-link url nickname">Chaitanya_Raj_Goyal</a></span>
														</span>
													</span>
												</span>
											</div>
											<div class="qa-a-item-buttons">
												</div>
											
											<div class="qa-a-item-c-list" id="c8217_list">
												<div class="qa-c-list-item  hentry comment" id="c8250">
													<div class="qa-c-item-content">
														<a name="8250"></a><div class="entry-content"><p>Thanks a lot hernan_mella! You are awesome. Even though I still don't understand why my version did not work and yours did.</p>

<p>Now I want to make sure that what I am printing is correct. I think it can try to view the stiffness matrix for the same problem in Fenics and Matlab Puffin and compare them. Do you have any personal suggestions?</p>

<p>Thank you!</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/Chaitanya_Raj_Goyal" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=5557427273671820211&amp;qa_size=20" width="20" height="12" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../8199/error-while-printing-stiffness-matrix-saving-external-file?show=8250#c8250" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-09-29T22:16:25+0000"></span>Sep 30, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/Chaitanya_Raj_Goyal" class="qa-user-link url nickname">Chaitanya_Raj_Goyal</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS User</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">4,150</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
												<div class="qa-c-list-item  hentry comment" id="c8252">
													<div class="qa-c-item-content">
														<a name="8252"></a><div class="entry-content"><p>In your code the line that cause the problem is:</p>

<pre><code>np.set_printoptions(threshold='nan')
</code></pre>

<p>honestly i don't know why this happens (i don't use python language to write my codes, but maybe is a bug), but if you eliminate this line your code works perfectly.</p>

<p>Answering at your last question, i don't have any suggestion for you (I<br>
I just found out about of the existence of puffin =( ).</p>

<p>regards.</p>
</div>
													</div>
													<div class="qa-c-item-footer">
														<span class="qa-c-item-avatar-meta">
															<span class="qa-c-item-avatar">
																<a href="../../user/hernan_mella" class="qa-avatar-link"><img src="../../?qa=image&amp;qa_blobid=14920815903966845416&amp;qa_size=20" width="20" height="11" class="qa-avatar-image" alt=""></a>
															</span>
															<span class="qa-c-item-meta">
																<a href="../../8199/error-while-printing-stiffness-matrix-saving-external-file?show=8252#c8252" class="qa-c-item-what">commented</a>
																<span class="qa-c-item-when">
																	<span class="qa-c-item-when-data"><span class="published"><span class="value-title" title="2015-09-30T02:51:45+0000"></span>Sep 30, 2015</span></span>
																</span>
																<span class="qa-c-item-who">
																	<span class="qa-c-item-who-pad">by </span>
																	<span class="qa-c-item-who-data"><span class="vcard author"><a href="../../user/hernan_mella" class="qa-user-link url nickname">hernan_mella</a></span></span>
																	<span class="qa-c-item-who-title">FEniCS Expert</span>
																	<span class="qa-c-item-who-points">
																		<span class="qa-c-item-who-points-pad">(</span><span class="qa-c-item-who-points-data">19,460</span><span class="qa-c-item-who-points-pad"> points)</span>
																	</span>
																</span>
															</span>
														</span>
														<div class="qa-c-item-buttons">
														</div>
													</div>
													<div class="qa-c-item-clear">
													</div>
												</div> <!-- END qa-c-item -->
											</div> <!-- END qa-c-list -->
											
											<input type="hidden" name="code" value="0-1516468162-2bfe9f738cdf2f0103899f5c32170fca02680766">
											<input type="hidden" name="qa_click" value="">
										</form>
										<div class="qa-c-form">
										</div> <!-- END qa-c-form -->
										
									</div> <!-- END qa-a-item-main -->
									<div class="qa-a-item-clear">
									</div>
								</div> <!-- END qa-a-list-item -->
								
							</div> <!-- END qa-a-list -->
							
						</div>
					</div> <!-- END qa-main -->
					
				</div> <!-- END main-wrapper -->
			</div> <!-- END main-shadow -->
		</div> <!-- END body-wrapper -->
		<!-- END footer-bottom-group -->
		
		<div style="position:absolute; left:-9999px; top:-9999px;">
			<span id="qa-waiting-template" class="qa-waiting">...</span>
		</div>
	
	

</body><!-- Powered by Question2Answer - http://www.question2answer.org/ --></html>